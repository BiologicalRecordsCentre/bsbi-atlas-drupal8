!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3)}(this,(function(t){"use strict";function a(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}})),e.default=t,Object.freeze(e)}var n=a(t),o="bsbi-atlas",r="0.2.0";function s(t,e,a,n,o,r,s){try{var i=t[r](s),c=i.value}catch(t){return void a(t)}i.done?e(c):Promise.resolve(c).then(n,o)}function i(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var r=t.apply(e,a);function i(t){s(r,n,o,i,c,"next",t)}function c(t){s(r,n,o,i,c,"throw",t)}i(void 0)}))}}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var p={bsbiDataRoot:"",periodClasses:"standard",showStatus:!0,resolution:"hectad",displayedMapType:"static",taxaHybridList:[],changeColours:["#FAD0C8","#DD5A2F","#525252"],symboltype:"circle",periodColours:{},dotCaption:""};p.periodColours.standard={x:{"to 1929":"#f7f7f7","1930 - 1969":"#c6c6c6","1970 - 1986":"#909090","1987 - 1999":"#4e4e4e","2000 - 2019":"#000000"},n:{"to 1929":"#eff3ff","1930 - 1969":"#bdd7e7","1970 - 1986":"#6baed6","1987 - 1999":"#2b71a5","2000 - 2019":"#004d99"},a:{"to 1929":"#FEE5D9","1930 - 1969":"#FCBCB4","1970 - 1986":"#FF8C86","1987 - 1999":"#FF0000","2000 - 2019":"#B30000"},bullseye:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},p.periodColours.print={x:{"pre-1970":"#f7f7f7","1970 - 1986":"#b9b9b9","1987 - 1999":"#6f6f6f","2000 - 2019":"#000000"},n:{"pre-1970":"#eff3ff","1970 - 1986":"#bdd7e7","1987 - 1999":"#368dcd","2000 - 2019":"#004d99"},a:{"pre-1970":"#fee5d9","1970 - 1986":"#fc9898","1987 - 1999":"#ff4646","2000 - 2019":"#b30000"},bullseye:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},p.periodStroke={},p.periodStroke.standard={x:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}},p.periodStroke.print={x:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}};var u={};function b(t,e){var a=e||"hectads";return"".concat(p.bsbiDataRoot).concat(a,"/").concat(t.replace(".","_"),".csv")}function h(t){return"to 1929"===t?"pre-1930":t.replace(" - ","–")}function f(t,e){return p.dotCaption="Hectad:<br/>Occurrence:",new Promise((function(a,o){n.csv(b(t),(function(t){if(t.hectad){var a=!1;u[p.periodClasses][e].csvperiods.forEach((function(e){"1"===t[e]&&(a=!0)}));var n=!1;if(u[p.periodClasses][e].prior.forEach((function(e){"1"===t[e]&&(n=!0)})),a||n)return{gr:t.hectad,shape:"circle",size:1,colour:a?"#000000":"#b0b0b0",opacity:1,stroke:"#808080",caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n            Occurrence: <b>").concat(a?"in":"prior to","</b> the period <b>").concat(h(e),"</b>"),noCaption:p.dotCaption}}})).then((function(t){var n={precision:1e4,size:1,lines:[{colour:"#636363",opacity:1,stroke:"black",text:h(e),shape:"circle"},{colour:"#bdbdbd",opacity:1,stroke:"black",text:"Earlier",shape:"circle"}]};"to 1929"==e&&n.lines.pop(),a({records:t,precision:1e4,opacity:1,size:1,legend:n})})).catch((function(t){o(t)}))}))}function m(t,e,a,o){p.dotCaption="Hectad:</br>Change:";var r=["square","triangle-up","triangle-down"],s=p.changeColours;return new Promise((function(i,c){n.csv(b(t),(function(t){var n,o,i=e.some((function(e){return"1"===t[e]})),c=a.some((function(e){return"1"===t[e]}));if(i&&c?(n=0,o="Present in both periods"):!i&&c?(n=1,o="Gain"):i&&!c?(n=2,o="Loss"):n=100,t.hectad&&n<100)return{gr:t.hectad,colour:s[n],shape:r[n],caption:"Hectad: <b>".concat(t.hectad,"</b></br>Change: <b>").concat(o,"</b>"),noCaption:p.dotCaption}})).then((function(t){var e;e=t.length?{title:o,size:1,precision:1e4,opacity:1,lines:[{colour:s[1],text:"Gain",shape:"triangle-up"},{colour:s[0],text:"No change",shape:"square"},{colour:s[2],text:"Loss",shape:"triangle-down"}]}:{title:"No data available",lines:[]},i({records:t,size:1,precision:1e4,opacity:1,legend:e})})).catch((function(t){c(t)}))}))}u.print={"pre-1970":{prior:[],csvperiods:["to 1929","1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},u.standard={"to 1929":{prior:[],csvperiods:["to 1929"]},"1930 - 1969":{prior:["to 1929"],csvperiods:["1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},p.distAllClasses=function(t){return"hectad"===p.resolution?function(t){var e={n:"Native",a:"Non-native (alien)",bullseye:"Introduced",missing:"missing"},a={"pre-1970":"pre-1970","to 1929":"pre-1930","1930 - 1969":"1930–69","1970 - 1986":"1970–86","1987 - 1999":"1987–99","2000 - 2019":"2000–19"},o={"pre-1970":1,"to 1929":1,"1930 - 1969":1,"1970 - 1986":1,"1987 - 1999":1,"2000 - 2019":1},r=Object.keys(u[p.periodClasses]).reverse();return new Promise((function(s,i){var c={};r.forEach((function(t){c[t]={ire:{n:0,a:0,bullseye:0,missing:0,total:0},gb:{n:0,a:0,bullseye:0,missing:0,total:0}}})),p.showStatus?p.dotCaption="Hectad:<br/>\n        Most recent dateclass:<br/>\n        Status:</b>":p.dotCaption="Hectad:<br/>\n        Most recent dateclass:",n.csv(b(t),(function(t){if(t.hectad){var n;n=3===t.hectad.length?"ire":"gb";var s=t.hectadstatus?t.hectadstatus:"missing";-1===["n","a","bullseye","missing"].indexOf(s)&&(s="missing");for(var i,l,d=!1,b=0;b<r.length;b++){i=r[b];for(var f=u[p.periodClasses][i].csvperiods,m=0;m<f.length;m++){if("1"===t[f[m]]){c[i][n][s]++,c[i][n].total++,d=!0,l=l||i;break}}}for(var g,v={},y=0;y<r.length;y++){i=r[y],v[i]=0;for(var x=u[p.periodClasses][i].csvperiods,w=0;w<x.length;w++){if("1"===t[x[w]]){v[i]=1;break}}}if(d)return g=p.showStatus?{gr:t.hectad,shape:"circle",colour:p.periodColours[p.periodClasses][s][l],stroke:p.periodStroke[p.periodClasses][s][l],size:"missing"===s?.5:1,opacity:o[l],caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(h(l),"</b><br/>\n                        Status: <b>").concat(e[s],"</b>"),noCaption:p.dotCaption}:{gr:t.hectad,shape:"circle",colour:p.periodColours[p.periodClasses].x[l],stroke:p.periodStroke[p.periodClasses].x[l],size:1,opacity:o[l],caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(h(l),"</b>"),noCaption:p.dotCaption},Object.keys(v).forEach((function(t){g[a[t]]=v[t]})),g}})).then((function(t){var e=r.reduce((function(t,e){return t+c[e].gb.a+c[e].ire.a}),0),n=r.reduce((function(t,e){return t+c[e].gb.n+c[e].ire.n}),0),i=[];p.showStatus?(n&&(i.push({text:["Native","","GB","IR"],underline:!0}),r.forEach((function(t){i.push({colour:p.periodColours[p.periodClasses].n[t],stroke:p.periodStroke[p.periodClasses].n[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.n,c[t].ire.n],shape:"circle"})}))),n&&e&&i.push({text:[]}),e&&(i.push({text:["Alien","","GB","IR"],underline:!0}),r.forEach((function(t){i.push({colour:p.periodColours[p.periodClasses].a[t],stroke:p.periodStroke[p.periodClasses].a[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.a,c[t].ire.a],shape:"circle"})})))):(i=[{text:["","","GB","IR"],underline:!0}],r.forEach((function(t){i.push({colour:p.periodColours[p.periodClasses].x[t],stroke:p.periodStroke[p.periodClasses].x[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.total,c[t].ire.total],shape:"circle"})}))),s({records:t,precision:1e4,size:1,legend:{size:.8,raligned:[!1,!1,!0,!0],padding:5,lines:i}})})).catch((function(t){i(t)}))}))}(t):"tetrad"===p.resolution?function(t){return p.dotCaption="Tetrad:",new Promise((function(e,a){n.csv(b(t,"tetrads"),(function(t){if(t.tetrad)return{gr:t.tetrad,shape:"square",colour:"black",size:1,opacity:1,caption:"Tetrad: <b>".concat(t.tetrad,"</b>"),noCaption:p.dotCaption}})).then((function(t){var a;console.log("Tetrad data",t),a=t.length?{lines:[{colour:"black",opacity:1,text:"Present in tetrad",shape:"square"}]}:{title:"No data available",lines:[]},e({records:t,precision:2e3,size:1,legend:a})})).catch((function(t){e({records:[],precision:2e3,size:1,legend:{title:"No data available",lines:[]}})}))}))}(t):function(t){return new Promise((function(e,a){n.csv(b(t,"monads"),(function(t){if(t.gr)return{gr:t.gr,shape:"square",colour:"black",size:1,opacity:1}})).then((function(t){e({records:t,precision:1e3,size:1,legend:{lines:[{colour:"black",opacity:1,text:"Present in monad",shape:"square"}]}})})).catch((function(t){a(t)}))}))}(t)},p.status_29=function(t){return f(t,"to 1929")},p.status_30_69=function(t){return f(t,"1930 - 1969")},p.status_70_86=function(t){return f(t,"1970 - 1986")},p.status_87_99=function(t){return f(t,"1987 - 1999")},p.status_00_19=function(t){return f(t,"2000 - 2019")},p.hybrid=function(t){var e=p.taxaHybridList.find((function(e){return e.taxon===t}));function a(t){return"<i>"+t.replace(/ x /g,"</i> x <i>")+"</i>"}var o=new Promise((function(e,a){n.csv(b(t)).then((function(t){e(t)})).catch((function(e){console.log("Hybrid map: can't retrieve map data for hybrid taxon ".concat(t)),a(e)}))})),r=new Promise((function(t,a){n.csv(b(e.parent1)).then((function(e){t(e)})).catch((function(t){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(e.parent1)),a(t)}))})),s=new Promise((function(t,a){n.csv(b(e.parent2)).then((function(e){t(e)})).catch((function(t){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(e.parent2)),a(t)}))}));return p.dotCaption="Hectad: <br/>\n    <i>".concat(e.parent1Name,"</i>: </br>\n    <i>").concat(e.parent2Name,"</i>: </br>\n    Hybrid:"),new Promise((function(t,n){Promise.all([o,r,s]).then((function(n){var o=[];n.forEach((function(t,e){t.forEach((function(t){var a=o.find((function(e){return t.hectad===e.gr}));if(a)a.presence[e]=!0;else{var n=[!1,!1,!1];n[e]=!0,o.push({gr:t.hectad,presence:n})}}))})),o.forEach((function(t){t.colour=t.presence[1]&&t.presence[2]?"#F7F619":t.presence[1]?"#E4C3AA":"#A8CBE2",t.caption="Hectad: <b>".concat(t.gr,"</b><br/>\n          <i>").concat(e.parent1Name,"</i>: <b>").concat(t.presence[1]?"present":"absent","</b></br>\n          <i>").concat(e.parent2Name,"</i>: <b>").concat(t.presence[2]?"present":"absent","</b></br>\n          Hybrid: <b>").concat(t.presence[0]?"present":"absent","</b>"),t.noCaption=p.dotCaption}));for(var r=o.length,s=0;s<r;s++)o[s].presence[0]&&o.push({gr:o[s].gr,shape:"square",size:.6,colour:"black",caption:o[s].caption,noCaption:o[s].noCaption});t({records:o,precision:1e4,shape:"circle",size:1,opacity:1,legend:{lines:[{colour:"black",text:"Hybrid recorded",shape:"square",size:.6},{colour:"#E4C3AA",text:a(e.parent1Name)},{colour:"#A8CBE2",text:a(e.parent2Name)},{colour:"#F7F619",text:"Both parents"}]}})})).catch((function(t){n(t)}))}))},p.change_1987_1999_vs_2000_2019=function(t){return m(t,["1987 - 1999"],["2000 - 2009","2010 - 2019"],"Change from 1987–1999 to 2000–2019")},p.change_1930_1969_vs_2000_2019=function(t){return m(t,["1930 - 1969"],["2000 - 2009","2010 - 2019"],"Change from 1930–1969 to 2000–2019")},p.bsbiHectadDateTetFreq=function(t){return p.dotCaption="Hectad: </br>Tetrads where present:",new Promise((function(e,a){n.csv(b(t),(function(t){var e=Number(t["distinct tetrads"]),a=5*Math.ceil(e/5);if(t.hectad&&e)return{gr:t.hectad,size:Math.sqrt(a)/5,caption:"Hectad: <b>".concat(t.hectad,"</b></br>Tetrads where present: <b>").concat(e,"</b>"),noCaption:p.dotCaption}})).then((function(t){var a;a=t.length?{title:"Tetrad frequency",size:1,shape:"circle",colour:"black",precision:1e4,opacity:1,lines:[{text:"1–5",size:Math.sqrt(5)/5*.5},{text:"6–10",size:Math.sqrt(10)/5*.5},{text:"11–15",size:Math.sqrt(15)/5*.5},{text:"16–20",size:Math.sqrt(20)/5*.5},{text:"21–25",size:Math.sqrt(25)/5*.5}]}:{title:"No data available",lines:[]},e({records:t,colour:"black",shape:"circle",precision:1e4,opacity:1,legend:a})})).catch((function(t){a(t)}))}))};var g=jQuery;function v(t,e,a){var n=function(t,e,a){a?g('meta[name="'+t+'"').attr("content",e):g("head").append('<meta name="'+t+'" content="'+e+'" />')};switch(t){case"title":g("head title").html(e),n("citation_title",e,a),n("dc.title",e,a),n("dcterms.title",e,a),n("prism.alternateTitle",e,a),n("eprints.title",e,a),n("bepress_citation_title",e,a);break;case"author":n("citation_author",e),n("dc.creator",e),n("dcterms.creator",e),n("eprints.creators_name",e),n("bepress_citation_author",e);break;case"authors":n("author",e),n("citation_authors",e);break;case"year":n("citation_year",e),n("citation_date",e),n("citation_publication_date",e),n("dc.date",e),n("dcterms.date",e),n("dcterms.created",e),n("prism.copyrightYear",e),n("prism.coverDate",e),n("prism.publicationDate",e),n("eprints.datestamp",e),n("eprints.date",e),n("bepress_citation_date",e);break;case"url":n("citation_public_url",e),n("prism.url",e),n("eprints.official_url",e),n("bepress_citation_pdf_url",e)}}var y,x,w,T,k,C="20220922-1",S=jQuery;function _(t){var e,a,n;e=S(t),a=S("<div>").appendTo(e),(n=S("<select>").appendTo(a)).attr("id","atlas-lat-phen-data-type"),n.addClass("selectpicker"),n.attr("data-width","100%"),n.on("changed.bs.select",(function(){k.length&&N(w,k)})),[{caption:"Scale by relative abundance",val:"count"},{caption:"Scale across latitudes",val:"scaled"},{caption:"Scale within latitude",val:"density"}].forEach((function(t){var e=(t.selected,S("<option>"));e.attr("value",t.val),e.html(t.caption).appendTo(n)})),n.val("count"),n.selectpicker()}function L(t,e){var a=e.map((function(t){return{taxon:"taxon",week:Number(t.week),n:Number(t.n)}})).sort((function(t,e){return t.week>e.week}));return t.setChartOpts({data:a})}function R(t,e,a){var n=[1,32,60,91,121,152,182,213,244,274,305,335,365],o=e[0].phenFlowerStart,r=e[0].phenFlowerEnd,s=e[0].phenLeafStart,i=e[0].phenLeafEnd,c=n[Number(o)-1],l=n[Number(r)],d=n[Number(s)-1],p=n[Number(i)];p===d&&(d=1,p=365),l===c&&(c=1,l=365);var u=[],b=[];c&&l&&(u=c>l?[[c,365],[1,l]]:[[c,l]]),d&&p&&(b=d>p?[[d,365],[1,p]]:[[d,p]]);if(a){var h=y(e[0].phenFlowerRef),f=y(e[0].phenLeafRef),m="";u.length&&(m=h?"Data for flower phenology from ".concat(h,"."):"Data for flower phenology predicted."),u.length&&b.length&&(m="".concat(m,"  ")),b.length&&(m=f?"".concat(m,"Data for leafing phenology from ").concat(f,"."):"".concat(m,"Data for leafing phenology predicted.")),S("#".concat(a)).html(m)}var g=[],v=0;return u.length&&g.push({prop:"flower",label:"Flowering",colour:"#fc8d62",svg:"M1048.256,633.499c212.849-356.854,285.555-335.845-191.845-590.438C384.889,283.217,484.493,353.496,664.566,633.499 c-310.065-285.921-239.639-396.021-620.823,0c64.157,504.336,28.591,448.084,502.257,364.911 c-416.078,181.718-421.368,113.233-191.845,590.438c503.843,103.322,428.181,97.12,502.257-364.911 c69.825,407.236,10.978,486.041,502.257,364.911c233.666-457.592,211.268-427.46-191.845-590.438 c452.881,101.063,461.097,199.985,502.257-364.911C1305.872,228.612,1381.606,318.787,1048.256,633.499z M856.411,1100.523 c-114.579,0-207.463-92.884-207.463-207.463s92.884-207.463,207.463-207.463c114.578,0,207.463,92.884,207.463,207.463 S970.989,1100.523,856.411,1100.523z",legendOrder:++v}),b.length&&g.push({prop:"leaf",label:"In leaf",colour:"#66c2a5",svg:"m12941 19084-175-112-108 54c-59 30-112 54-117 54s-97-112-203-250l-193-250h-150-151l-177-188c-97-104-186-197-197-207-19-17-23-16-139 49-66 36-124 66-128 65-6 0-219-276-359-464-10-14-30-7-149 53l-138 70-26-32c-15-17-103-124-195-238-92-115-171-208-175-208s-61 25-127 55l-119 55-90-92c-50-51-149-155-220-230l-130-138-112 100c-61 55-115 100-120 100-4 0-123-122-263-269-140-148-260-270-266-270-5-1-65 39-131 88l-122 90-233-207c-129-114-264-233-300-265l-66-58-138 80-139 80-139-147c-77-81-181-189-231-240l-91-94-161 80-160 81-169-201c-93-110-176-209-184-219-15-19-19-18-174 26-87 25-162 42-167 39s-79-90-164-194c-140-171-158-188-178-181-12 5-73 30-134 56-62 26-116 45-121 43-5-1-105-104-222-226-192-202-216-223-239-218-14 3-82 23-151 44l-126 38-249-262c-138-145-252-263-255-263s-45 55-95 124c-49 68-92 121-96 117s-98-138-209-299l-201-292-138 69-139 69-223-336c-123-184-227-339-230-344s-83-20-177-33c-95-12-174-25-176-27s-52-107-111-234c-59-126-111-233-114-237-4-4-62 8-130 27-69 19-125 34-127 32-1-1-57-139-125-307-67-168-124-307-125-309-2-2-69-14-150-27-80-12-147-24-149-26-3-2-30-125-60-273-31-149-58-272-60-274-3-2-68 2-146 8-77 7-144 10-147 6-3-3-16-132-28-286s-23-281-25-283-79-18-171-36l-168-34-2-380-3-381-193-79c-139-57-192-84-192-95 0-9 29-149 65-310s65-295 63-296c-2-2-86-43-188-91s-188-90-192-93 45-170 108-371l114-365-67-65c-38-36-110-104-162-152l-93-86 136-329c75-181 136-332 136-337 0-4-58-90-128-190-71-99-132-187-136-194-6-10 62-142 290-561 15-26 21-48 16-55-5-6-66-82-135-170-70-87-127-162-127-166 0-5 108-183 239-396l240-387-90-99c-49-54-89-102-89-107s111-164 246-353c136-188 253-353 261-365 13-20 10-32-43-149-55-124-56-128-38-143 11-9 182-159 381-334l361-317-5-43c-3-23-13-105-24-182-10-77-16-141-15-143 4-3 510-150 857-248 15-4 13-20-18-141-18-74-32-137-31-139 2-1 138-21 303-42 279-37 309-43 431-86 238-83 552-155 824-188 141-17 699-17 840 0 648 79 1266 287 1860 624 111 64 378 237 494 320 46 34 67 44 62 32-4-11-35-107-68-214-397-1294-750-2359-915-2764-72-178-107-247-165-332-72-104-110-172-148-269-56-142-97-325-73-325 29 0 420 94 429 104 6 6 46 128 89 271 42 143 142 478 222 745 79 267 202 679 273 915 71 237 185 621 255 855s151 506 181 604c30 99 54 185 54 193 0 27 18 12 35-30 31-80 204-397 305-558 282-454 581-807 1323-1564l245-250 114 113c62 61 116 112 120 112s118-122 253-270c136-149 250-270 254-270 3 0 40 68 81 151s78 152 82 155c3 2 122-66 263-152 180-110 259-153 264-145 5 7 18 57 30 112l22 99h515c283 0 514 1 514 3s-20 52-44 112l-44 110 479 3c310 1 479 6 479 12s-14 58-31 116-30 106-28 108c2 1 179 26 392 56 214 30 392 57 398 60 5 4-4 44-21 95-16 49-30 94-30 100 0 7 112 32 288 64 158 29 296 55 307 58 20 4 20 7 9 141-7 75-12 138-11 138 5 5 558 214 564 214 5 0 14 4 21 9 13 8 10 15-74 227-3 5 144 82 326 169 181 88 330 164 330 170s-30 84-66 174c-53 134-63 166-52 176 7 7 105 85 218 175s210 168 217 174c9 8-1 46-42 164-30 84-55 157-55 162s101 91 225 190 225 183 225 186-56 66-124 140l-125 135 194 217c107 119 195 219 194 222 0 3-45 41-100 85-54 44-111 90-125 101l-26 21 145 289c80 159 147 294 148 299 1 6-25 25-57 44-33 18-78 44-101 57l-41 24 124 226c69 124 124 229 122 234-2 4-42 42-90 84l-87 76 28 63c15 34 72 158 126 276l98 214-39 36c-21 20-68 61-103 93l-64 56 136 261c76 144 137 263 137 265 0 3-57 23-127 46-71 24-132 46-136 50-4 3 33 128 82 276s88 270 86 272-45-6-95-18c-51-11-95-19-98-16-5 6-4 13 77 405 28 135 49 246 47 248-1 2-36-11-76-27-39-17-74-30-76-27-2 2 1 111 6 243 5 131 10 284 10 339v100l-87-10c-49-6-89-8-90-5s29 140 66 305 67 301 66 303c-2 2-53-22-114-52-91-46-111-53-111-39 0 10 9 144 20 298s20 297 20 317v37l-72-20c-40-11-81-22-90-25-17-5-18 16-18 350 0 278-3 356-12 356-7 0-53-9-102-20s-91-19-92-17c-1 1-17 106-35 232-18 127-35 233-38 237-3 3-39-7-79-24s-74-29-76-27c-3 2-15 155-27 339s-23 336-25 338c-1 2-45-15-98-39-53-23-99-39-102-36s-17 167-30 364c-12 197-23 359-24 361 0 1-43-32-96-73s-99-75-103-75-26 141-50 313c-23 171-44 319-47 328-4 14-14 14-102-6-53-12-100-20-103-16-4 3-31 143-60 309-30 167-57 309-61 315-4 7-30 0-77-21-39-18-73-32-76-32s-5 149-5 330c0 182-3 330-6 330s-49-29-101-65c-53-36-97-64-98-63-2 2-8 154-15 338-6 184-13 337-15 338-2 2-40-24-85-57-44-34-84-61-89-61-4 0-7 10-5 23 2 12 11 139 19 282s18 291 21 329l6 69-126-5c-114-5-126-4-122 11 8 27 126 657 126 673 0 10-37 25-115 48-104 30-114 35-110 54 3 12 16 71 30 131 102 438 125 539 125 551 0 10-24 14-99 16l-98 3 112 248 113 248-27 10c-14 6-61 22-104 35l-77 25 52 97c28 53 75 142 105 196 29 55 52 100 51 101-2 1-42 17-90 35-49 18-88 38-88 45s11 86 25 175c14 90 24 166 23 170-2 4-81-43-177-106z",legendOrder:++v}),t.setChartOpts({data:[{taxon:"taxon",leaf:b.map((function(t){return{start:t[0],end:t[1]}})),flower:u.map((function(t){return{start:t[0],end:t[1]}}))}],metrics:g});function y(t){var e=S("<div>");e.html(t);var a=e.children("span").eq(0),n=e.children("span").eq(1);return a&&n&&"Poland, J."===a.text()&&"personal observation"===n.text()&&a.text("John Poland,"),e.html()}}function N(t,e){var a=S("#atlas-lat-phen-data-type").val(),n=e.filter((function(t){return t.type===a})).map((function(t){var e={taxon:"taxon"};return Object.keys(t).forEach((function(a){e[a]=Number(t[a])})),e})),o=["50","51","52","53","54","55","56","57","58","59","60"].map((function(t){return{prop:t,label:t,colour:"green",fill:"#ddffdd"}})),r=n.sort((function(t,e){return t.week>e.week}));return t.setChartOpts({data:r,metrics:o,spread:!0})}function I(t,e){var a=e.map((function(t){return{distance:Number(t.distance),altitude:Number(t.altitude),metric:Number(t.percent),taxon:"dummy"}}));return t.setChartOpts({data:a})}function A(t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);var e=document.createElement("textarea");return e.value=t,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),new Promise((function(t,a){document.execCommand("copy")?t():a(),e.remove()}))}function E(t,e,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}function B(t){for(var e=t+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var o=a[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function M(t,e){return e?"<i>".concat(t.shortName.replace(/\s/g,"</i> <i>"),"</i> in <i>BSBI</i> <i>Online</i> <i>Atlas</i> <i>2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(t.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]"):"<i>".concat(t.shortName,"</i> in <i>BSBI Online Plant Atlas 2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(t.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]")}var P=function(t){return!isNaN(parseFloat(t))&&isFinite(t)};var O=function(t,e){if(0===(t=function(t){var e=[];if(null==t)return e;for(var a=0;a<t.length;a++)P(t[a])&&e.push(+t[a]);return e}(t)).length||null==e||e<0)return NaN;e>1&&(e=1);var a=(t=function(t){return t.sort((function(t,e){return t-e}))}(t)).length*e-.5;if((0|a)===a)return t[a];var n=0|a,o=a-n;return(1-o)*t[n]+o*t[Math.min(n+1,t.length-1)]};var D,z,F,H,G,W,q,j,U,J=jQuery,V=drupalSettings,K=B("trend-region")?B("trend-region"):"Britain",Q=B("trend-term")?B("trend-term"):"long",X=B("trend-scale")?B("trend-scale"):"within",Z=B("trend-scale-density")?B("trend-scale-density"):"max";function Y(t){if(t&&(U=t),U.identifier){var e,a,o,r,s,i,c,d,p,u,b,h="short"===Q?"Post-1987":"Post-1930";e="Northern"===K?"Northern Ireland":"Republic"===K?"Republic of Ireland":K,J("#bsbiTrendsTitle").html("<b>".concat(h,"</b> effort-adjusted 10 km distribution trends for <b>").concat(e,"</b>")),U["".concat(Q,"TrendAgg")]?tt(U,Q,J("#bsbiTrendsAggNote")):J("#bsbiTrendsAggNote").html(""),(a=U["".concat(Q,"TrendAgg")]?U["".concat(Q,"TrendAgg")]:U.identifier,o=V.bsbi_atlas.dataRoot+"bsbi/trends/",r=V.bsbi_atlas.dataRoot+"bsbi/trends/hectad-counts",s=n.csv("".concat(r,"/").concat(a.replace(/\./g,"_"),".csv?prevent-cache=").concat(C)),i=n.csv("".concat(o).concat(Q,"/trends-gam/").concat(K,"/").concat(a.replace(/\./g,"_"),".csv?").concat(C),(function(t){return{year:Number(t.year),value:Number(t.x50),upper:Number(t.x95),lower:Number(t.x5)}})),c=n.csv("".concat(o).concat(Q,"/trends-linmod/").concat(K,"/").concat(a.replace(/\./g,"_"),".csv?").concat(C),(function(t){return{gradient:Number(t.gradient),intercept:Number(t.intercept)}})),d=n.csv("".concat(o).concat(Q,"/trends-lt-mean-sd/").concat(K,"/").concat(a.replace(/\./g,"_"),".csv?").concat(C),(function(t){return{year:Number(t.year),mean:Number(t.mean),sd:Number(t.std)}})),p=n.csv("".concat(o).concat(Q,"/trends-summaries/").concat(K,"/").concat(a.replace(/\./g,"_"),".csv?").concat(C),(function(t){return[{value:Number(t.declineStrong),label:"Strong decline",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.declineMod),label:"Moderate decline",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.stable),label:"Stable",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.increaseMod),label:"Moderate increase",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.increaseStrong),label:"Strong increase",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"}]})),u=n.csv("".concat(o).concat(Q,"/trends-linmod/").concat(K,"/mean-gradients.csv?").concat(C),(function(t){return{slope:Number(t.gradient)}})),b=n.csv("".concat(o).concat(Q,"/trends-linmod/centiles.csv?").concat(C),(function(t){return{region:t.region,c5:Number(t.c5),c95:Number(t.c95)}})),Promise.allSettled([i,c,d,p,u,b,s])).then((function(t){var e,a,n,o,r=t[6],s=!0;if("fulfilled"===r.status&&(s="Britain"===K||"England"===K||"Scotland"===K||"Wales"===K?"long"===Q?r.value[0].GbLong<=15:r.value[0].GbShort<=15:"long"===Q?r.value[0].IrLong<=6:r.value[0].IrShort<=6),"fulfilled"!==t[0].status||s)e=[],G.show();else if(G.hide(),"short"===Q){e=[];for(var i=0;i<44;i++)e.push(t[0].value[0]);e=[].concat(l(e),l(t[0].value))}else e=t[0].value;"fulfilled"!==t[1].status||s?(a=[],o=[],W.show(),j.show()):(o=[(a=t[1].value).map((function(t){return{slope:Number(t.gradient)}}))],W.hide(),j.hide());var c="fulfilled"!==t[4].status||s?[]:t[4].value;o.length&&o.push(c);var d,p,u="fulfilled"!==t[5].status||s?[]:t[5].value,b="fulfilled"!==t[2].status||s?[]:t[2].value;b.reverse(),"fulfilled"!==t[3].status||s?(n=[],q.show()):(n=t[3].value[0],q.hide()),"across"===X&&(d=-.2,p=1),D.updateChart(e,b,"long"===Q?1947:1990,2022,d,p,!0,[{y:0,stroke:"rgb(210,210,210)",strokeWidth:1}]),z.updateChart(a,b,"long"===Q?1947:1990,2022,d,p,!0,[{y:0,stroke:"rgb(210,210,210)",strokeWidth:1}]),F.updateChart(n);var h=u.find((function(t){return t.region===K}));if(o.length){var f=o[0].map((function(t){return t.slope})),m=O(f,.95),g=O(f,.05),v=h.c95>m?h.c95:m,y=h.c5<g?h.c5:g;H.updateChart(o,y,v,[{x:-.004,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:-.001,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:0,stroke:"silver",strokeWidth:1},{x:.001,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:.004,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"}],null,"max"===Z)}else H.updateChart([])}))}}function $(t){var e,a;e=et(t),(a=J("<select>").appendTo(e)).addClass("selectpicker"),a.addClass("atlas-trends-regions-control"),a.attr("data-width","100%"),a.on("changed.bs.select",(function(){E("trend-region",K=J(this).val(),30),Y()})),[{caption:"Britain",val:"Britain"},{caption:"Ireland",val:"Ireland"},{caption:"England",val:"England"},{caption:"Scotland",val:"Scotland"},{caption:"Wales",val:"Wales"},{caption:"Northern Ireland",val:"Northern"},{caption:"Republic of Ireland",val:"Republic"}].forEach((function(t){var e=(t.selected,J("<option>"));e.attr("value",t.val),e.html(t.caption).appendTo(a)})),a.val(K),a.selectpicker(),function(t){var e=J("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-term-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){E("trend-term",Q=J(this).val(),30),Y()})),[{caption:"Long-term trend (post-1930)",val:"long"},{caption:"Short-term trend (post-1987)",val:"short"}].forEach((function(t){var a=(t.selected,J("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(Q),e.selectpicker()}(et(t)),function(t){var e=J("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-scale-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){E("trend-scale",X=J(this).val(),30),Y()})),[{caption:"Scale trends to species",val:"within"},{caption:"Scale trends across species",val:"across"}].forEach((function(t){var a=(t.selected,J("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(X),e.selectpicker()}(et(t)),function(t){var e=J("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-density-scale-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){E("trend-scale-density",Z=J(this).val(),30),Y()})),[{caption:"Scale density plot to max",val:"max"},{caption:"Scale density plot to area",val:"area"}].forEach((function(t){var a=(t.selected,J("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(Z),e.selectpicker()}(et(t))}function tt(t,e,a){a.html(""),J("<span>").appendTo(a).html("(Trend for aggregate taxon ".concat(i(t[e+"TrendAggName"]))),console.log(t.trendAggTaxaNames,t.trendAggTaxa);var n=t.trendAggTaxaNames.split(",").map((function(e,a){return i(e,t.trendAggTaxa.split(",")[a])})).join(", "),o=n.lastIndexOf(", ");n="".concat(n.substring(0,o)," and ").concat(n.substring(o+1));var r=J("<span>").appendTo(a);r.css("display","none"),r.html(" - comprises ".concat(n));var s=J("<span>").appendTo(a);function i(t,e){var a="<i>".concat(t,"</i>");return["agg.","s.s.","s.l.","subsp.","="].forEach((function(t){a=a.replace(t,"</i>".concat(t,"<i>"))})),a=a.replace(/ x /g," × "),e&&(a='<a href="/atlas/'.concat(e,'">').concat(a,"</a>")),a}s.css("cursor","pointer"),s.data("data-val","hide"),s.html(" - <b>[show more]</b>)"),s.on("click",(function(){"hide"===J(this).data("data-val")?(J(this).data("data-val","show"),J(this).html(" - <b>[show less]</b>)"),r.show()):(J(this).data("data-val","hide"),J(this).html(" - <b>[show more]</b>)"),r.hide())}))}function et(t,e){var a=J("<div>").appendTo(J(t));return a.addClass("atlas-trend-control-row"),e&&a.addClass(e),a}var at=jQuery;drupalSettings;var nt=jQuery,ot=drupalSettings;function rt(t,e){if(document.getElementById(t).innerHTML="",e){var a=ot.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(C);d3.csv(n).then((function(e){var a=e[0].images.split(";").filter((function(t){return t})).map((function(t){return{src:t.replace("{PIXELSIZE}","1920"),thumb:t.replace("{PIXELSIZE}","192"),subHtml:'\n              <div class="lightGallery-captions">\n                <div style="background-color: black; opacity: 0.7">\n                <p style="margin: 0.3em">Copyright Rob Still/Chris Gibson</p>\n                <div>\n              </div>'}})),n=document.getElementById(t);if(a.length){var o=lightGallery(n,{container:n,dynamic:!0,hash:!1,closable:!1,download:!1,showMaximizeIcon:!0,appendSubHtmlTo:".lg-item",slideDelay:400,plugins:[lgZoom,lgThumbnail],dynamicEl:a,thumbWidth:90,thumbHeight:"60px",thumbMargin:4});setTimeout((function(){o.openGallery(),nt("#bsbi-gallery-copyright").show()}),200)}else n.innerHTML="No images are available for this taxon",nt("#bsbi-gallery-copyright").hide()}))}}var st,it,ct,lt=jQuery,dt=drupalSettings,pt=B("gridstyle")?B("gridstyle"):"solid",ut=B("backdrop")?B("backdrop"):"colour_elevation",bt="allclass",ht=B("inset")?B("inset"):"BI4",ft=B("boundaries")?B("boundaries"):"none",mt=!1,gt="static",vt="hectad",yt=5,xt=2,wt={display:!0,scale:.8,x:10,y:0,data:null},Tt={display:!0,scale:1,x:10,y:5,data:null},kt=[{min:"",max:1929,access:"status_29",caption:"1929 and before"},{min:1930,max:1969,access:"status_30_69",caption:"1930–1969"},{min:1970,max:1986,access:"status_70_86",caption:"1970–1986"},{min:1987,max:1999,access:"status_87_99",caption:"1987–1999"},{min:2e3,max:2019,access:"status_00_19",caption:"2000–2019"}],Ct=[{lower:"1930–69",upper:"2000–19",access:"change_1930_1969_vs_2000_2019",caption:"1930–69 vs 2000–19"},{lower:"1987–99",upper:"2000–19",access:"change_1987_1999_vs_2000_2019",caption:"1987–99 vs 2000–19"}];function St(t,e){var a=lt("<div>").appendTo(lt(t));return a.addClass("atlas-map-control-row"),e&&a.addClass(e),a}function _t(){"static"===gt?(lt("#slippyAtlasMain").hide(),lt("#staticAtlasMain").show()):(lt("#staticAtlasMain").hide(),lt("#slippyAtlasMain").show()),"static"===gt?lt(".atlas-save-map-image").show():lt(".atlas-save-map-image").hide(),lt(".atlas-download-map-data").show(),"allclass"===bt&&"hectad"===vt?lt(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!1):lt(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!0),"static"===gt?lt(".atlas-backdrop-selector").show():lt(".atlas-backdrop-selector").hide(),"static"===gt?lt(".atlas-inset-control").show():lt(".atlas-inset-control").hide(),"static"===gt?lt(".atlas-grid-type-control").show():lt(".atlas-grid-type-control").hide(),"status"===bt?lt(".atlas-period-slider-control").show():lt(".atlas-period-slider-control").hide(),"trends"===bt?lt(".atlas-trend-slider-control").show():lt(".atlas-trend-slider-control").hide(),"allclass"===bt||"slippy"===bt?lt(".atlas-status-checkbox-control").show():lt(".atlas-status-checkbox-control").hide(),"slippy"===gt?lt(".atlas-opacity-slider-control").show():lt(".atlas-opacity-slider-control").hide();var t=st.noStatus||st.isHybrid,e=st.hybridMapping;t||e?(mt=!1,p.showStatus=!1,lt(".atlas-status-checkbox-control span").text("No status info for this taxon"),lt(".atlas-status-checkbox-control span").css("color","silver")):(lt(".atlas-status-checkbox-control span").text("Show status"),lt(".atlas-status-checkbox-control span").css("color","black")),t||e||"slippy"===gt&&"allclass"===bt&&"hectad"!==vt?(lt(".atlas-status-checkbox").prop("checked",!1),lt(".atlas-status-checkbox").attr("disabled",!0)):(lt(".atlas-status-checkbox").attr("disabled",!1),lt(".atlas-status-checkbox").prop("checked",mt)),"slippy"===gt&&"allclass"===bt?lt(".atlas-resolution-control").show():lt(".atlas-resolution-control").hide(),"slippy"===gt&&"allclass"===bt?(p.resolution=vt,lt(".bsbi-resolution-"+vt).prop("checked",!0)):p.resolution="hectad";var a=lt('.atlas-map-type-selector option[value="hybrid"]');e?a.show():(a.hide(),"hybrid"===bt&&(a.prop("selected",!1),lt('.atlas-map-type-selector option[value="allclass"]').prop("selected",!0),bt="allclass")),lt(".atlas-map-type-selector").selectpicker("refresh")}function Lt(t){st=t}function Rt(t){var e="#bsbiMapDownloadDiv"===t,a=JSON.parse(JSON.stringify(brcatlas.namedTransOpts));delete a.BI3,a.BI4.bounds.xmin=e?-265e3:-24e4,e&&(a.BI4.insets[0].imageX=20,a.BI4.insets[0].imageY=19,a.BI4.insets[1].imageX=-39,a.BI4.insets[1].imageY=-30),a.BI1.bounds.xmin=-23e4,a.BI2.bounds.xmin=-23e4,p.bsbiDataRoot=dt.bsbi_atlas.dataRoot+"bsbi/maps/",p.showStatus=!1;var n={status_29:p.status_29,status_30_69:p.status_30_69,status_70_86:p.status_70_86,status_87_99:p.status_87_99,status_00_19:p.status_00_19,"Tetrad frequency":p.bsbiHectadDateTetFreq,change_1987_1999_vs_2000_2019:p.change_1987_1999_vs_2000_2019,change_1930_1969_vs_2000_2019:p.change_1930_1969_vs_2000_2019,distAllClasses:p.distAllClasses,hybrid:p.hybrid};ct=brcatlas.svgMap({selector:t,mapid:"staticAtlasMain",captionId:"dotCaption",height:650,expand:!0,legendOpts:Tt,legendFontSize:e?"13pt":"14px",legendFont:e?"Minion Pro":"sans-serif",transOptsKey:B("inset")?B("inset"):ht,transOptsSel:a,mapTypesKey:"status_10_19",mapTypesSel:n,mapTypesControl:!1,transOptsControl:!1,seaFill:"white",gridLineColour:"#7C7CD3",gridLineStyle:pt,gridLineWidth:e?"1.09pt":1,boundaryColour:"#7C7CD3",boundaryLineWidth:e?"1.09pt":1,vcColour:"#7C7CD3",vcLineStyle:"vc"===ft?"":"none",vcLineWidth:e?"1.09pt":1,countryColour:"#7C7CD3",countryLineStyle:"country"===ft?"":"none",countryLineWidth:e?"1.09pt":1,insetLineWidth:e?"1.09pt":1}),dt.bsbi_atlas.dataRoot,it=brcatlas.leafletMap({selector:t,mapid:"slippyAtlasMain",height:650,width:ct.getMapWidth(),captionId:"dotCaption",mapTypesKey:"status_10_19",mapTypesSel:n,legendOpts:wt,basemapConfigs:[{name:"Open Street Map",type:"tileLayer",selected:!0,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",opts:{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},{name:"Stamen Black & White",type:"tileLayer",selected:!1,url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}",opts:{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}},{name:"Open Topo Map",type:"tileLayer",selected:!1,url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",opts:{maxZoom:17,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},{name:"GEBCO 2020 Elevation",type:"wms",selected:!1,url:"https://www.gebco.net/data_and_products/gebco_web_services/2020/mapserv?",opts:{layers:"GEBCO_2020_Grid_2",maxZoom:17,attribution:"Imagery reproduced from the GEBCO_2020 Grid, GEBCO Compilation Group (2020) GEBCO 2020 Grid (doi:10.5285/a29c5465-b138-234d-e053-6c86abc040b9)"}},{name:"Copernicus elevation aspect",type:"wms",selected:!1,url:"https://copernicus.discomap.eea.europa.eu/arcgis/services/Elevation/Aspect/MapServer/WMSServer?",opts:{layers:"image",maxZoom:17,attribution:"&copy; European Commission"}}],callbacks:[At,Et,Nt,It],showVcs:"vc"===ft,showCountries:"country"===ft}),lt("#slippyAtlasMain").hide(),lt(window).resize((function(){var t=lt("#bsbiMapDiv"),e=t.width(),a=t.height();console.log("size",e,a),it.setSize(e,a)}))}function Nt(){document.getElementById("atlas-loader").style.display="inline-block"}function It(){document.getElementById("atlas-loader").style.display="none"}function At(){document.getElementById("atlas-loader").style.display="inline-block"}function Et(){document.getElementById("atlas-loader").style.display="none"}function Bt(t){var e;if(e="static"===gt?ct:it,"status"===bt){var a=kt[yt-1].access;e.setMapType(a)}else if("allclass"===bt)e.setMapType("distAllClasses");else if("trends"===bt){var n=Ct[xt-1].access;e.setMapType(n)}else"tetrad"===bt?e.setMapType("Tetrad frequency"):"hybrid"===bt&&e.setMapType("hybrid");if(Tt.scale=.9,"BI1"==ht&&(Tt.scale=.77*Tt.scale),"BI2"==ht&&(Tt.scale=.85*Tt.scale),ct.setLegendOpts(Tt),st.identifier){if(e.setIdentfier(st.identifier),t)return e.redrawMap();e.redrawMap().then((function(){})).catch((function(t){console.warn("Unable to generate map for ".concat(st.shortName," (").concat(st.identifier,"). Error message:"),t),e.clearMap(),It()}))}lt("#dotCaption").html(p.dotCaption)}function Mt(t){var e,a;!function(t){var e=lt('<div style="display: flex">').appendTo(t),a=lt('<div class="btn-group" data-toggle="buttons">').appendTo(e),n=lt('<label class="btn btn-primary active">').appendTo(a);lt('<input type="radio" name="mapType" value="static" checked>').appendTo(n),n.append("Overview");var o=lt('<label class="btn btn-primary">').appendTo(a);lt('<input type="radio" name="mapType" value="slippy">').appendTo(o),o.append("Zoomable");var r=lt('<div id="atlas-loader" style="display: none">').appendTo(e);lt('<div class="atlas-loader">').appendTo(r),lt('input[type=radio][name="mapType"]').change((function(){if(gt=lt(this).val(),p.displayedMapType=gt,"slippy"===gt){var t=lt("#bsbiMapDiv"),e=t.width(),a=t.height();it.setSize(e,a)}_t(),Bt(),"slippy"===gt&&it.invalidateSize()}))}(St(t)),e=St(t),(a=lt("<select>").appendTo(e)).addClass("selectpicker"),a.addClass("atlas-map-type-selector"),a.attr("data-width","100%"),a.on("changed.bs.select",(function(){bt=lt(this).val(),_t(),Bt()})),[{caption:"Distribution overview",val:"allclass"},{caption:"Distribution by year range",val:"status"},{caption:"Change maps",val:"trends"},{caption:"Tetrad frequency",val:"tetrad"},{caption:"Map hybrid with parents",val:"hybrid"}].forEach((function(t){var e=lt("<option>");e.attr("value",t.val),e.html(t.caption).appendTo(a)})),a.selectpicker(),function(t){var e=lt("<div>").appendTo(t);e.addClass("atlas-period-slider-control"),e.hide();var a=lt("<div>").appendTo(e);a.addClass("slidecontainer");var n=lt("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",kt.length).attr("id","atlas-range-select"),n.change((function(){yt=lt(this).val(),Bt()}));var o=lt("<div>").appendTo(a);o.addClass("atlas-range-tick-container"),o.css("margin-bottom","4.3em"),kt.forEach((function(t,e){var a=lt("<span>").appendTo(o);a.addClass("atlas-range-tick");var n=e/(kt.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var r=lt("<span>").appendTo(a);r.addClass("atlas-range-tick-text"),r.html((t.min?t.min:"pre")+"<br>"+(1929===t.max?1930:t.max))}))}(St(t)),function(t){var e=lt("<div>").appendTo(t);e.addClass("atlas-status-checkbox-control");var a=lt('<div class="checkbox">').appendTo(e);lt('<label><input type="checkbox" class="atlas-status-checkbox"/><span>Show status</span></label>').appendTo(a),lt(".atlas-status-checkbox").change((function(){mt=lt(this).is(":checked"),p.showStatus=mt,Bt()}))}(St(t)),function(t){var e=lt("<div>").appendTo(t);e.addClass("atlas-trend-slider-control"),e.hide();var a=lt("<div>").appendTo(e);a.addClass("slidecontainer"),a.addClass("atlas-trend-select-container");var n=lt("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",Ct.length).addClass("atlas-trend-select"),n.change((function(){xt=lt(this).val(),Bt()}));var o=lt("<div>").appendTo(a);o.addClass("atlas-trend-tick-container"),Ct.forEach((function(t,e){var a=lt("<span>").appendTo(o);a.addClass("atlas-trend-tick");var n=e/(Ct.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var r=lt("<span>").appendTo(a);r.addClass("atlas-trend-tick-text"),r.addClass("atlas-trend-tick-text-"+e),r.html(t.lower+"<br>v.<br>"+t.upper)})),e.css("margin-bottom","5.3em")}(St(t)),function(t){var e=dt.bsbi_atlas.dataRoot+"rasters/",a=[{caption:"No backdrop",val:"none"},{caption:"Colour elevation",val:"colour_elevation"},{caption:"Grey elevation",val:"grey_elevation_300"}],n=lt("<select>").appendTo(t);n.addClass("selectpicker"),n.attr("data-width","100%"),n.on("changed.bs.select",(function(){a.forEach((function(t){"none"!==t.val&&ct.basemapImage(t.val,!1,e+t.val+".png",e+t.val+".pgw")})),E("backdrop",ut=lt(this).val(),30),"none"!==ut&&ct.basemapImage(ut,!0,e+ut+".png",e+ut+".pgw")})),a.forEach((function(t){var e=lt("<option>");e.attr("value",t.val),e.html(t.caption).appendTo(n)})),n.val(ut),"none"!==ut&&ct.basemapImage(ut,!0,e+"".concat(ut,".png"),e+"".concat(ut,".pgw")),n.selectpicker()}(St(t,"atlas-backdrop-selector")),function(t){var e=lt("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-inset-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){ht=lt(this).val(),ct.setTransform(ht),E("inset",ht,30),Bt()})),[{caption:"No insets",val:"BI1"},{caption:"Channel Isles inset",val:"BI2"},{caption:"Northern and Channel Isles inset",val:"BI4"}].forEach((function(t){var a=(t.selected,lt("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(ht),e.selectpicker()}(St(t)),function(t){var e=lt("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-grid-type-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){E("gridstyle",pt=lt(this).val(),30),ct.setGridLineStyle(pt)})),[{caption:"Solid grid lines",val:"solid"},{caption:"Dashed grid lines",val:"dashed"},{caption:"No grid lines",val:"none"}].forEach((function(t){var a=(t.selected,lt("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(pt),e.selectpicker()}(St(t)),function(t){var e=lt("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-boundaries-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){E("boundaries",ft=lt(this).val(),30),"none"===ft?(ct.setVcLineStyle("none"),ct.setCountryLineStyle("none"),ct.setBoundaryColour("#7C7CD3"),it.setShowVcs(!1),it.setShowCountries(!1)):"vc"===ft?(ct.setVcLineStyle(""),ct.setCountryLineStyle("none"),ct.setBoundaryColour("white"),it.setShowVcs(!0),it.setShowCountries(!1)):"country"===ft&&(ct.setVcLineStyle("none"),ct.setCountryLineStyle(""),ct.setBoundaryColour("white"),it.setShowVcs(!1),it.setShowCountries(!0))})),[{caption:"Country boundaries",val:"country"},{caption:"Vice-county boundaries",val:"vc"},{caption:"No boundaries",val:"none"}].forEach((function(t){var a=(t.selected,lt("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(ft),e.selectpicker()}(St(t)),function(t){lt("#atlas-leaflet-svg").css("opacity",.7);var e=lt("<div>").appendTo(t);e.addClass("atlas-opacity-slider-control"),e.hide();var a=lt("<div>").appendTo(e);a.addClass("atlas-opacity-slider-label"),a.text("Opacity:");var n=lt("<div>").appendTo(e);n.addClass("slidecontainer"),n.addClass("atlas-opacity-slider-slider");var o=lt("<input>").appendTo(n);o.addClass("slider"),o.attr("type","range").attr("min","1").attr("max","100").attr("value",70).attr("id","atlas-opacity-slider"),o.change((function(){lt("#atlas-leaflet-svg").css("opacity",lt(this).val()/100)}))}(St(t)),lt(t).each((function(t){var e="bsbi-atlas-map-controls-"+t;lt("<div>").appendTo(lt(this)).addClass(e),function(t,e){var a=lt("<div>").appendTo(t);function n(t,n,o,r){var s=lt("<div>").appendTo(a);s.attr("class","radio");var i=lt("<label>").appendTo(s);i.css("padding-left","0");var c=lt("<input>").appendTo(i),l=lt("<span>").appendTo(i);if(l.text(t),l.css("padding-left","20px"),r){var d=lt("<span>").appendTo(i);d.attr("id",r),d.css("padding-left","10px"),d.css("font-weight","bold")}c.attr("type","radio"),c.attr("name","bsbi-resolution-"+e),c.attr("class","bsbi-resolution-"+n),c.attr("value",n),c.css("margin-left",0),o&&c.prop("checked",!0),c.change((function(){vt=lt(this).val(),lt(".bsbi-resolution-"+vt).prop("checked",!0),_t(),Bt()}))}n("Hectads","hectad",!0),n("Tetrads","tetrad",!1)}(St(e="."+e,"atlas-resolution-control"),t),function(t,e){var a="png",n=lt("<div>").appendTo(t);n.addClass("atlas-save-map-image"),n.hide();var o=lt("<svg>").appendTo(n),r=lt("<text>").appendTo(o);r.attr("x","10"),r.attr("y","20"),lt("<br>").appendTo(n);var s=lt("<button>").appendTo(n);function i(t,o,r){var s=lt("<div>").appendTo(n);s.css("display","inline-block"),s.css("margin-left","0.5em"),s.attr("class","radio");var i=lt("<label>").appendTo(s);i.css("padding-left","0");var c=lt("<input>").appendTo(i),l=lt("<span>").appendTo(i);l.text(t),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","img-download-type-"+e),c.attr("class","img-download-type-"+o),c.attr("value",o),c.css("margin-left",0),r&&c.prop("checked",!0),c.change((function(){lt(".img-download-type-"+o).prop("checked",!0),a=o}))}s.addClass("btn btn-default"),s.text("Download image"),s.on("click",(function(){var t={text:M(st,!0),margin:10,fontSize:10};ct.saveMap("svg"===a,t,"atlas-image")})),i("PNG","png",!0),i("SVG","svg",!1)}(St(e,"atlas-image-button"),t),function(t,e){var a="csv",n=lt("<div>").appendTo(t);n.addClass("atlas-download-map-data"),n.hide();var o=lt("<button>").appendTo(n);function r(t,o,r){var s=lt("<div>").appendTo(n);s.css("display","inline-block"),s.css("margin-left","0.5em"),s.attr("class","radio");var i=lt("<label>").appendTo(s);i.css("padding-left","0");var c=lt("<input>").appendTo(i),l=lt("<span>").appendTo(i);l.text(t),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","download-type-"+e),c.attr("class","download-type-"+o),c.attr("value",o),c.css("margin-left",0),r&&c.prop("checked",!0),c.change((function(){lt(".download-type-"+o).prop("checked",!0),a=o}))}o.addClass("btn btn-default"),o.text("Download data"),o.on("click",(function(){("static"===gt?ct:it).downloadData("geojson"===a)})),r("CSV","csv",!0),r("GJSON","geojson",!1)}(St(e,"atlas-download-button"),t)}))}function Pt(){return ct}var Ot=jQuery;function Dt(t,e){function a(t,e){d3.select("#".concat(t)).attr("fill","rgb(".concat(255-255*Number(e)/100,",255,255)"));var a=220-Math.floor(e/100*220);d3.select("#".concat(t,"-path")).attr("fill","rgb(".concat(a,",").concat(a,",").concat(a,")"));var n=d3.select("#".concat(t)).select("title").attr("data-title");d3.select("#".concat(t)).select("title").text("".concat(n,": ").concat(e,"%")),d3.select("#".concat(t,"-path")).select("title").text("".concat(n,": ").concat(e,"%"))}e?(Ot("#".concat(t,"-swatches")).css("display",""),Ot("#".concat(t,"-no-trend")).css("display","none"),a("".concat(t,"_decline_strong"),e.declineStrong),a("".concat(t,"_decline_mod"),e.declineMod),a("".concat(t,"_stable"),e.stable),a("".concat(t,"_increase_mod"),e.increaseMod),a("".concat(t,"_increase_strong"),e.increaseStrong)):(Ot("#".concat(t,"-swatches")).css("display","none"),Ot("#".concat(t,"-no-trend")).css("display",""))}function zt(t,e,a){var n="M 2250 7256 l 0 -2813 l -61 -7 c -34 -3 -526 -6 -1093 -6 l -1031 -1 l 66 -62 c 36 -34 756 -714 1600 -1512 c 844 -797 1820 -1719 2169 -2049 c 349 -329 667 -630 705 -668 l 70 -68 l 230 217 c 1454 1373 3719 3512 4012 3790 l 373 353 l -1090 0 l -1090 0 l 0 2820 l 0 2820 l -2430 0 l -2430 0 l 0 -2814 z",o=[{svg:n,scale:.6,rot:180,text:"Strong decline",id:"".concat(t,"_decline_strong"),da:[100]},{svg:n,scale:.4,rot:180,text:"Moderate decline",id:"".concat(t,"_decline_mod"),da:[75,25]},{svg:"M 5 3968 c -3 -7 -4 -897 -3 -1978 l 3 -1965 l 2080 0 l 2080 0 l 0 1975 l 0 1975 l -2078 3 c -1657 2 -2079 0 -2082 -10 z",scale:.2,rot:45,text:"Stable",id:"".concat(t,"_stable"),da:[75,25]},{svg:n,scale:.4,rot:0,text:"Moderate increase",id:"".concat(t,"_increase_mod"),da:[75,25]},{svg:n,scale:.6,rot:0,text:"Strong increase",id:"".concat(t,"_increase_strong"),da:[75,25]}],r=d3.select("#".concat(t)).append("svg").attr("width",127).attr("height",27).style("overflow","visible").style("vertical-align","bottom").append("g");r.attr("transform","translate(1 1)");var s=r.append("g").attr("id","".concat(t,"-swatches")),i=r.append("text").attr("id","".concat(t,"-no-trend")).text("No trend").style("display","none").style("display","none").attr("text-anchor","middle").attr("x",62.5).attr("y",12.5).attr("dominant-baseline","mathematical");e&&(i.style("font-family",e),i.style("font-size",a)),r.append("rect").attr("width",125).attr("height",25).attr("stroke","grey").attr("fill","none").style("vertical-align","bottom"),o.forEach((function(t,e){if(s.append("rect").attr("id",t.id).attr("width",25).attr("height",25).attr("x",25*e).attr("fill","white").append("title").attr("data-title",t.text).text(t.text),t.svg){var a=s.append("path").attr("d",t.svg).style("visibility","hidden"),n=a.node().getBBox();a.remove();var o=25/n.width*t.scale,r=25*e+(25-n.width*o)/2,i=(25-n.height*o)/2,c=12.5+25*e;s.append("path").attr("id","".concat(t.id,"-path")).attr("d",t.svg).attr("transform","\n          rotate(".concat(t.rot,", ").concat(c,", ").concat(12.5,")\n          translate(").concat(r," ").concat(i,") \n          scale(").concat(o,")\n        ")).append("title").text(t.text)}})),s.style("display","none")}function Ft(t,e){return Ht.apply(this,arguments)}function Ht(){return(Ht=i(regeneratorRuntime.mark((function t(e,a){var n,o,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=function(t,e){var a=document.createElement("a");a.href=t,a.download=e,document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(a)},r=function(t){var e="http://www.w3.org/2000/xmlns/",a=t.node().cloneNode(!0);d3.select(a).selectAll("text").style("Minion Pro"),a.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),a.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");var n=(new window.XMLSerializer).serializeToString(a);return new Blob([n],{type:"image/svg+xml"})},o=function(t,e){var a=URL.createObjectURL(t),n="".concat(e,".svg");s(a,n)},n=d3.select("#".concat(e," svg")),t.abrupt("return",new Promise((function(t){var e=r(n);a&&o(e,a),t(e)})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Gt,Wt,qt,jt,Ut,Jt,Vt,Kt=jQuery,Qt=drupalSettings,Xt={identifier:"",name:null,shortName:null},Zt=!1,Yt="";function $t(){var t,e;Kt("#bsbi-atlas-download").css("display","flex"),Kt("<div>").appendTo(Kt("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-left").css("flex",1),Kt("<div>").appendTo(Kt("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-right").css("flex",1).css("margin-left","1em"),function(){var t=Kt("<div>").appendTo(Kt(".bsbi-atlas-taxon-selector"));t.addClass("atlas-taxon-selector-div");var e=Kt("<select>").appendTo(t);e.addClass("atlas-taxon-selector-sel");var a=d3.csv("".concat(Qt.bsbi_atlas.dataRoot,"bsbi/taxon_list.csv?prevent-cache=").concat(C)),n=d3.csv("".concat(Qt.bsbi_atlas.dataRoot,"bsbi/trends/aggregateMappings.csv?prevent-cache=").concat(C));Promise.all([a,n]).then((function(t){Gt=t[1];var a=t[0];a.forEach((function(t){var a="";t.vernacular&&(a="<b>"+t.vernacular+"</b> "),a+=t.formattedName;var n=Kt("<option>");n.attr("data-content",a),n.attr("value",t.ddbid),n.attr("data-taxon-name",t.taxonName),n.attr("data-is-hybrid",t.hybrid),n.attr("data-no-status",t.atlasNoStatus),n.html(a).appendTo(e)})),e.attr("data-size","10"),e.attr("data-live-search","true"),e.attr("data-header","Start typing the name of a taxon"),e.attr("title","Select a taxon"),e.selectpicker(),e.on("changed.bs.select",(function(){be(),Xt.identifier=Kt(this).val(),Xt.name=Kt(this).find(":selected").attr("data-content"),Xt.shortName=Kt(this).find(":selected").attr("data-taxon-name"),Xt.isHybrid="t"===Kt(this).find(":selected").attr("data-is-hybrid"),Xt.noStatus=""!==Kt(this).find(":selected").attr("data-no-status");var t="t"===Kt(this).find(":selected").attr("data-is-hybrid"),e=Jt.indexOf(Kt(this).val())>-1;p.showStatus=!t&&!e,ne(Xt.identifier),re(Xt.identifier),ie(Xt.identifier),le(Xt.identifier),pe(Xt.identifier)})),Vt=a.filter((function(t){return"t"===t.hybrid})).map((function(t){return t.ddbid})),Jt=a.filter((function(t){return""!==t.atlasNoStatus})).map((function(t){return t.ddbid}))}))}(),(t=Kt("<button>").appendTo(Kt("#bsbi-atlas-download-left"))).addClass("btn btn-default"),t.text("Download selected"),t.on("click",(function(){be();var t=te(Xt.shortName,Xt.identifier),e=Pt();Kt("#download-map").is(":checked")&&e.saveMap(!0,null,"".concat(t,"map")),Kt("#download-apparency").is(":checked")&&Wt.saveImage(!0,"".concat(t,"apparency")),Kt("#download-phenology").is(":checked")&&qt.saveImage(!0,"".concat(t,"phenology")),Kt("#download-altlat").is(":checked")&&jt.saveImage(!0,"".concat(t,"altlat")),Kt("#download-trend").is(":checked")&&(Ft("bsbi-long-trend-summary-gb","".concat(t,"trend-long-gb")),Ft("bsbi-long-trend-summary-ir","".concat(t,"trend-long-ir")),Ft("bsbi-short-trend-summary-gb","".concat(t,"trend-short-gb")),Ft("bsbi-short-trend-summary-ir","".concat(t,"trend-short-ir")))})),Kt("<hr/>").appendTo(Kt("#bsbi-atlas-download-left")),Kt("<p>").appendTo(Kt("#bsbi-atlas-download-left")).html("\n    For batch downloads, first select a CSV file from your computer\n    that has two (or three) columns: <i>taxonId</i> which has the ddbid for each \n    taxon and <i>taxon</i> which specifies a taxon name. \n    The taxon name is only used to name the file and\n    doesn't have to be exactly the same as \n    the name used elsewhere on the site. The ddbid will also be used \n    in the filename in case of any ambiguity. \n    If a third column - <i>staceOrder</i> - is specified, it is used at the\n    start of the filename.\n  "),(e=Kt("<input>").appendTo(Kt("#bsbi-atlas-download-left"))).attr("type","file"),e.attr("accept",".csv"),e.attr("id","bsbi-atlas-batch-file"),e.css("margin-bottom","1em"),e.on("change",(function(){!function(t){var e=new FileReader;e.addEventListener("load",(function(t){Ut=t.target.result})),e.readAsDataURL(t.target.files[0])}(event)})),function(){var t=Kt("<button>").appendTo(Kt("#bsbi-atlas-download-left"));t.addClass("btn btn-default"),t.text("Download batch"),t.on("click",(function(){be(),function(){ee.apply(this,arguments)}()}))}(),function(){var t=Kt("<button>").appendTo(Kt("#bsbi-atlas-download-left"));t.addClass("btn btn-default"),t.css("margin-left","1em"),t.text("Cancel"),t.on("click",(function(){Zt=!0}))}(),function(){var t=Kt("<button>").appendTo(Kt("#bsbi-atlas-download-left"));t.addClass("btn btn-default"),t.css("margin-left","1em"),t.text("Download problems"),t.on("click",(function(){var t=document.createElement("a"),e=new Blob([Yt],{type:"text/plain"});t.href=URL.createObjectURL(e),t.download="bulk-svg-error-log.txt",t.click(),URL.revokeObjectURL(t.href)}))}(),function(){var t=Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left"));t.css("margin-top","0.5em");var e=Kt("<label>").appendTo(t);e.attr("for","taxon-index-min"),e.text("Start index"),e.css("margin-right","0.5em");var a=Kt("<input>").appendTo(t);a.attr("type","number"),a.attr("id","taxon-index-min"),a.attr("min","1"),a.attr("value",1),a.css("width",60);var n=Kt("<label>").appendTo(t);n.attr("for","taxon-index-max"),n.text("End index"),n.css("margin","0 0.5em");var o=Kt("<input>").appendTo(t);o.attr("type","number"),o.attr("id","taxon-index-max"),o.attr("min","1"),o.attr("value",100),o.css("width",60);var r=Kt("<div>").appendTo(t);r.css("display","inline-block"),r.css("margin-left","1em"),r.attr("id","bsbi-atlas-download-counter")}(),Kt("<hr/>").appendTo(Kt("#bsbi-atlas-download-left")),ae("map","Map"),ae("apparency","Apparency"),ae("phenology","Phenology"),ae("altlat","Alt/Lat"),ae("trend","Trends"),function(){Kt('<div id="bsbiMapDownloadDiv" style="max-width: 500px">').appendTo(Kt("#bsbi-atlas-download-left")),Rt("#bsbiMapDownloadDiv");var t=Pt(),e=B("backdrop")?B("backdrop"):"colour_elevation",a=Qt.bsbi_atlas.dataRoot+"rasters/";"none"!==e&&t.basemapImage(e,!0,a+"".concat(e,".png"),a+"".concat(e,".pgw"));p.periodClasses="print"}(),Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left")).attr("id","bsbi-apparency-chart").css("max-width","400px"),Wt=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd",strokeWidth:"1.47pt"}],width:400,height:250,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",axisBottom:"off",showLegend:!1,interactivity:"none"}),Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left")).attr("id","bsbi-phenology-chart").css("max-width","400px"),qt=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,split:!0,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none",monthFontSize:"17.6pt",font:"Minion Pro",lineWidth:"0.735pt",displayLegend:!1}),function(){var t;Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left")).attr("id","bsbi-altlat-chart").css("max-width","600px");var e=(c(t={selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1–10%"},{min:10.00001,max:30,radius:14,legend:"11–30%"},{min:30.00001,max:40,radius:16,legend:"31–40%"},{min:40.00001,max:50,radius:18,legend:"41–50%"},{min:50.00001,max:100,radius:20,legend:"51–100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:65,right:20,top:45,bottom:57},showTaxonLabel:!1,showLegend:!0,interactivity:"none",axisLabelFontSize:12,legendFontSize:"22pt",legendSpacing:25},"axisLabelFontSize","22pt"),c(t,"axisTickFontSize","22pt"),c(t,"font","Minion Pro"),c(t,"lineWidth","0.972pt"),c(t,"yAxisLabelToTop",!0),c(t,"legendBaseline","mathematical"),c(t,"legendXoffset",1050),c(t,"legendYoffset",1180),t);jt=brccharts.altlat(e)}(),function(){function t(t,e){var a=Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left"));a.attr("id","bsbi-".concat(e,"-msg-").concat(t.toLowerCase())).css("max-width","600px"),a.text("".concat(t," ").concat(e)),Kt("<div>").appendTo(Kt("#bsbi-atlas-download-left")).attr("id","bsbi-".concat(e,"-trend-summary-").concat(t.toLowerCase())).css("max-width","600px")}t("GB","long"),t("IR","long"),t("GB","short"),t("IR","short")}()}function te(t,e,a){var n;return n=a?"".concat(a,"_"):"","".concat(n).concat(t.replace(/[^a-z0-9]/gi,"_").toLowerCase(),"_").concat(e.replace(/[^a-z0-9]/gi,"_"),"_")}function ee(){return(ee=i(regeneratorRuntime.mark((function t(){var e,a,n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d3.csv(Ut);case 2:e=t.sent,Zt=!1,Yt="",a=Kt("#taxon-index-min").val(),(n=Kt("#taxon-index-max").val())>e.length&&(n=e.length,Kt("#taxon-index-max").val(n)),o=regeneratorRuntime.mark((function t(a){var n,o,r,s,i,c,l,d,u,b,h,f,m,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Zt){t.next=2;break}return t.abrupt("return","break");case 2:return Kt("#bsbi-atlas-download-counter").text(a+1),n=e[a],o=te(n.taxon,n.taxonId,n.staceOrder),r=void 0,s=void 0,i=void 0,c=void 0,l=void 0,d=Vt.indexOf(n.taxonId)>-1,u=Jt.indexOf(n.taxonId)>-1,p.showStatus=!d&&!u,b=ne(n.taxonId,o).catch((function(t){return r=t})),h=re(n.taxonId,o).catch((function(t){return s=t})),f=ie(n.taxonId,o).catch((function(t){return i=t})),m=le(n.taxonId,o).catch((function(t){return c=t})),g=pe(n.taxonId,n.taxon,n.staceOrder).catch((function(t){return l=t})),t.next=16,Promise.all([b,h,f,m,g]).then((function(){if(r||s||i||c||l){var t="<b>".concat(a+1," ").concat(n.taxon," (").concat(n.taxonId,")</b>");Yt+="\r\n\r\n".concat(a+1," ").concat(n.taxon," (").concat(n.taxonId,")"),t+="<ul>",r&&(t+="<li>Map failed</li>",Yt+="\r\nMap failed"),s&&(t+="<li>Apparency chart failed</li>",Yt+="\r\nApparency chart failed"),i&&(t+="<li>Phenology chart failed</li>",Yt+="\r\nPhenology chart failed"),c&&(t+="<li>Altlat chart failed</li>",Yt+="\r\nPhenology chart failed"),l&&(t+="<li>Trends charts failed</li>",Yt+="\r\nPhenology chart failed"),Kt("<div>").appendTo(Kt("#bsbi-atlas-download-right")).html(t)}}));case 16:case"end":return t.stop()}}),t)})),r=a-1;case 10:if(!(r<n)){t.next=18;break}return t.delegateYield(o(r),"t0",12);case 12:if("break"!==t.t0){t.next=15;break}return t.abrupt("break",18);case 15:r++,t.next=10;break;case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ae(t,e){Kt('<input type="checkbox" id="download-'.concat(t,'" style="margin:0.5em" checked>')).appendTo(Kt("#bsbi-atlas-download-left")),Kt('<label for="download-'.concat(t,'">').concat(e,"</label>")).appendTo(Kt("#bsbi-atlas-download-left"))}function ne(t,e){return oe.apply(this,arguments)}function oe(){return(oe=i(regeneratorRuntime.mark((function t(e,a){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Pt(),!Kt("#download-map").is(":checked")){t.next=9;break}return Xt.identifier=e,Lt(Xt),t.next=6,Bt(!0);case 6:if(!a){t.next=9;break}return t.next=9,n.saveMap(!0,null,"".concat(a,"map"));case 9:return t.abrupt("return",Promise.resolve());case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function re(t,e){return se.apply(this,arguments)}function se(){return(se=i(regeneratorRuntime.mark((function t(e,a){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Kt("#download-apparency").is(":checked")){t.next=11;break}return n="".concat(Qt.bsbi_atlas.dataRoot,"bsbi/apparency/"),o=n+"all/"+e.replace(/\./g,"_")+".csv",t.next=5,d3.csv(o+"?prevent-cache=".concat(C));case 5:return r=t.sent,t.next=8,L(Wt,r);case 8:if(!a){t.next=11;break}return t.next=11,Wt.saveImage(!0,"".concat(a,"apparency"));case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ie(t,e){return ce.apply(this,arguments)}function ce(){return(ce=i(regeneratorRuntime.mark((function t(e,a){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Kt("#download-phenology").is(":checked")){t.next=13;break}return n=Qt.bsbi_atlas.dataRoot+"bsbi/captions/",o="".concat(n).concat(e.replace(/\./g,"_"),".csv"),t.next=5,d3.csv(o+"?prevent-cache=".concat(C));case 5:return r=t.sent,t.next=8,R(qt,r,null);case 8:if(!a){t.next=13;break}return d3.selectAll("#phen2-chart g.axis g.tick line").style("transform","translate(0, 0.1pt)"),d3.selectAll("#phen2-chart .phen-rect").style("transform","translate(0, 0.1pt)"),t.next=13,qt.saveImage(!0,"".concat(a,"phenology"));case 13:return t.abrupt("return",Promise.resolve());case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function le(t,e){return de.apply(this,arguments)}function de(){return(de=i(regeneratorRuntime.mark((function t(e,a){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Kt("#download-altlat").is(":checked")){t.next=11;break}return n=Qt.bsbi_atlas.dataRoot+"bsbi/maps/altlat/",o="".concat(n).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),t.next=5,d3.csv(o);case 5:return r=t.sent,t.next=8,I(jt,r);case 8:if(!a){t.next=11;break}return t.next=11,jt.saveImage(!0,"".concat(a,"altlat"));case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pe(t,e,a){return ue.apply(this,arguments)}function ue(){return(ue=i(regeneratorRuntime.mark((function t(e,a,n){var o,r,s,c,l,d,p,u,b,h,f,m,g,v,y,x,w,T,k,S,_,L,R,N,I,A,E,B;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Kt("#download-trend").is(":checked")){t.next=52;break}return o=function(){var t=i(regeneratorRuntime.mark((function t(e,a,n,o,r){var s,i,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s="GB"==o?16:7,i="".concat(o[0]).concat(o[1].toLowerCase()).concat(r[0].toUpperCase()).concat(r.substr(1)),t.next=4,Promise.allSettled([a,n,e]);case 4:"fulfilled"===(c=t.sent)[0].status&&"fulfilled"===c[2].status?"fulfilled"===c[1].status?Number(c[0].value[0][i])>=s?(Dt("bsbi-".concat(r,"-trend-summary-").concat(o.toLowerCase()),c[1].value[0]),Kt("#bsbi-".concat(r,"-msg-").concat(o.toLowerCase())).text("".concat(o," ").concat(r))):(Dt("bsbi-".concat(r,"-trend-summary-").concat(o.toLowerCase()),null),Kt("#bsbi-".concat(r,"-msg-").concat(o.toLowerCase())).text("".concat(o," ").concat(r," - hectad threshold not met (").concat(c[0].value[0][i],")"))):(Dt("bsbi-".concat(r,"-trend-summary-").concat(o.toLowerCase()),null),Kt("#bsbi-".concat(r,"-msg-").concat(o.toLowerCase())).text("".concat(o," ").concat(r," - no trend file"))):(Dt("bsbi-".concat(r,"-trend-summary-").concat(o.toLowerCase()),null),Kt("#bsbi-".concat(r,"-msg-").concat(o.toLowerCase())).text("".concat(o," ").concat(r," - trend count file absent")));case 6:case"end":return t.stop()}}),t)})));return function(e,a,n,o,r){return t.apply(this,arguments)}}(),r=function(t){return new Promise((function(e){setTimeout(e,t)}))},Kt("#bsbi-long-trend-summary-gb").html(""),Kt("#bsbi-long-trend-summary-ir").html(""),Kt("#bsbi-short-trend-summary-gb").html(""),Kt("#bsbi-short-trend-summary-ir").html(""),zt("bsbi-long-trend-summary-gb","Minion Pro","14pt"),zt("bsbi-long-trend-summary-ir","Minion Pro","14pt"),zt("bsbi-short-trend-summary-gb","Minion Pro","14pt"),zt("bsbi-short-trend-summary-ir","Minion Pro","14pt"),s=Gt.find((function(t){return t["mapped.ddb.id"]===e})),c=e,l=e,d=n,p=n,s&&"long"===s.analysisType&&(c=s["agg.ddb.id"],d+="_trendagg"),s&&"short"===s.analysisType&&(l=s["agg.ddb.id"],p+="_trendagg"),u=Qt.bsbi_atlas.dataRoot+"bsbi/trends/long/trends-summaries",b=Qt.bsbi_atlas.dataRoot+"bsbi/trends/short/trends-summaries",h=Qt.bsbi_atlas.dataRoot+"bsbi/trends/hectad-counts",f="".concat(u,"/Britain/").concat(c.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),m="".concat(u,"/Ireland/").concat(c.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),g="".concat(b,"/Britain/").concat(l.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),v="".concat(b,"/Ireland/").concat(l.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),y="".concat(h,"/").concat(c.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),x="".concat(h,"/").concat(l.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),w="".concat(h,"/").concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),T=d3.csv(y),k=d3.csv(x),S=d3.csv(w),_=d3.csv(f),L=d3.csv(m),R=d3.csv(g),N=d3.csv(v),I=o(S,T,_,"GB","long"),A=o(S,T,L,"IR","long"),E=o(S,k,R,"GB","short"),B=o(S,k,N,"IR","short"),t.next=41,Promise.all([I,A,E,B]);case 41:return t.next=43,r(1e3);case 43:if(!a){t.next=52;break}return t.next=46,Ft("bsbi-long-trend-summary-gb","".concat(te(a,e,d),"trend-long-gb"));case 46:return t.next=48,Ft("bsbi-long-trend-summary-ir","".concat(te(a,e,d),"trend-long-ir"));case 48:return t.next=50,Ft("bsbi-short-trend-summary-gb","".concat(te(a,e,p),"trend-short-gb"));case 50:return t.next=52,Ft("bsbi-short-trend-summary-ir","".concat(te(a,e,p),"trend-short-ir"));case 52:return t.abrupt("return",Promise.resolve());case 53:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function be(){Kt("#download-map").is(":checked")||Pt().clearMap();Kt("#download-apparency").is(":checked")||Wt.setChartOpts({data:[]}),Kt("#download-phenology").is(":checked")||qt.setChartOpts({data:[]}),Kt("#download-altlat").is(":checked")||jt.setChartOpts({data:[]}),Kt("#download-trend").is(":checked")||(Kt("#bsbi-long-trend-summary-gb").html(""),Kt("#bsbi-long-trend-summary-ir").html(""),Kt("#bsbi-short-trend-summary-gb").html(""),Kt("#bsbi-short-trend-summary-ir").html(""))}var he=jQuery,fe=drupalSettings;console.log("Running ".concat(o," version ").concat(r)),function(){var t=[],a={identifier:null,name:null,shortName:null,tetrad:null,noStatus:null,isHybrid:!1,hybridMapping:!1,longTrendAgg:null,shortTrendAgg:null,longTrendAggName:null,shortTrendAggName:null,trendAggTaxa:null,trendAggTaxaNames:null},o=["statusGB","statusIE","statusCI","csRedListEngland","csRedListWales","csRedListIreland","csRedDataList2005","csRedDataList2021","csRareScarceIr2020","csRareScarceGb2020"];function r(t){var e=he("#bsbi-atlas-section-"+t),a=he('<div class=".container-fluid">').appendTo(e),n=he('<div class="row">').appendTo(a),o=he('<div class="col-sm-8">').appendTo(n),r=he('<div class="col-sm-4">').appendTo(n);o.append('<div id="bsbiMapDiv" width="100%"></div>'),o.append('<div id="dotCaption" width="100%" style="margin-top:1em"></div>'),he('<div class="bsbi-selected-taxon-name bsbi-section-summary"></div>').appendTo(r).css("font-size","1.3em"),r.append("<hr/>"),r.append('<div id="bsbi-caption"></div>'),Rt("#bsbiMapDiv"),Mt(".bsbi-atlas-map-controls"),_t()}function s(t){he("#bsbi-atlas-section-"+t).append('<div id="bsbi-conservation"></div>'),function(t){console.log("Creating");var e,a=at(t),n=at('<table id="bsbi-conservation-table">').appendTo(a);e=at("<tr>").appendTo(n),at('<td style="font-weight: bold">').text("Rarity").appendTo(e),at('<td style="font-weight: bold">').text("Categories").appendTo(e),at('<td style="font-weight: bold">').text("Links").appendTo(e),e=at("<tr>").appendTo(n),at("<td>").html('Rare or scarce Great Britain (revised 2022)<span class="ss">1</span>').appendTo(e),at('<td id="bsbi-conservation-rarity-gb">').appendTo(e),at("<td>").appendTo(e),e=at("<tr>").appendTo(n),at("<td>").html('Rare or scarce Ireland (revised 2022)<span class="ss">2</span>').appendTo(e),at('<td id="bsbi-conservation-rarity-ir">').appendTo(e),at("<td>").appendTo(e),e=at("<tr>").appendTo(n),at('<td colspan="3">').appendTo(e),e=at("<tr>").appendTo(n),at('<td style="font-weight: bold">').html('Threat<span class="ss">3</span>').appendTo(e),at("<td>").appendTo(e),at("<td>").appendTo(e),e=at("<tr>").appendTo(n),at("<td>").text("Great Britain Red List (revised Feb 2021)").appendTo(e),at('<td id="bsbi-conservation-threat-gb">').appendTo(e);var o=i("https://hub.jncc.gov.uk/assets/cc1e96f8-b105-4dd0-bd87-4a4f60449907"),r=i("https://bsbi.org/taxon-lists");at("<td>").appendTo(e).html("".concat(o[0].outerHTML," (revised Feb 2021 ").concat(r[0].outerHTML,")")),e=at("<tr>").appendTo(n),at("<td>").text("England Red List (2014)").appendTo(e),at('<td id="bsbi-conservation-threat-en">').appendTo(e),at("<td>").appendTo(e).append(i("https://bsbi.org/england")),e=at("<tr>").appendTo(n),at("<td>").text("Wales Red List (2008)").appendTo(e),at('<td id="bsbi-conservation-threat-wa">').appendTo(e),at("<td>").appendTo(e).append(i("https://www.plantlife.org.uk/uk/our-work/publications/vascular-plant-red-data-list-wales")),e=at("<tr>").appendTo(n),at("<td>").text("Ireland Red List (2015)").appendTo(e),at('<td id="bsbi-conservation-threat-ir">').appendTo(e),at("<td>").appendTo(e).append(i("https://www.npws.ie/publications/red-lists")),e=at("<tr>").appendTo(n),at('<td colspan="3">').appendTo(e),e=at("<tr>").appendTo(n),at('<td style="font-weight: bold">').text("Conservation designation").appendTo(e),at("<td>").appendTo(e),at("<td>").appendTo(e),e=at("<tr>").appendTo(n),at("<td>").text("Schedule 8 (Great Britain)").appendTo(e),at('<td id="bsbi-conservation-designation-gb-sched8">').appendTo(e),at("<td>").appendTo(e).append(i("https://www.legislation.gov.uk/ukpga/1981/69/schedule/8")),e=at("<tr>").appendTo(n),at("<td>").text("Schedule 8 (Northern Ireland)").appendTo(e),at('<td id="bsbi-conservation-designation-ni-sched8">').appendTo(e),at("<td>").appendTo(e).append(i("https://www.legislation.gov.uk/nisi/1985/171/contents")),e=at("<tr>").appendTo(n),at("<td>").text("Irish Flora (Protection) Order (revised 2022)").appendTo(e),at('<td id="bsbi-conservation-designation-ifpo">').appendTo(e),at("<td>").appendTo(e).append(i("https://cedrec.com/legislation/56058/56059/fulltext")),e=at("<tr>").appendTo(n),at("<td>").text("England NERC list (Section 41)").appendTo(e),at('<td id="bsbi-conservation-designation-en-s41">').appendTo(e),at("<td>").appendTo(e).append(i("http://publications.naturalengland.org.uk/publication/4958719460769792")),e=at("<tr>").appendTo(n),at("<td>").text("Wales NERC list (Section 7)").appendTo(e),at('<td id="bsbi-conservation-designation-wa-s41">').appendTo(e),at("<td>").appendTo(e).append(i("https://www.biodiversitywales.org.uk/Section-7"));var s=at('<div style="font-size: 0.8em; margin: 0.5em 0 1em 0">').appendTo(a);function i(t){var e=at("<a>");return e.attr("href",t),e.attr("target","_blank"),e.text(t),e}at('<span style="vertical-align: super">').text("1").appendTo(s),at("<span>").text(" Rare - species recorded in 15 or fewer hectads in GB 2000-2019; scarce - species recorded in 16-100 hectads in GB 2000-2019; not rare or scarce - species recorded in more than 100 hectads in GB 2000-2019.").appendTo(s),s.append(at("<br/>")),at('<span style="vertical-align: super">').text("2").appendTo(s),at("<span>").text(" Rare - species recorded in 10 or fewer hectads in Ireland 2000-2019; scarce - species recorded in 11-25 hectads in Ireland 2000-2019; not rare or scarce - species recorded in more than 25 hectads in Ireland 2000-2019.").appendTo(s),s.append(at("<br/>")),at('<span style="vertical-align: super">').text("3").appendTo(s),at("<span>").text(" EX – extinct; EW – extinct in the wild; RE – regionally extinct; CR – critically endangered; EN – endangered; VU – vulnerable; NT – near threatened; LC – least concern; WL – waiting list; PL – parking list.").appendTo(s),at("<p>").appendTo(a).text("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")}("#bsbi-conservation")}function c(t){he("#bsbi-atlas-section-"+t).append('<div id="bsbi-trends"></div>'),function(t){J('<h4 id="bsbiTrendsTitle">').appendTo(J(t)).text(""),J('<p id="bsbiTrendsAggNote">').appendTo(J(t)).text("");var e=J("<div>").appendTo(J(t));e.attr("class","phenRow");var a=J("<div>").appendTo(J(t));a.attr("class","phenRow"),J("<p>").appendTo(J(t)).html("\n  The trends above rely on the frequency scaling using local occupancy (“Frescalo”) approach of Hill (2012). \n  The method was designed to adjust for locally variable recording effort across time periods, \n  and has been used on many distribution datasets (Pescott et al., 2019). Here, we apply \n  Frescalo to vascular plant data gridded at the 10 km scale within the following time \n  periods: 1930–69; 1987–99; 2000–09; 2010–19. These are a subset of the “date-classes” used \n  by the BSBI to organise their data, and roughly designate multi-year periods within which \n  specific national recording projects occurred (Preston et al., 2002).\n  "),J("<p>").appendTo(J(t)).html("\n  Outputs from the Frescalo model include per taxon/time period estimates of mean relative occupancy and \n  their standard deviations. Below, we plot these estimates (filled white circles with black lines) \n  in Figures 1 and 2, along with a GAM smoother (Fig. 1) and a Monte Carlo-based 100-member set of \n  linear regressions compatible with these (Fig. 2). The trend magnitude frequency chart in Figure \n  3 is based on discretising the compatible linear trend set displayed in Figure 2, in order to \n  more clearly display the model-based uncertainty associated with the Frescalo outputs. \n  Pescott et al. (2022) describe the rationale for this in more detail. Finally, Figure 4 … [TO BE COMPLETED].\n  "),J("<p>").appendTo(J(t)).html("\n  [NEW PARAGRAPH: OTHER TEXT ABOUT DECISIONS WITH REGARDS TO INCLUDING AND EXCLUDING SPECIES IN MODELLING AND/OR DISPLAY]\n  "),J("<h4>").appendTo(J(t)).text("References"),J("<p>").appendTo(J(t)).html("\n  Hill, M.O. 2012. Local frequency as a key to interpreting species occurrence data when recording effort is not known. \n  <i>Methods in Ecology and Evolution</i> 3, 195–205.\n  "),J("<p>").appendTo(J(t)).html('\n  Pescott, O.L., Humphrey, T.A., Stroh, P.A., Walker, K.J. 2019. Temporal changes in distributions and the species \n  atlas: How can British and Irish plant data shoulder the inferential burden? <i>British & Irish Botany</i> 1, 250–282. \n  <a href="https://doi.org/10.33928/bib.2019.01.250" target="_blank">https://doi.org/10.33928/bib.2019.01.250</a>\n  '),J("<p>").appendTo(J(t)).html('\n  Pescott, O.L., Stroh, P.A., Humphrey, T.A. and Walker, K.J. 2022. Simple methods for improving the communication \n  of uncertainty in species’ temporal trends. <i>Ecological Indicators</i>, 141, 109117. \n  <a href="https://doi.org/10.1016/j.ecolind.2022.109117" target="_blank">https://doi.org/10.1016/j.ecolind.2022.109117</a>\n  '),J("<p>").appendTo(J(t)).html("\n  Preston, C.D., Pearman, D.A., Dines, T.D. (Eds.) 2002. <i>New Atlas of the British and Irish Flora</i>. Oxford University \n  Press, Oxford, England.\n  ");var n=J("<div>").appendTo(e);n.attr("id","bsbi-gam-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 1"),D=brccharts.trend2({selector:"#bsbi-gam-chart",data:[],means:[],width:350,height:250,margin:{left:50,right:10,top:10,bottom:55},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Relative frequency",axisLabelFontSize:12,style:{vStroke:"blue",vStrokeWidth:2,cStroke:"grey",cStrokeWidth:.5,cFill:"rgb(230,230,230)",mRad:3,mFill:"white",mStroke:"black",sdStroke:"black"}}),(G=J("<div>").appendTo(n)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var o=J("<div>").appendTo(e);o.attr("id","bsbi-linmod-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 2"),z=brccharts.trend3({selector:"#bsbi-linmod-chart",data:[],means:[],width:350,height:250,margin:{left:50,right:10,top:10,bottom:55},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Relative frequency",axisLabelFontSize:12,style:{vStroke:"blue",vStrokeWidth:2,vOpacity:.05,mRad:3,mFill:"white",mStroke:"black",sdStroke:"black"}}),(W=J("<div>").appendTo(o)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var r=J("<div>").appendTo(a);r.attr("id","bsbi-density-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 3"),H=brccharts.density({selector:"#bsbi-density-chart",data:[],ylines:[],xlines:[],width:350,height:250,padding:.1,margin:{left:50,right:10,top:10,bottom:45},expand:!0,axisLeft:"on",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Density",axisBottomLabel:"Slope",axisLabelFontSize:12,styles:[{stroke:"blue",strokeWidth:1},{stroke:"grey",strokeWidth:1}]}),(j=J("<div>").appendTo(r)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var s=J("<div>").appendTo(a);s.attr("id","bsbi-bar-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 4"),F=brccharts.bar({selector:"#bsbi-bar-chart",data:[],width:350,height:250,padding:.1,margin:{left:50,right:10,top:10,bottom:85},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"none",axisTop:"none",axisLeftLabel:"Frequency",axisLabelFontSize:12,labelPosition:{"text-anchor":"end",dx:"-1em",dy:"0.2em",transform:"rotate(-55)"}}),(q=J("<div>").appendTo(s)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none")}("#bsbi-trends"),$(".bsbi-atlas-trend-controls")}function l(t){he("#bsbi-atlas-section-"+t).append('<div id="bsbi-phenology"></div>'),function(t){var e=S("<div>").appendTo(S(t)),a=S("<div>").appendTo(S(t));a.attr("id","bsbi-phenology-source"),a.css("font-size","0.8em"),a.css("margin-bottom","0.8em"),S("<p>").appendTo(S(t)).text("Explanation of apparency and phenology charts. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a."),e.attr("class","phenRow");var n=S("<div>").appendTo(e);n.attr("class","phenColumn");var o=S("<div>").appendTo(e);o.attr("class","phenColumn");var r=S("<div>").appendTo(n);r.css("position","relative"),S("<div>").appendTo(r).attr("id","bsbi-apparency-chart").css("max-width","400px");var s=S("<div>").appendTo(r);s.attr("id","bsbi-apparency-chart-no-data"),s.css("display","none"),s.css("position","absolute"),s.css("top","50px"),s.css("width","100%"),s.css("text-align","center"),s.text("No data available for chart"),y=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd"}],width:400,height:303,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",showLegend:!1,interactivity:"none",font:"Arial",monthFontSize:11}),S("<div>").appendTo(n).attr("id","bsbi-phenology-chart").css("max-width","400px"),x=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,split:!0,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none",font:"Arial",monthFontSize:11});var i=S("<div>").appendTo(o);i.css("position","relative"),S("<div>").appendTo(i).attr("id","bsbi-apparency-by-lat-chart").css("max-width","400px");var c=S("<div>").appendTo(i);c.attr("id","bsbi-apparency-by-lat-chart-no-data"),c.css("display","none"),c.css("position","absolute"),c.css("top","50px"),c.css("width","100%"),c.css("text-align","center"),c.text("No data available for chart"),w=brccharts.phen1({selector:"#bsbi-apparency-by-lat-chart",data:[],taxa:["taxon"],metrics:[],lines:["white","white","#dddddd","white","white","#dddddd","white","white","#dddddd","white","white","#dddddd"],width:400,height:410,spread:!0,perRow:1,expand:!0,showTaxonLabel:!1,showLegend:!1,interactivity:"mousemove",margin:{left:40,right:0,top:20,bottom:5},axisLeftLabel:"Latitudinal band",axisLabelFontSize:12,font:"Arial",monthFontSize:12}),S(".brc-chart-phen1").css("overflow","visible"),S("#bsbi-apparency-by-lat-chart .phen-path").css("stroke-width",1)}("#bsbi-phenology"),_(".bsbi-atlas-phenology-controls")}function d(t){he("#bsbi-atlas-section-"+t).append('<div id="bsbi-altitude"></div>'),function(t){var e=S("<div>").appendTo(S(t));e.css("position","relative");var a=S("<div>").appendTo(e);a.attr("id","bsbi-altlat-chart-no-data"),a.css("display","none"),a.css("position","absolute"),a.css("top","50px"),a.css("width","100%"),a.css("max-width","600px"),a.css("text-align","center"),a.text("No data available for chart");var n=S("<div>").appendTo(e);S("<p>").appendTo(S(t)).text("Explanation of latitude/altitude chart. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a."),n.attr("id","bsbi-altlat-chart"),n.css("max-width","600px"),T=brccharts.altlat({selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1–10%"},{min:10.00001,max:30,radius:14,legend:"11–30%"},{min:30.00001,max:40,radius:16,legend:"31–40%"},{min:40.00001,max:50,radius:18,legend:"41–50%"},{min:50.00001,max:100,radius:20,legend:"51–100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:55,right:10,top:20,bottom:35},showTaxonLabel:!1,showLegend:!0,axisLabelFontSize:12,legendFontSize:10,interactivity:"toggle"})}("#bsbi-altitude")}function u(t){var e=he("#bsbi-atlas-section-"+t);e.append('<div id="bsbi-gallery" class="inline-gallery-container"></div>'),he('<div id="bsbi-gallery-copyright"></div>').appendTo(e).text("Copyright Rob Still/Chris Gibson"),he("#bsbi-gallery-copyright").hide()}function b(t){var e=t;return fe.bsbi_atlas.dataBsbidb,e=(e=e.replace(/object.php\?entityid=/g,"atlas/")).replace(/&amp;class=TaxonInstance/g,"")}function h(){!function(t,a){if(a){var o=t+"bsbi/apparency/",r=t+"bsbi/captions/",s=o+"all/"+a.replace(/\./g,"_")+".csv";n.csv(s+"?prevent-cache=").then((function(t){L(y,t),S("#bsbi-apparency-chart").css("opacity",1),S("#bsbi-apparency-chart-no-data").hide()})).catch((function(){console.warn("Apparency chart failed for ".concat(s,". Error message:"),e),y.setChartOpts({data:[]}),S("#bsbi-apparency-chart").css("opacity",.5),S("#bsbi-apparency-chart-no-data").show()}));var i=o+"byLat/"+a.replace(/\./g,"_")+".csv";n.csv(i+"?prevent-cache=").then((function(t){N(w,k=t),S("#bsbi-apparency-by-lat-chart").css("opacity",1),S("#bsbi-apparency-by-lat-chart-no-data").hide()})).catch((function(){console.warn("Apparency by latitude chart failed for ".concat(i,". Error message:"),e),w.setChartOpts({data:[],metrics:[],spread:!1}),S("#bsbi-apparency-by-lat-chart").css("opacity",.5),S("#bsbi-apparency-by-lat-chart-no-data").show()}));var c="".concat(r).concat(a.replace(/\./g,"_"),".csv");n.csv(c+"?prevent-cache=".concat(C)).then((function(t){R(x,t,"bsbi-phenology-source")}))}}(fe.bsbi_atlas.dataRoot,a.identifier)}function f(){!function(t,e){if(e){var a="".concat(t+"bsbi/maps/","altlat/").concat(e.replace(/\./g,"_"),".csv");n.csv(a).then((function(t){return S("#bsbi-altlat-chart").css("opacity",1),S("#bsbi-altlat-chart-no-data").hide(),I(T,t)})).catch((function(t){console.warn("altlat chart failed for ".concat(a,". Error message:"),t),T.setChartOpts({data:[]}),S("#bsbi-altlat-chart").css("opacity",.25),S("#bsbi-altlat-chart-no-data").show()}))}}(fe.bsbi_atlas.dataRoot,a.identifier)}function m(){var t;t=a,console.log("update conservation table ",t),at("#bsbi-conservation-rarity-gb").text(t.csRareScarceGb2020?t.csRareScarceGb2020:"not rare or scarce"),at("#bsbi-conservation-rarity-ir").text(t.csRareScarceIr2020?t.csRareScarceIr2020:"not rare or scarce"),at("#bsbi-conservation-threat-gb").text(t.csRedDataList2021),at("#bsbi-conservation-threat-en").text(t.csRedListEngland),at("#bsbi-conservation-threat-wa").text(t.csRedListWales),at("#bsbi-conservation-threat-ir").text(t.csRedListIreland),at("#bsbi-conservation-designation-gb-sched8").text(""),at("#bsbi-conservation-designation-ni-sched8").text(""),at("#bsbi-conservation-designation-ifpo").text(""),at("#bsbi-conservation-designation-en-s41").text(""),at("#bsbi-conservation-designation-wa-s41").text("")}function g(){Y(a)}function E(){if(a.identifier){var t=fe.bsbi_atlas.dataRoot+"bsbi/trends/long/trends-summaries",e=fe.bsbi_atlas.dataRoot+"bsbi/trends/short/trends-summaries",o=fe.bsbi_atlas.dataRoot+"bsbi/trends/hectad-counts",r=a.longTrendAgg?a.longTrendAgg:a.identifier,s=a.shortTrendAgg?a.shortTrendAgg:a.identifier,i="".concat(t,"/Britain/").concat(r.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),c="".concat(t,"/Ireland/").concat(r.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),l="".concat(e,"/Britain/").concat(s.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),d="".concat(e,"/Ireland/").concat(s.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),p="".concat(o,"/").concat(r.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),u="".concat(o,"/").concat(s.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),b=he("#trend-summaries");b.html(""),b.css("margin-bottom","0.5em"),he("<div>").text("Post-1930 effort-adjusted 10 km trends").appendTo(b).css("margin-bottom","0.2em");var h=he("<table>").appendTo(b),f=he("<tr>").appendTo(h);he("<td>").appendTo(f).text("Britain:"),he("<td>").attr("id","trend-sum-gb-long").css("padding","0.1em 0 0.1em 0.1em").appendTo(f),zt("trend-sum-gb-long");var m=he("<tr>").appendTo(h);if(he("<td>").appendTo(m).text("Ireland:"),he("<td>").attr("id","trend-sum-ir-long").css("padding","0.1em 0 0.1em 0.1em").appendTo(m),zt("trend-sum-ir-long"),a.longTrendAgg){var g=he('<div style="font-size: 0.8em">').appendTo(b);tt(a,"long",g)}he("<div>").text("Post-1987 effort-adjusted 10 km trends").appendTo(b).css("margin","0.4em 0 0.2em 0");var v=he("<table>").appendTo(b),y=he("<tr>").appendTo(v);he("<td>").appendTo(y).text("Britain:"),he("<td>").attr("id","trend-sum-gb-short").css("padding","0.1em 0 0.1em 0.1em").appendTo(y),zt("trend-sum-gb-short");var x=he("<tr>").appendTo(v);if(he("<td>").appendTo(x).text("Ireland:"),he("<td>").attr("id","trend-sum-ir-short").css("padding","0.1em 0 0.1em 0.1em").appendTo(x),zt("trend-sum-ir-short"),a.shortTrendAgg){var w=he('<div style="font-size: 0.8em">').appendTo(b);tt(a,"short",w)}var T=n.csv(i),k=n.csv(c),S=n.csv(l),_=n.csv(d),L=n.csv(p),R=n.csv(u);Promise.allSettled([T,k,S,_,L,R]).then((function(t){var e=t[0],a=t[1],n=t[2],o=t[3],r=t[4],s=t[5];"fulfilled"===r.status&&Number(r.value[0].GbLong)>=16&&"fulfilled"===e.status?Dt("trend-sum-gb-long",e.value[0]):Dt("trend-sum-gb-long",null),"fulfilled"===r.status&&Number(r.value[0].IrLong)>=7&&"fulfilled"===a.status?Dt("trend-sum-ir-long",a.value[0]):Dt("trend-sum-ir-long",null),"fulfilled"===s.status&&Number(s.value[0].GbShort)>=16&&"fulfilled"===n.status?Dt("trend-sum-gb-short",n.value[0]):Dt("trend-sum-gb-short",null),"fulfilled"===s.status&&Number(s.value[0].IrShort)>=7&&"fulfilled"===o.status?Dt("trend-sum-ir-short",o.value[0]):Dt("trend-sum-ir-short",null)}))}}function B(t){alert("link to ecoflora for: "+t)}function P(t){alert("link to world flora online for: "+t)}o.forEach((function(t){a[t]=null})),Lt(a),he(document).ready((function(){addEventListener("popstate",(function(t){t.state&&t.state.identifier&&he(".atlas-taxon-selector-sel").selectpicker("val",t.state.identifier)})),"/download"===location.pathname?$t():(v("title","BSBI Online Plant Atlas 2020"),v("authors","Stroh, P. A., Humphrey, T., Burkmar, R. J., Pescott, O. L., , Roy, D.B., and Walker, K. J."),v("author","Stroh, P. A."),v("author","Humphrey, T."),v("author","Burkmar, R. J."),v("author","Pescott, O. L."),v("author","Roy, D. B."),v("author","Walker, K. J."),v("year","2022"),v("url",location.origin+"/atlas"),function(){p.periodClasses="standard";var e=[{group:null,id:"summary",title:"Summary",fn:r},{group:null,id:"conservation",title:"Conservation",fn:s},{group:null,id:"gallery",title:"Gallery",fn:u},{group:null,id:"trends",title:"Trends",fn:c},{group:"CHARACTERISTICS",id:"phenology",title:"Phenology",fn:l},{group:"CHARACTERISTICS",id:"ecology",title:"Altitude",fn:d},{group:"EXTERNAL LINKS",id:"ecoflora",title:"EcoFlora",fn:B,external:!0},{group:"EXTERNAL LINKS",id:"worldfloraonline",title:"World Flora Online",fn:P,external:!0}];!function(){var e=he("<div>").appendTo(he(".bsbi-atlas-taxon-selector"));e.addClass("atlas-taxon-selector-div");var r=he("<select>").appendTo(e);r.addClass("atlas-taxon-selector-sel");var s=he("<button>").appendTo(e);s.addClass("atlas-taxon-selector-link"),s.attr("title","Copy link for taxon into clipboard"),s.addClass("btn btn-default"),s.html("&#128279;"),s.css("padding","6px 6px"),s.on("click",(function(){a.identifier&&A(location.origin+"/atlas/"+a.identifier)}));var c=n.csv("".concat(fe.bsbi_atlas.dataRoot,"bsbi/taxon_list.csv?prevent-cache=").concat(C)),l=n.csv("".concat(fe.bsbi_atlas.dataRoot,"bsbi/trends/aggregateMappings.csv?prevent-cache=").concat(C));Promise.all([c,l]).then((function(e){var s=e[1];(t=e[0]).forEach((function(t){var e="";t.vernacular&&(e="<b>"+t.vernacular+"</b> "),e+=t.formattedName;var a=he("<option>");a.attr("data-content",e),a.attr("value",t.ddbid),a.attr("data-taxon-name",t.taxonName),a.attr("data-vernacular",t.vernacular),a.attr("data-is-hybrid",t.hybrid),a.attr("data-no-status",t.atlasNoStatus);var n=t.hybridParentIds.split(";"),o=2===t.hybridParents.split(";").length&&2===n.length;a.attr("data-hybrid-mapping",o);var i=s.find((function(e){return e["mapped.ddb.id"]===t.ddbid}));if(i){"long"===i.analysisType&&(a.attr("data-long-trend-agg",i["agg.ddb.id"]),a.attr("data-long-trend-agg-name",i["agg.fullName"])),"short"===i.analysisType&&(a.attr("data-short-trend-agg",i["agg.ddb.id"]),a.attr("data-short-trend-agg-name",i["agg.fullName"]));var c=s.filter((function(t){return t["agg.ddb.id"]===i["agg.ddb.id"]})).map((function(t){return t["mapped.ddb.id"]})),l=s.filter((function(t){return t["agg.ddb.id"]===i["agg.ddb.id"]})).map((function(t){return t["mapped.fullName"]}));a.attr("data-trend-agg-taxa",c.join(",")),a.attr("data-trend-agg-taxa-names",l.join(","))}a.html(e).appendTo(r)})),r.attr("data-size","10"),r.attr("data-live-search","true"),r.attr("data-header","Start typing the name of a taxon"),r.attr("title","Select a taxon"),r.selectpicker(),r.on("changed.bs.select",(function(e,r,s,c){a.identifier!==he(this).val()&&(a.identifier=he(this).val(),a.name=he(this).find(":selected").attr("data-content"),a.shortName=he(this).find(":selected").attr("data-taxon-name"),a.isHybrid="t"===he(this).find(":selected").attr("data-is-hybrid"),a.noStatus=""!==he(this).find(":selected").attr("data-no-status"),a.hybridMapping="true"===he(this).find(":selected").attr("data-hybrid-mapping"),a.longTrendAgg=he(this).find(":selected").attr("data-long-trend-agg"),a.shortTrendAgg=he(this).find(":selected").attr("data-short-trend-agg"),a.longTrendAggName=he(this).find(":selected").attr("data-long-trend-agg-name"),a.shortTrendAggName=he(this).find(":selected").attr("data-short-trend-agg-name"),a.trendAggTaxa=he(this).find(":selected").attr("data-trend-agg-taxa"),a.trendAggTaxaNames=he(this).find(":selected").attr("data-trend-agg-taxa-names"),r&&window.history.pushState({identifier:a.identifier},"BSBI Atlas - ".concat(a.shortName),"/atlas/".concat(a.identifier)),Lt(a),_t(),Bt(),function(){var e=he("#bsbi-caption");e.html("");var r=fe.bsbi_atlas.dataRoot+"bsbi/captions/",s="".concat(r).concat(a.identifier.replace(/\./g,"_"),".csv?prevent-cache=").concat(C);n.csv(s).then((function(n){var r,s,c=(r=n[0].vernacular,s=n[0].formattedName,"<b>".concat(r,"</b> ").concat(s));if(he(".bsbi-selected-taxon-name").html("".concat(c)),n[0].atlasSpeciesDescription&&(he("<p>").appendTo(e).append(b(n[0].atlasSpeciesDescription)),he("<p>").appendTo(e)),n[0].captionedChildTaxonIds){e.append('<h4>Taxa covered <span id="bsbi-taxa-covered-toggle">[show]</span></h4>');var l=he('<ul id="bsbi-taxa-covered-list">').appendTo(e);n[0].captionedChildTaxonIds.split(";").forEach((function(e){var a=he("<li>").appendTo(l),n=t.find((function(t){return t.ddbid===e}));if(n){var o=he("<i>").appendTo(a),r=he("<a>").appendTo(o);r.attr("href","/atlas/".concat(e)),r.attr("alt","Link to ".concat(n.taxonName)),r.text(n.taxonName)}}));var d=!1;he("#bsbi-taxa-covered-toggle").click((function(){(d=!d)&&(he("#bsbi-taxa-covered-list").show(),he("#bsbi-taxa-covered-toggle").html("[hide]")),d||(he("#bsbi-taxa-covered-list").hide(),he("#bsbi-taxa-covered-toggle").html("[show]"))}))}if(n[0].atlasSpeciesTrends&&(e.append("<h4>Trends</h4>"),he("<div>").attr("id","trend-summaries").appendTo(e),E(),he("<p>").appendTo(e).append(b(n[0].atlasSpeciesTrends))),n[0].atlasSpeciesBiogeography&&(e.append("<h4>Biogeography</h4>"),he("<p>").appendTo(e).append(b(n[0].atlasSpeciesBiogeography))),o.forEach((function(t){a[t]=n[0][t]})),m(),n[0].hybridParents){var p=function(){var t=i(regeneratorRuntime.mark((function t(e){var a,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=fe.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(C),t.next=4,fetch(n,{method:"HEAD"});case 4:return o=t.sent,t.abrupt("return",o.ok);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();e.append("<h4>Hybrid parents</h4>");var u=he("<ul>").appendTo(e),h=n[0].hybridParents.split(";"),f=n[0].hybridParentIds.split(";");h.forEach(function(){var t=i(regeneratorRuntime.mark((function t(e,a){var n,o,r,s,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f[a]?f[a]:"",t.next=3,p(n);case 3:o=t.sent,r=he("<li>").appendTo(u),s=he("<i>").appendTo(r),o?((i=he("<a>").appendTo(s)).attr("href","/atlas/".concat(n)),i.attr("alt","Link to ".concat(e)),i.text(e)):s.text(e);case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())}if(n[0].captionAuthors){e.append("<h4>Authors</h4>");for(var g,y=he("<p>").appendTo(e),x=n[0].captionAuthors.split(";"),w=0;w<x.length;w++)g=0===w?x[w]:w===x.length-1?"".concat(g," and ").concat(x[w]):"".concat(g,", ").concat(x[w]);y.text(g)}e.append('<h4>References <span id="bsbi-reference-toggle">[show]</span></h4>'),he('<div id="bsbi-reference-div">').appendTo(e).html(n[0].captionRefs);var T=!1;he("#bsbi-reference-toggle").click((function(){(T=!T)&&(he("#bsbi-reference-div").show(),he("#bsbi-reference-toggle").html("[hide]")),T||(he("#bsbi-reference-div").hide(),he("#bsbi-reference-toggle").html("[show]"))})),e.append('<h4>Recommended citation <span id="bsbi-citation-toggle">[show]</span></h4>');var k=he('<div id="bsbi-citation-div">').appendTo(e);he('<p id="bsbi-citation-text">').appendTo(k).append(M(a)),he('<button id="bsbi-citation-copy-text">Copy as text</button>').appendTo(k).addClass("btn btn-default"),he('<button id="bsbi-citation-copy-html">Copy as HTML</button>').appendTo(k).addClass("btn btn-default");var S=!1;he("#bsbi-citation-toggle").click((function(){(S=!S)&&(he("#bsbi-citation-div").show(),he("#bsbi-citation-toggle").html("[hide]")),S||(he("#bsbi-citation-div").hide(),he("#bsbi-citation-toggle").html("[show]"))})),he("#bsbi-citation-copy-text").click((function(){A(he("#bsbi-citation-text").text())})),he("#bsbi-citation-copy-html").click((function(){A(he("#bsbi-citation-text").html())})),v("title",n[0].taxonName+" in BSBI Online Plant Atlas 2020",!0)}))}(),h(),f(),g(),rt("bsbi-gallery",a.identifier))})),fe.bsbi_atlas.identifier&&(r.selectpicker("val",fe.bsbi_atlas.identifier),window.history.pushState({identifier:fe.bsbi_atlas.identifier},"BSBI Atlas - ".concat(fe.bsbi_atlas.identifier),"/atlas/".concat(a.identifier)));var c,l=t.filter((function(t){return 2===t.hybridParentIds.split(";").length})).map((function(t){var e=t.hybridParentIds.split(";"),a=t.hybridParents.split(";");return{taxon:t.ddbid,parent1:e[0],parent2:e[1],taxonName:t.taxonName,parent1Name:a[0],parent2Name:a[1]}}));c=l,p["taxaHybridList"]=c}))}();he(".brc-atlas-map-opts").remove(),he("#bsbi-atlas-gui").html(null),he(".bsbi-atlas-trend-controls").hide(),he(".bsbi-atlas-phenology-controls").hide();var y=he('<ul class="nav nav-tabs"></ul>').appendTo(he("#bsbi-atlas-gui"));e.forEach((function(t){t.external||y.append(function(t,e,a){var n=he("<li>");a===t&&n.addClass("active");return he('<a data-toggle="tab" href="#bsbi-atlas-section-'+t+'">').appendTo(n).text(e),n}(t.id,t.title,"summary"))}));var x=he('<div class="tab-content"></div>').appendTo(he("#bsbi-atlas-gui"));e.forEach((function(t){t.external||x.append(function(t,e,a){var n=he("<div/>",{id:"bsbi-atlas-section-"+t});n.addClass("tab-pane"),n.addClass("fade"),a===t&&(n.addClass("in"),n.addClass("active"));var o=he('<p class="bsbi-selected-taxon-name"></p>');return o.css("font-size","1.3em"),o.css("margin-top","0.5em"),o.addClass("bsbi-atlas-section-header"),n.append(o),n}(t.id,t.title,"summary"))})),e.forEach((function(t){t.external||t.fn(t.id)})),he('a[data-toggle="tab"]').on("shown.bs.tab",(function(t){var e=he(t.target).attr("href");"#bsbi-atlas-section-summary"===e?(he(".bsbi-atlas-map-controls").show(),Bt(),E()):he(".bsbi-atlas-map-controls").hide(),"#bsbi-atlas-section-phenology"===e?(he(".bsbi-atlas-phenology-controls").show(),h()):he(".bsbi-atlas-phenology-controls").hide(),"#bsbi-atlas-section-ecology"===e&&f(),"#bsbi-atlas-section-conservation"===e&&m(),"#bsbi-atlas-section-trends"===e?(he(".bsbi-atlas-trend-controls").show(),g()):he(".bsbi-atlas-trend-controls").hide(),"#bsbi-atlas-section-gallery"===e&&rt("bsbi-gallery",a.identifier)}))}())}))}()}));
//# sourceMappingURL=bsbi-atlas-min.umd.js.map
