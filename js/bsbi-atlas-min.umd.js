!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).d3)}(this,(function(t){"use strict";function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var n=a(t),o="bsbi-atlas",i="0.2.0";function s(e,t,a,n,o,i,s){try{var r=e[i](s),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(n,o)}function r(e){return function(){var t=this,a=arguments;return new Promise((function(n,o){var i=e.apply(t,a);function r(e){s(i,n,o,r,c,"next",e)}function c(e){s(i,n,o,r,c,"throw",e)}r(void 0)}))}}var c={bsbiDataRoot:"",periodClasses:"standard",showStatus:!0,resolution:"hectad",displayedMapType:"static",taxaHybridList:[],taxaNoStatusList:[],changeColours:["#FAD0C8","#DD5A2F","#525252"],symboltype:"circle",periodColours:{},dotCaption:""};c.periodColours.standard={x:{"to 1929":"#f7f7f7","1930 - 1969":"#c6c6c6","1970 - 1986":"#909090","1987 - 1999":"#4e4e4e","2000 - 2019":"#000000"},n:{"to 1929":"#eff3ff","1930 - 1969":"#bdd7e7","1970 - 1986":"#6baed6","1987 - 1999":"#2b71a5","2000 - 2019":"#004d99"},a:{"to 1929":"#FEE5D9","1930 - 1969":"#FCBCB4","1970 - 1986":"#FF8C86","1987 - 1999":"#FF0000","2000 - 2019":"#B30000"},bullseye:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},c.periodColours.print={x:{"pre-1970":"#f7f7f7","1970 - 1986":"#b9b9b9","1987 - 1999":"#6f6f6f","2000 - 2019":"#000000"},n:{"pre-1970":"#eff3ff","1970 - 1986":"#bdd7e7","1987 - 1999":"#368dcd","2000 - 2019":"#004d99"},a:{"pre-1970":"#fee5d9","1970 - 1986":"#fc9898","1987 - 1999":"#ff4646","2000 - 2019":"#b30000"},bullseye:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},c.periodStroke={},c.periodStroke.standard={x:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}},c.periodStroke.print={x:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}};var l={};function d(e,t){var a=t||"hectads";return"".concat(c.bsbiDataRoot).concat(a,"/").concat(e.replace(".","_"),".csv")}function p(e){return"to 1929"===e?"pre-1930":e.replace(" - ","-")}function u(e,t){return c.dotCaption="Hectad:<br/>Occurrence:",new Promise((function(a,o){n.csv(d(e),(function(e){if(e.hectad){var a=!1;l[c.periodClasses][t].csvperiods.forEach((function(t){"1"===e[t]&&(a=!0)}));var n=!1;if(l[c.periodClasses][t].prior.forEach((function(t){"1"===e[t]&&(n=!0)})),a||n)return{gr:e.hectad,shape:"circle",size:1,colour:a?"#000000":"#b0b0b0",opacity:1,stroke:"#808080",caption:"Hectad: <b>".concat(e.hectad,"</b><br/>\n            Occurrence: <b>").concat(a?"in":"prior to","</b> the period <b>").concat(p(t),"</b>"),noCaption:c.dotCaption}}})).then((function(e){var n={precision:1e4,size:1,lines:[{colour:"#636363",opacity:1,stroke:"black",text:p(t),shape:"circle"},{colour:"#bdbdbd",opacity:1,stroke:"black",text:"Earlier",shape:"circle"}]};"to 1929"==t&&n.lines.pop(),a({records:e,precision:1e4,opacity:1,size:1,legend:n})})).catch((function(e){o(e)}))}))}function b(e,t,a,o){c.dotCaption="Hectad:</br>Change:";var i=["square","triangle-up","triangle-down"],s=c.changeColours;return new Promise((function(r,l){n.csv(d(e),(function(e){var n,o,r=t.some((function(t){return"1"===e[t]})),l=a.some((function(t){return"1"===e[t]}));if(r&&l?(n=0,o="Present in both periods"):!r&&l?(n=1,o="Gain"):r&&!l?(n=2,o="Loss"):n=100,e.hectad&&n<100)return{gr:e.hectad,colour:s[n],shape:i[n],caption:"Hectad: <b>".concat(e.hectad,"</b></br>Change: <b>").concat(o,"</b>"),noCaption:c.dotCaption}})).then((function(e){r({records:e,size:1,precision:1e4,opacity:1,legend:{title:o,size:1,precision:1e4,opacity:1,lines:[{colour:s[1],text:"Gain",shape:"triangle-up"},{colour:s[0],text:"No change",shape:"square"},{colour:s[2],text:"Loss",shape:"triangle-down"}]}})})).catch((function(e){l(e)}))}))}l.print={"pre-1970":{prior:[],csvperiods:["to 1929","1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},l.standard={"to 1929":{prior:[],csvperiods:["to 1929"]},"1930 - 1969":{prior:["to 1929"],csvperiods:["1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},c.distAllClasses=function(e){return"hectad"===c.resolution?function(e){var t={n:"Native",a:"Non-native (alien)",bullseye:"Introduced",missing:"missing"},a={"pre-1970":"pre-1970","to 1929":"pre-1930","1930 - 1969":"1930-69","1970 - 1986":"1970-86","1987 - 1999":"1987-99","2000 - 2019":"2000-19"},o={"pre-1970":1,"to 1929":1,"1930 - 1969":1,"1970 - 1986":1,"1987 - 1999":1,"2000 - 2019":1},i=Object.keys(l[c.periodClasses]).reverse();return new Promise((function(s,r){var u={};i.forEach((function(e){u[e]={ire:{n:0,a:0,bullseye:0,missing:0,total:0},gb:{n:0,a:0,bullseye:0,missing:0,total:0}}})),c.showStatus?c.dotCaption="Hectad:<br/>\n        Most recent dateclass:<br/>\n        Status:</b>":c.dotCaption="Hectad:<br/>\n        Most recent dateclass:",n.csv(d(e),(function(e){if(e.hectad){var n;n=3===e.hectad.length?"ire":"gb";var s=e.hectadstatus?e.hectadstatus:"missing";-1===["n","a","bullseye","missing"].indexOf(s)&&(s="missing");for(var r,d,b=!1,h=0;h<i.length;h++){r=i[h];for(var f=l[c.periodClasses][r].csvperiods,v=0;v<f.length;v++){if("1"===e[f[v]]){u[r][n][s]++,u[r][n].total++,b=!0,d=d||r;break}}}for(var m,g={},y=0;y<i.length;y++){r=i[y],g[r]=0;for(var x=l[c.periodClasses][r].csvperiods,w=0;w<x.length;w++){if("1"===e[x[w]]){g[r]=1;break}}}if(b)return m=c.showStatus?{gr:e.hectad,shape:"circle",colour:c.periodColours[c.periodClasses][s][d],stroke:c.periodStroke[c.periodClasses][s][d],size:"missing"===s?.5:1,opacity:o[d],caption:"Hectad: <b>".concat(e.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(p(d),"</b><br/>\n                        Status: <b>").concat(t[s],"</b>"),noCaption:c.dotCaption}:{gr:e.hectad,shape:"circle",colour:c.periodColours[c.periodClasses].x[d],stroke:c.periodStroke[c.periodClasses].x[d],size:1,opacity:o[d],caption:"Hectad: <b>".concat(e.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(p(d),"</b>"),noCaption:c.dotCaption},Object.keys(g).forEach((function(e){m[a[e]]=g[e]})),m}})).then((function(e){var t=i.reduce((function(e,t){return e+u[t].gb.a+u[t].ire.a}),0),n=i.reduce((function(e,t){return e+u[t].gb.n+u[t].ire.n}),0),r=[];c.showStatus?(n&&(r.push({text:["Native","","GB","IR"],underline:!0}),i.forEach((function(e){r.push({colour:c.periodColours[c.periodClasses].n[e],stroke:c.periodStroke[c.periodClasses].n[e],opacity:o[e],text:[a[e],"symbol",u[e].gb.n,u[e].ire.n],shape:"circle"})}))),n&&t&&r.push({text:[]}),t&&(r.push({text:["Alien","","GB","IR"],underline:!0}),i.forEach((function(e){r.push({colour:c.periodColours[c.periodClasses].a[e],stroke:c.periodStroke[c.periodClasses].a[e],opacity:o[e],text:[a[e],"symbol",u[e].gb.a,u[e].ire.a],shape:"circle"})})))):(r=[{text:["","","GB","IR"],underline:!0}],i.forEach((function(e){r.push({colour:c.periodColours[c.periodClasses].x[e],stroke:c.periodStroke[c.periodClasses].x[e],opacity:o[e],text:[a[e],"symbol",u[e].gb.total,u[e].ire.total],shape:"circle"})}))),s({records:e,precision:1e4,size:1,legend:{size:.8,raligned:[!1,!1,!0,!0],padding:5,lines:r}})})).catch((function(e){r(e)}))}))}(e):"tetrad"===c.resolution?function(e){return c.dotCaption="Tetrad:",new Promise((function(t,a){n.csv(d(e,"tetrads"),(function(e){if(e.tetrad)return{gr:e.tetrad,shape:"square",colour:"black",size:1,opacity:1,caption:"Tetrad: <b>".concat(e.tetrad,"</b>"),noCaption:c.dotCaption}})).then((function(e){t({records:e,precision:2e3,size:1,legend:{lines:[{colour:"black",opacity:1,text:"Present in tetrad",shape:"square"}]}})})).catch((function(e){a(e)}))}))}(e):function(e){return new Promise((function(t,a){n.csv(d(e,"monads"),(function(e){if(e.gr)return{gr:e.gr,shape:"square",colour:"black",size:1,opacity:1}})).then((function(e){t({records:e,precision:1e3,size:1,legend:{lines:[{colour:"black",opacity:1,text:"Present in monad",shape:"square"}]}})})).catch((function(e){a(e)}))}))}(e)},c.status_29=function(e){return u(e,"to 1929")},c.status_30_69=function(e){return u(e,"1930 - 1969")},c.status_70_86=function(e){return u(e,"1970 - 1986")},c.status_87_99=function(e){return u(e,"1987 - 1999")},c.status_00_19=function(e){return u(e,"2000 - 2019")},c.hybrid=function(e){var t=c.taxaHybridList.find((function(t){return t.taxon===e}));function a(e){return"<i>"+e.replace(/ x /g,"</i> x <i>")+"</i>"}var o=new Promise((function(t,a){n.csv(d(e)).then((function(e){t(e)})).catch((function(t){console.log("Hybrid map: can't retrieve map data for hybrid taxon ".concat(e)),a(t)}))})),i=new Promise((function(e,a){n.csv(d(t.parent1)).then((function(t){e(t)})).catch((function(e){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(t.parent1)),a(e)}))})),s=new Promise((function(e,a){n.csv(d(t.parent2)).then((function(t){e(t)})).catch((function(e){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(t.parent2)),a(e)}))}));return c.dotCaption="Hectad: <br/>\n    <i>".concat(t.parent1Name,"</i>: </br>\n    <i>").concat(t.parent2Name,"</i>: </br>\n    Hybrid:"),new Promise((function(e,n){Promise.all([o,i,s]).then((function(n){var o=[];n.forEach((function(e,t){e.forEach((function(e){var a=o.find((function(t){return e.hectad===t.gr}));if(a)a.presence[t]=!0;else{var n=[!1,!1,!1];n[t]=!0,o.push({gr:e.hectad,presence:n})}}))})),o.forEach((function(e){e.colour=e.presence[1]&&e.presence[2]?"#F7F619":e.presence[1]?"#E4C3AA":"#A8CBE2",e.caption="Hectad: <b>".concat(e.gr,"</b><br/>\n          <i>").concat(t.parent1Name,"</i>: <b>").concat(e.presence[1]?"present":"absent","</b></br>\n          <i>").concat(t.parent2Name,"</i>: <b>").concat(e.presence[2]?"present":"absent","</b></br>\n          Hybrid: <b>").concat(e.presence[0]?"present":"absent","</b>"),e.noCaption=c.dotCaption}));for(var i=o.length,s=0;s<i;s++)o[s].presence[0]&&o.push({gr:o[s].gr,shape:"square",size:.6,colour:"black",caption:o[s].caption,noCaption:o[s].noCaption});e({records:o,precision:1e4,shape:"circle",size:1,opacity:1,legend:{lines:[{colour:"black",text:"Hybrid recorded",shape:"square",size:.6},{colour:"#E4C3AA",text:a(t.parent1Name)},{colour:"#A8CBE2",text:a(t.parent2Name)},{colour:"#F7F619",text:"Both parents"}]}})})).catch((function(e){n(e)}))}))},c.change_1987_1999_vs_2000_2019=function(e){return b(e,["1987 - 1999"],["2000 - 2009","2010 - 2019"],"Change from 1987-1999 to 2000-2019")},c.change_1930_1969_vs_2000_2019=function(e){return b(e,["1930 - 1969"],["2000 - 2009","2010 - 2019"],"Change from 1930-1969 to 2000-2019")},c.bsbiHectadDateTetFreq=function(e){return c.dotCaption="Hectad: </br>Tetrads where present:",new Promise((function(t,a){n.csv(d(e),(function(e){var t=Number(e["distinct tetrads"]),a=5*Math.ceil(t/5);if(e.hectad&&t)return{gr:e.hectad,size:Math.sqrt(a)/5,caption:"Hectad: <b>".concat(e.hectad,"</b></br>Tetrads where present: <b>").concat(t,"</b>"),noCaption:c.dotCaption}})).then((function(e){t({records:e,colour:"black",shape:"circle",precision:1e4,opacity:1,legend:{title:"Tetrad frequency",size:1,shape:"circle",colour:"black",precision:1e4,opacity:1,lines:[{text:"1-5",size:Math.sqrt(5)/5*.5},{text:"6-10",size:Math.sqrt(10)/5*.5},{text:"11-15",size:Math.sqrt(15)/5*.5},{text:"16-20",size:Math.sqrt(20)/5*.5},{text:"21-25",size:Math.sqrt(25)/5*.5}]}})})).catch((function(e){a(e)}))}))};var h=jQuery;function f(e,t,a){var n=function(e,t,a){a?h('meta[name="'+e+'"').attr("content",t):h("head").append('<meta name="'+e+'" content="'+t+'" />')};switch(e){case"title":h("title").html(t),n("citation_title",t,a),n("dc.title",t,a),n("dcterms.title",t,a),n("prism.alternateTitle",t,a),n("eprints.title",t,a),n("bepress_citation_title",t,a);break;case"author":n("citation_author",t),n("dc.creator",t),n("dcterms.creator",t),n("eprints.creators_name",t),n("bepress_citation_author",t);break;case"authors":n("author",t),n("citation_authors",t);break;case"year":n("citation_year",t),n("citation_date",t),n("citation_publication_date",t),n("dc.date",t),n("dcterms.date",t),n("dcterms.created",t),n("prism.copyrightYear",t),n("prism.coverDate",t),n("prism.publicationDate",t),n("eprints.datestamp",t),n("eprints.date",t),n("bepress_citation_date",t);break;case"url":n("citation_public_url",t),n("prism.url",t),n("eprints.official_url",t),n("bepress_citation_pdf_url",t)}}var v,m,g,y,x,w="20062022x1",C=jQuery;function T(e){C("<h4>").appendTo(C(e)).text("Phenology & Apparency"),C("<p>").appendTo(C(e)).text("Explanation of apparency and phenology charts. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a.");var t=C("<div>").appendTo(C(e));t.attr("class","phenRow");var a=C("<div>").appendTo(t);a.attr("class","phenColumn");var n=C("<div>").appendTo(t);n.attr("class","phenColumn"),C("<h4>").appendTo(C(e)).text("Altitude vs Latitude"),C("<p>").appendTo(C(e)).text("Explanation of latitude/altitude chart. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a.");var o=C("<div>").appendTo(C(e));C("<div>").appendTo(a).attr("id","bsbi-apparency-chart").css("max-width","400px"),v=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd"}],width:400,height:250,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",showLegend:!1,interactivity:"none"}),C("<div>").appendTo(a).attr("id","bsbi-phenology-chart").css("max-width","400px"),m=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none"});var i=C("<div>").appendTo(a);i.attr("id","bsbi-phenology-source"),i.css("font-size","0.8em"),i.css("padding-left","32px"),i.css("max-width","400px"),C("<div>").appendTo(n).attr("id","bsbi-apparency-by-lat-chart").css("max-width","400px"),g=brccharts.phen1({selector:"#bsbi-apparency-by-lat-chart",data:[],taxa:["taxon"],metrics:[],lines:["white","white","#dddddd","white","white","#dddddd","white","white","#dddddd","white","white","#dddddd"],width:400,height:410,spread:!0,perRow:1,expand:!0,showTaxonLabel:!1,showLegend:!1,interactivity:"mousemove",margin:{left:40,right:0,top:20,bottom:5},axisLeftLabel:"Latitudinal band",axisLabelFontSize:12}),function(e){var t=C("<div>").appendTo(e);t.css("margin-left","35px");var a=C("<select>").appendTo(t);a.attr("id","atlas-lat-phen-data-type"),a.addClass("selectpicker"),a.on("changed.bs.select",(function(){x.length&&S(g,x)})),[{caption:"Scale by relative abundance",val:"count"},{caption:"Scale across latitudes",val:"scaled"},{caption:"Scale within latitude",val:"density"}].forEach((function(e){var t=(e.selected,C("<option>"));t.attr("value",e.val),t.html(e.caption).appendTo(a)})),a.val("count"),a.selectpicker()}(n),o.attr("id","bsbi-altlat-chart"),o.css("max-width","600px");y=brccharts.altlat({selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1-10%"},{min:10.00001,max:30,radius:14,legend:"11-30%"},{min:30.00001,max:40,radius:16,legend:"31-40%"},{min:40.00001,max:50,radius:18,legend:"41-50%"},{min:50.00001,max:100,radius:20,legend:"51-100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:45,right:10,top:20,bottom:35},showTaxonLabel:!1,showLegend:!0,axisLabelFontSize:12,legendFontSize:10,interactivity:"toggle"}),C(".brc-chart-phen1").css("overflow","visible"),C("#bsbi-apparency-by-lat-chart .phen-path").css("stroke-width",1)}function _(e,t){var a=t.map((function(e){return{taxon:"taxon",week:Number(e.week),n:Number(e.n)}})).sort((function(e,t){return e.week>t.week}));return e.setChartOpts({data:a})}function k(e,t,a){var n=[1,32,60,91,121,152,182,213,244,274,305,335,365],o=t[0].phenFlowerStart,i=t[0].phenFlowerEnd,s=t[0].phenLeafStart,r=t[0].phenLeafEnd,c=n[Number(o)-1],l=n[Number(i)],d=n[Number(s)-1],p=n[Number(r)];if(a){var u="Data for flower phenology from ".concat(t[0].phenFlowerRef,".</br>Data for leafing phenology from ").concat(t[0].phenLeafRef,".");C("#".concat(a)).html(u)}var b=[];return s&&r&&b.push({prop:"band2",label:"In leaf",colour:"#009900",opacity:.5,svg:"m12941 19084-175-112-108 54c-59 30-112 54-117 54s-97-112-203-250l-193-250h-150-151l-177-188c-97-104-186-197-197-207-19-17-23-16-139 49-66 36-124 66-128 65-6 0-219-276-359-464-10-14-30-7-149 53l-138 70-26-32c-15-17-103-124-195-238-92-115-171-208-175-208s-61 25-127 55l-119 55-90-92c-50-51-149-155-220-230l-130-138-112 100c-61 55-115 100-120 100-4 0-123-122-263-269-140-148-260-270-266-270-5-1-65 39-131 88l-122 90-233-207c-129-114-264-233-300-265l-66-58-138 80-139 80-139-147c-77-81-181-189-231-240l-91-94-161 80-160 81-169-201c-93-110-176-209-184-219-15-19-19-18-174 26-87 25-162 42-167 39s-79-90-164-194c-140-171-158-188-178-181-12 5-73 30-134 56-62 26-116 45-121 43-5-1-105-104-222-226-192-202-216-223-239-218-14 3-82 23-151 44l-126 38-249-262c-138-145-252-263-255-263s-45 55-95 124c-49 68-92 121-96 117s-98-138-209-299l-201-292-138 69-139 69-223-336c-123-184-227-339-230-344s-83-20-177-33c-95-12-174-25-176-27s-52-107-111-234c-59-126-111-233-114-237-4-4-62 8-130 27-69 19-125 34-127 32-1-1-57-139-125-307-67-168-124-307-125-309-2-2-69-14-150-27-80-12-147-24-149-26-3-2-30-125-60-273-31-149-58-272-60-274-3-2-68 2-146 8-77 7-144 10-147 6-3-3-16-132-28-286s-23-281-25-283-79-18-171-36l-168-34-2-380-3-381-193-79c-139-57-192-84-192-95 0-9 29-149 65-310s65-295 63-296c-2-2-86-43-188-91s-188-90-192-93 45-170 108-371l114-365-67-65c-38-36-110-104-162-152l-93-86 136-329c75-181 136-332 136-337 0-4-58-90-128-190-71-99-132-187-136-194-6-10 62-142 290-561 15-26 21-48 16-55-5-6-66-82-135-170-70-87-127-162-127-166 0-5 108-183 239-396l240-387-90-99c-49-54-89-102-89-107s111-164 246-353c136-188 253-353 261-365 13-20 10-32-43-149-55-124-56-128-38-143 11-9 182-159 381-334l361-317-5-43c-3-23-13-105-24-182-10-77-16-141-15-143 4-3 510-150 857-248 15-4 13-20-18-141-18-74-32-137-31-139 2-1 138-21 303-42 279-37 309-43 431-86 238-83 552-155 824-188 141-17 699-17 840 0 648 79 1266 287 1860 624 111 64 378 237 494 320 46 34 67 44 62 32-4-11-35-107-68-214-397-1294-750-2359-915-2764-72-178-107-247-165-332-72-104-110-172-148-269-56-142-97-325-73-325 29 0 420 94 429 104 6 6 46 128 89 271 42 143 142 478 222 745 79 267 202 679 273 915 71 237 185 621 255 855s151 506 181 604c30 99 54 185 54 193 0 27 18 12 35-30 31-80 204-397 305-558 282-454 581-807 1323-1564l245-250 114 113c62 61 116 112 120 112s118-122 253-270c136-149 250-270 254-270 3 0 40 68 81 151s78 152 82 155c3 2 122-66 263-152 180-110 259-153 264-145 5 7 18 57 30 112l22 99h515c283 0 514 1 514 3s-20 52-44 112l-44 110 479 3c310 1 479 6 479 12s-14 58-31 116-30 106-28 108c2 1 179 26 392 56 214 30 392 57 398 60 5 4-4 44-21 95-16 49-30 94-30 100 0 7 112 32 288 64 158 29 296 55 307 58 20 4 20 7 9 141-7 75-12 138-11 138 5 5 558 214 564 214 5 0 14 4 21 9 13 8 10 15-74 227-3 5 144 82 326 169 181 88 330 164 330 170s-30 84-66 174c-53 134-63 166-52 176 7 7 105 85 218 175s210 168 217 174c9 8-1 46-42 164-30 84-55 157-55 162s101 91 225 190 225 183 225 186-56 66-124 140l-125 135 194 217c107 119 195 219 194 222 0 3-45 41-100 85-54 44-111 90-125 101l-26 21 145 289c80 159 147 294 148 299 1 6-25 25-57 44-33 18-78 44-101 57l-41 24 124 226c69 124 124 229 122 234-2 4-42 42-90 84l-87 76 28 63c15 34 72 158 126 276l98 214-39 36c-21 20-68 61-103 93l-64 56 136 261c76 144 137 263 137 265 0 3-57 23-127 46-71 24-132 46-136 50-4 3 33 128 82 276s88 270 86 272-45-6-95-18c-51-11-95-19-98-16-5 6-4 13 77 405 28 135 49 246 47 248-1 2-36-11-76-27-39-17-74-30-76-27-2 2 1 111 6 243 5 131 10 284 10 339v100l-87-10c-49-6-89-8-90-5s29 140 66 305 67 301 66 303c-2 2-53-22-114-52-91-46-111-53-111-39 0 10 9 144 20 298s20 297 20 317v37l-72-20c-40-11-81-22-90-25-17-5-18 16-18 350 0 278-3 356-12 356-7 0-53-9-102-20s-91-19-92-17c-1 1-17 106-35 232-18 127-35 233-38 237-3 3-39-7-79-24s-74-29-76-27c-3 2-15 155-27 339s-23 336-25 338c-1 2-45-15-98-39-53-23-99-39-102-36s-17 167-30 364c-12 197-23 359-24 361 0 1-43-32-96-73s-99-75-103-75-26 141-50 313c-23 171-44 319-47 328-4 14-14 14-102-6-53-12-100-20-103-16-4 3-31 143-60 309-30 167-57 309-61 315-4 7-30 0-77-21-39-18-73-32-76-32s-5 149-5 330c0 182-3 330-6 330s-49-29-101-65c-53-36-97-64-98-63-2 2-8 154-15 338-6 184-13 337-15 338-2 2-40-24-85-57-44-34-84-61-89-61-4 0-7 10-5 23 2 12 11 139 19 282s18 291 21 329l6 69-126-5c-114-5-126-4-122 11 8 27 126 657 126 673 0 10-37 25-115 48-104 30-114 35-110 54 3 12 16 71 30 131 102 438 125 539 125 551 0 10-24 14-99 16l-98 3 112 248 113 248-27 10c-14 6-61 22-104 35l-77 25 52 97c28 53 75 142 105 196 29 55 52 100 51 101-2 1-42 17-90 35-49 18-88 38-88 45s11 86 25 175c14 90 24 166 23 170-2 4-81-43-177-106z"}),o&&i&&b.push({prop:"band1",label:"Flowering",colour:"#ff9900",opacity:.5,svg:"M1048.256,633.499c212.849-356.854,285.555-335.845-191.845-590.438C384.889,283.217,484.493,353.496,664.566,633.499 c-310.065-285.921-239.639-396.021-620.823,0c64.157,504.336,28.591,448.084,502.257,364.911 c-416.078,181.718-421.368,113.233-191.845,590.438c503.843,103.322,428.181,97.12,502.257-364.911 c69.825,407.236,10.978,486.041,502.257,364.911c233.666-457.592,211.268-427.46-191.845-590.438 c452.881,101.063,461.097,199.985,502.257-364.911C1305.872,228.612,1381.606,318.787,1048.256,633.499z M856.411,1100.523 c-114.579,0-207.463-92.884-207.463-207.463s92.884-207.463,207.463-207.463c114.578,0,207.463,92.884,207.463,207.463 S970.989,1100.523,856.411,1100.523z"}),e.setChartOpts({data:[{taxon:"taxon",band2:{start:d,end:p},band1:{start:c,end:l}}],metrics:b})}function S(e,t){var a=C("#atlas-lat-phen-data-type").val(),n=t.filter((function(e){return e.type===a})).map((function(e){var t={taxon:"taxon"};return Object.keys(e).forEach((function(a){t[a]=Number(e[a])})),t})),o=["50","51","52","53","54","55","56","57","58","59","60"].map((function(e){return{prop:e,label:e,colour:"green",fill:"#ddffdd"}})),i=n.sort((function(e,t){return e.week>t.week}));return e.setChartOpts({data:i,metrics:o,spread:!0})}function E(e,t){var a=t.map((function(e){return{distance:Number(e.distance),altitude:Number(e.altitude),metric:Number(e.percent),taxon:"dummy"}}));return e.setChartOpts({data:a})}var R=jQuery,L=drupalSettings;function B(e,t){if(document.getElementById(e).innerHTML="",t){var a=L.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(t.replace(/\./g,"_"),".csv?prevent-cache=").concat(w);d3.csv(n).then((function(t){var a=t[0].images.split(";").filter((function(e){return e})).map((function(e){return console.log(e.replace("{PIXELSIZE}","192")),{src:e.replace("{PIXELSIZE}","1920"),thumb:e.replace("{PIXELSIZE}","192"),subHtml:'\n              <div class="lightGallery-captions">\n                <div style="background-color: black; opacity: 0.7">\n                <p style="margin: 0.3em">TODO - Copyright text to acknowledge Rob Still and Chris Gibson</p>\n                <div>\n              </div>'}})),n=document.getElementById(e);if(a.length){var o=lightGallery(n,{container:n,dynamic:!0,hash:!1,closable:!1,download:!1,showMaximizeIcon:!0,appendSubHtmlTo:".lg-item",slideDelay:400,plugins:[lgZoom,lgThumbnail],dynamicEl:a,thumbWidth:90,thumbHeight:"60px",thumbMargin:4});setTimeout((function(){o.openGallery(),R("#bsbi-gallery-copyright").show()}),200)}else n.innerHTML="<i>No images are available for this taxon.</i>",R("#bsbi-gallery-copyright").hide()}))}}function I(e){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);var t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((function(e,a){document.execCommand("copy")?e():a(),t.remove()}))}function O(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function P(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var o=a[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function M(e,t){return t?"<i>".concat(e.shortName.replace(/\s/g,"</i> <i>"),"</i> in <i>BSBI</i> <i>Online</i> <i>Atlas</i> <i>2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(e.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]"):"<i>".concat(e.shortName,"</i> in <i>BSBI Online Plant Atlas 2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(e.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]")}var N,A,D,q=jQuery,H=drupalSettings,z=P("gridstyle")?P("gridstyle"):"solid",G=P("backdrop")?P("backdrop"):"colour_elevation",F="allclass",j=P("inset")?P("inset"):"BI4",J=P("boundaries")?P("boundaries"):"none",V=!1,W="static",Y="hectad",Z=5,Q=2,X={display:!0,scale:.8,x:10,y:0,data:null},K={display:!0,scale:1,x:10,y:5,data:null},U=[{min:"",max:1929,access:"status_29",caption:"1929 and before"},{min:1930,max:1969,access:"status_30_69",caption:"1930 - 1969"},{min:1970,max:1986,access:"status_70_86",caption:"1970 - 1986"},{min:1987,max:1999,access:"status_87_99",caption:"1987 - 1999"},{min:2e3,max:2019,access:"status_00_19",caption:"2000 - 2019"}],$=[{lower:"1930-69",upper:"2000-19",access:"change_1930_1969_vs_2000_2019",caption:"1930-69 vs 2000-19"},{lower:"1987-99",upper:"2000-19",access:"change_1987_1999_vs_2000_2019",caption:"1987-99 vs 2000-19"}];function ee(e,t){var a=q("<div>").appendTo(q(e));return a.addClass("atlas-map-control-row"),t&&a.addClass(t),a}function te(){"static"===W?(q("#slippyAtlasMain").hide(),q("#staticAtlasMain").show()):(q("#staticAtlasMain").hide(),q("#slippyAtlasMain").show()),"static"===W?q(".atlas-save-map-image").show():q(".atlas-save-map-image").hide(),q(".atlas-download-map-data").show(),"allclass"===F&&"hectad"===Y?q(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!1):q(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!0),"static"===W?q(".atlas-backdrop-selector").show():q(".atlas-backdrop-selector").hide(),"static"===W?q(".atlas-inset-control").show():q(".atlas-inset-control").hide(),"static"===W?q(".atlas-grid-type-control").show():q(".atlas-grid-type-control").hide(),"status"===F?q(".atlas-period-slider-control").show():q(".atlas-period-slider-control").hide(),"trends"===F?q(".atlas-trend-slider-control").show():q(".atlas-trend-slider-control").hide(),"allclass"===F||"slippy"===F?q(".atlas-status-checkbox-control").show():q(".atlas-status-checkbox-control").hide(),"slippy"===W?q(".atlas-opacity-slider-control").show():q(".atlas-opacity-slider-control").hide();var e=c.taxaNoStatusList.indexOf(N.identifier)>-1||N.isHybrid,t=N.hybridMapping;e||t?(V=!1,c.showStatus=!1,q(".atlas-status-checkbox-control span").text("No status info for this taxon"),q(".atlas-status-checkbox-control span").css("color","silver")):(q(".atlas-status-checkbox-control span").text("Show status"),q(".atlas-status-checkbox-control span").css("color","black")),e||t||"slippy"===W&&"allclass"===F&&"hectad"!==Y?(q(".atlas-status-checkbox").prop("checked",!1),q(".atlas-status-checkbox").attr("disabled",!0)):(q(".atlas-status-checkbox").attr("disabled",!1),q(".atlas-status-checkbox").prop("checked",V)),"slippy"===W&&"allclass"===F?q(".atlas-resolution-control").show():q(".atlas-resolution-control").hide(),"slippy"===W&&"allclass"===F?(c.resolution=Y,q(".bsbi-resolution-"+Y).prop("checked",!0)):c.resolution="hectad";var a=q('.atlas-map-type-selector option[value="hybrid"]');t?a.show():(a.hide(),"hybrid"===F&&(a.prop("selected",!1),q('.atlas-map-type-selector option[value="allclass"]').prop("selected",!0),F="allclass")),q(".atlas-map-type-selector").selectpicker("refresh")}function ae(e){N=e}function ne(e){var t=JSON.parse(JSON.stringify(brcatlas.namedTransOpts));delete t.BI3,t.BI4.bounds.xmin=-24e4,t.BI1.bounds.xmin=-23e4,t.BI2.bounds.xmin=-23e4,c.bsbiDataRoot=H.bsbi_atlas.dataRoot+"bsbi/20220606/",c.showStatus=!1;var a={status_29:c.status_29,status_30_69:c.status_30_69,status_70_86:c.status_70_86,status_87_99:c.status_87_99,status_00_19:c.status_00_19,"Tetrad frequency":c.bsbiHectadDateTetFreq,change_1987_1999_vs_2000_2019:c.change_1987_1999_vs_2000_2019,change_1930_1969_vs_2000_2019:c.change_1930_1969_vs_2000_2019,distAllClasses:c.distAllClasses,hybrid:c.hybrid};D=brcatlas.svgMap({selector:e,mapid:"staticAtlasMain",captionId:"dotCaption",height:650,expand:!0,legendOpts:K,transOptsKey:P("inset")?P("inset"):j,transOptsSel:t,mapTypesKey:"status_10_19",mapTypesSel:a,mapTypesControl:!1,transOptsControl:!1,seaFill:"white",gridLineColour:"#7C7CD3",gridLineStyle:z,boundaryColour:"#7C7CD3",vcColour:"#7C7CD3",vcLineStyle:"vc"===J?"":"none",countryColour:"#7C7CD3",countryLineStyle:"country"===J?"":"none"}),H.bsbi_atlas.dataRoot,A=brcatlas.leafletMap({selector:e,mapid:"slippyAtlasMain",height:650,width:D.getMapWidth(),captionId:"dotCaption",mapTypesKey:"status_10_19",mapTypesSel:a,legendOpts:X,basemapConfigs:[{name:"Open Street Map",type:"tileLayer",selected:!0,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",opts:{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},{name:"Stamen Black & White",type:"tileLayer",selected:!1,url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}",opts:{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}},{name:"Open Topo Map",type:"tileLayer",selected:!1,url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",opts:{maxZoom:17,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},{name:"GEBCO 2020 Elevation",type:"wms",selected:!1,url:"https://www.gebco.net/data_and_products/gebco_web_services/2020/mapserv?",opts:{layers:"GEBCO_2020_Grid_2",maxZoom:17,attribution:"Imagery reproduced from the GEBCO_2020 Grid, GEBCO Compilation Group (2020) GEBCO 2020 Grid (doi:10.5285/a29c5465-b138-234d-e053-6c86abc040b9)"}},{name:"Copernicus elevation aspect",type:"wms",selected:!1,url:"https://copernicus.discomap.eea.europa.eu/arcgis/services/Elevation/Aspect/MapServer/WMSServer?",opts:{layers:"image",maxZoom:17,attribution:"&copy; European Commission"}}],callbacks:[function(){document.getElementById("atlas-loader").style.display="inline-block"},function(){document.getElementById("atlas-loader").style.display="none"},function(){document.getElementById("atlas-loader").style.display="inline-block"},function(){document.getElementById("atlas-loader").style.display="none"}],showVcs:"vc"===J,showCountries:"country"===J}),q("#slippyAtlasMain").hide()}function oe(e){var t;if(t="static"===W?D:A,"status"===F){var a=U[Z-1].access;t.setMapType(a)}else if("allclass"===F)t.setMapType("distAllClasses");else if("trends"===F){var n=$[Q-1].access;t.setMapType(n)}else"tetrad"===F?t.setMapType("Tetrad frequency"):"hybrid"===F&&t.setMapType("hybrid");if(K.scale=.9,"BI1"==j&&(K.scale=.77*K.scale),"BI2"==j&&(K.scale=.85*K.scale),D.setLegendOpts(K),N.identifier){if(t.setIdentfier(N.identifier),e)return t.redrawMap();t.redrawMap().catch((function(e){console.warn("Unable to generate map for ".concat(N.shortName," (").concat(N.identifier,"). Error message:"),e),t.clearMap()}))}q("#dotCaption").html(c.dotCaption)}function ie(e){var t,a;!function(e){var t=q('<div style="display: flex">').appendTo(e),a=q('<div class="btn-group" data-toggle="buttons">').appendTo(t),n=q('<label class="btn btn-primary active">').appendTo(a);q('<input type="radio" name="mapType" value="static" checked>').appendTo(n),n.append("Overview");var o=q('<label class="btn btn-primary">').appendTo(a);q('<input type="radio" name="mapType" value="slippy">').appendTo(o),o.append("Zoomable");var i=q('<div id="atlas-loader" style="display: none">').appendTo(t);q('<div class="atlas-loader">').appendTo(i),q('input[type=radio][name="mapType"]').change((function(){if(W=q(this).val(),c.displayedMapType=W,"slippy"===W){var e=q("#staticAtlasMain svg"),t=e.width(),a=e.height();A.setSize(t,a)}te(),oe(),"slippy"===W&&A.invalidateSize()}))}(ee(e)),t=ee(e),(a=q("<select>").appendTo(t)).addClass("selectpicker"),a.addClass("atlas-map-type-selector"),a.attr("data-width","100%"),a.on("changed.bs.select",(function(){F=q(this).val(),te(),oe()})),[{caption:"Distribution overview",val:"allclass"},{caption:"Distribution by year range",val:"status"},{caption:"Change maps",val:"trends"},{caption:"Tetrad frequency",val:"tetrad"},{caption:"Map hybrid with parents",val:"hybrid"}].forEach((function(e){var t=q("<option>");t.attr("value",e.val),t.html(e.caption).appendTo(a)})),a.selectpicker(),function(e){var t=q("<div>").appendTo(e);t.addClass("atlas-period-slider-control"),t.hide();var a=q("<div>").appendTo(t);a.addClass("slidecontainer");var n=q("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",U.length).attr("id","atlas-range-select"),n.change((function(){Z=q(this).val(),oe()}));var o=q("<div>").appendTo(a);o.addClass("atlas-range-tick-container"),o.css("margin-bottom","4.3em"),U.forEach((function(e,t){var a=q("<span>").appendTo(o);a.addClass("atlas-range-tick");var n=t/(U.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var i=q("<span>").appendTo(a);i.addClass("atlas-range-tick-text"),i.html((e.min?e.min:"pre")+"<br>"+(1929===e.max?1930:e.max))}))}(ee(e)),function(e){var t=q("<div>").appendTo(e);t.addClass("atlas-status-checkbox-control");var a=q('<div class="checkbox">').appendTo(t);q('<label><input type="checkbox" class="atlas-status-checkbox"/><span>Show status</span></label>').appendTo(a),q(".atlas-status-checkbox").change((function(){V=q(this).is(":checked"),c.showStatus=V,oe()}))}(ee(e)),function(e){var t=q("<div>").appendTo(e);t.addClass("atlas-trend-slider-control"),t.hide();var a=q("<div>").appendTo(t);a.addClass("slidecontainer"),a.addClass("atlas-trend-select-container");var n=q("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",$.length).addClass("atlas-trend-select"),n.change((function(){Q=q(this).val(),oe()}));var o=q("<div>").appendTo(a);o.addClass("atlas-trend-tick-container"),$.forEach((function(e,t){var a=q("<span>").appendTo(o);a.addClass("atlas-trend-tick");var n=t/($.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var i=q("<span>").appendTo(a);i.addClass("atlas-trend-tick-text"),i.addClass("atlas-trend-tick-text-"+t),i.html(e.lower+"<br>v.<br>"+e.upper)})),t.css("margin-bottom","5.3em")}(ee(e)),function(e){var t=H.bsbi_atlas.dataRoot+"rasters/",a=[{caption:"No backdrop",val:"none"},{caption:"Colour elevation",val:"colour_elevation"},{caption:"Grey elevation",val:"grey_elevation_300"}],n=q("<select>").appendTo(e);n.addClass("selectpicker"),n.attr("data-width","100%"),n.on("changed.bs.select",(function(){a.forEach((function(e){"none"!==e.val&&D.basemapImage(e.val,!1,t+e.val+".png",t+e.val+".pgw")})),O("backdrop",G=q(this).val(),30),"none"!==G&&D.basemapImage(G,!0,t+G+".png",t+G+".pgw")})),a.forEach((function(e){var t=q("<option>");t.attr("value",e.val),t.html(e.caption).appendTo(n)})),n.val(G),"none"!==G&&D.basemapImage(G,!0,t+"".concat(G,".png"),t+"".concat(G,".pgw")),n.selectpicker()}(ee(e,"atlas-backdrop-selector")),function(e){var t=q("<select>").appendTo(e);t.addClass("selectpicker"),t.addClass("atlas-inset-control"),t.attr("data-width","100%"),t.on("changed.bs.select",(function(){j=q(this).val(),D.setTransform(j),O("inset",j,30),oe()})),[{caption:"No insets",val:"BI1"},{caption:"Channel Isles inset",val:"BI2"},{caption:"Northern and Channel Isles inset",val:"BI4"}].forEach((function(e){var a=(e.selected,q("<option>"));a.attr("value",e.val),a.html(e.caption).appendTo(t)})),t.val(j),t.selectpicker()}(ee(e)),function(e){var t=q("<select>").appendTo(e);t.addClass("selectpicker"),t.addClass("atlas-grid-type-control"),t.attr("data-width","100%"),t.on("changed.bs.select",(function(){O("gridstyle",z=q(this).val(),30),D.setGridLineStyle(z)})),[{caption:"Solid grid lines",val:"solid"},{caption:"Dashed grid lines",val:"dashed"},{caption:"No grid lines",val:"none"}].forEach((function(e){var a=(e.selected,q("<option>"));a.attr("value",e.val),a.html(e.caption).appendTo(t)})),t.val(z),t.selectpicker()}(ee(e)),function(e){var t=q("<select>").appendTo(e);t.addClass("selectpicker"),t.addClass("atlas-boundaries-control"),t.attr("data-width","100%"),t.on("changed.bs.select",(function(){O("boundaries",J=q(this).val(),30),"none"===J?(D.setVcLineStyle("none"),D.setCountryLineStyle("none"),D.setBoundaryColour("#7C7CD3"),A.setShowVcs(!1),A.setShowCountries(!1)):"vc"===J?(D.setVcLineStyle(""),D.setCountryLineStyle("none"),D.setBoundaryColour("white"),A.setShowVcs(!0),A.setShowCountries(!1)):"country"===J&&(D.setVcLineStyle("none"),D.setCountryLineStyle(""),D.setBoundaryColour("white"),A.setShowVcs(!1),A.setShowCountries(!0))})),[{caption:"Country boundaries",val:"country"},{caption:"Vice county boundaries",val:"vc"},{caption:"No boundaries",val:"none"}].forEach((function(e){var a=(e.selected,q("<option>"));a.attr("value",e.val),a.html(e.caption).appendTo(t)})),t.val(J),t.selectpicker()}(ee(e)),function(e){q("#atlas-leaflet-svg").css("opacity",.7);var t=q("<div>").appendTo(e);t.addClass("atlas-opacity-slider-control"),t.hide();var a=q("<div>").appendTo(t);a.addClass("atlas-opacity-slider-label"),a.text("Opacity:");var n=q("<div>").appendTo(t);n.addClass("slidecontainer"),n.addClass("atlas-opacity-slider-slider");var o=q("<input>").appendTo(n);o.addClass("slider"),o.attr("type","range").attr("min","1").attr("max","100").attr("value",70).attr("id","atlas-opacity-slider"),o.change((function(){q("#atlas-leaflet-svg").css("opacity",q(this).val()/100)}))}(ee(e)),q(e).each((function(e){var t="bsbi-atlas-map-controls-"+e;q("<div>").appendTo(q(this)).addClass(t),function(e,t){var a=q("<div>").appendTo(e);function n(e,n,o){var i=q("<div>").appendTo(a);i.attr("class","radio");var s=q("<input>").appendTo(i);s.attr("type","radio"),s.attr("name","bsbi-resolution-"+t),s.attr("class","bsbi-resolution-"+n),s.attr("value",n),s.css("margin-left",0),o&&s.prop("checked",!0);var r=q("<label>").appendTo(i);r.attr("for","bsbi-resolution-"+n),r.text(e),s.change((function(){Y=q(this).val(),q(".bsbi-resolution-"+Y).prop("checked",!0),te(),oe()}))}n("Hectads","hectad",!0),n("Tetrads","tetrad",!1)}(ee(t="."+t,"atlas-resolution-control"),e),function(e,t){var a="png",n=q("<div>").appendTo(e);n.addClass("atlas-save-map-image"),n.hide();var o=q("<svg>").appendTo(n),i=q("<text>").appendTo(o);i.attr("x","10"),i.attr("y","20"),q("<br>").appendTo(n);var s=q("<button>").appendTo(n);function r(e,o,i){var s=q("<div>").appendTo(n);s.css("display","inline-block"),s.css("margin-left","0.5em"),s.attr("class","radio");var r=q("<label>").appendTo(s);r.css("padding-left","0");var c=q("<input>").appendTo(r),l=q("<span>").appendTo(r);l.text(e),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","img-download-type-"+t),c.attr("class","img-download-type-"+o),c.attr("value",o),c.css("margin-left",0),i&&c.prop("checked",!0),c.change((function(){q(".img-download-type-"+o).prop("checked",!0),a=o}))}s.addClass("btn btn-default"),s.text("Download image"),s.on("click",(function(){var e={text:M(N,!0),margin:10,fontSize:10};D.saveMap("svg"===a,e,"atlas-image")})),r("PNG","png",!0),r("SVG","svg",!1)}(ee(t,"atlas-image-button"),e),function(e,t){var a="csv",n=q("<div>").appendTo(e);n.addClass("atlas-download-map-data"),n.hide();var o=q("<button>").appendTo(n);function i(e,o,i){var s=q("<div>").appendTo(n);s.css("display","inline-block"),s.css("margin-left","0.5em"),s.attr("class","radio");var r=q("<label>").appendTo(s);r.css("padding-left","0");var c=q("<input>").appendTo(r),l=q("<span>").appendTo(r);l.text(e),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","download-type-"+t),c.attr("class","download-type-"+o),c.attr("value",o),c.css("margin-left",0),i&&c.prop("checked",!0),c.change((function(){q(".download-type-"+o).prop("checked",!0),a=o}))}o.addClass("btn btn-default"),o.text("Download data"),o.on("click",(function(){("static"===W?D:A).downloadData("geojson"===a)})),i("CSV","csv",!0),i("GJson","geojson",!1)}(ee(t,"atlas-download-button"),e)}))}function se(e,t){c[e]=t}function re(){return D}var ce=jQuery;var le,de,pe,ue,be,he,fe=jQuery,ve=drupalSettings,me={identifier:"",name:null,shortName:null,tetrad:null},ge=!1;function ye(){var e,t;fe("#bsbi-atlas-download").css("display","flex"),fe("<div>").appendTo(fe("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-left").css("flex",1),fe("<div>").appendTo(fe("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-right").css("flex",1).css("margin-left","1em"),function(){var e=fe("<div>").appendTo(fe(".bsbi-atlas-taxon-selector"));e.addClass("atlas-taxon-selector-div");var t=fe("<select>").appendTo(e);t.addClass("atlas-taxon-selector-sel"),d3.csv(ve.bsbi_atlas.dataRoot+"bsbi/taxon_list.csv?prevent-cache=".concat(w)).then((function(e){e.forEach((function(e){var a="";e.vernacular&&(a="<b>"+e.vernacular+"</b> "),a+=e.formattedName;var n=fe("<option>");n.attr("data-content",a),n.attr("value",e.ddbid),n.attr("data-taxon-name",e.taxonName),n.attr("data-is-hybrid",e.hybrid),n.html(a).appendTo(t)})),t.attr("data-size","10"),t.attr("data-live-search","true"),t.attr("data-header","Start typing the name of a taxon"),t.attr("title","Select a taxon"),t.selectpicker(),t.on("changed.bs.select",(function(){console.log("Identifier:",fe(this).val()),Ie(),me.identifier=fe(this).val(),me.name=fe(this).find(":selected").attr("data-content"),me.shortName=fe(this).find(":selected").attr("data-taxon-name"),me.isHybrid="t"===fe(this).find(":selected").attr("data-is-hybrid");var e="t"===fe(this).find(":selected").attr("data-is-hybrid"),t=be.indexOf(fe(this).val())>-1;c.showStatus=!e&&!t,Te(me.identifier),ke(me.identifier),Ee(me.identifier),Le(me.identifier)})),he=e.map((function(e){return"t"===e.hybrid}))})).catch((function(){console.log("Error reading taxon CSV")})),d3.csv("".concat(ve.bsbi_atlas.dataRoot,"bsbi/no_status.csv?prevent-cache=").concat(w)).then((function(e){be=e.map((function(e){return e["ddb id"]}))}))}(),(e=fe("<button>").appendTo(fe("#bsbi-atlas-download-left"))).addClass("btn btn-default"),e.text("Download selected"),e.on("click",(function(){Ie();var e=xe(me.shortName,me.identifier),t=re();fe("#download-map").is(":checked")&&t.saveMap(!0,null,"".concat(e,"map")),fe("#download-apparency").is(":checked")&&le.saveImage(!0,"".concat(e,"apparency")),fe("#download-phenology").is(":checked")&&de.saveImage(!0,"".concat(e,"phenology")),fe("#download-altlat").is(":checked")&&pe.saveImage(!0,"".concat(e,"altlat"))})),fe("<hr/>").appendTo(fe("#bsbi-atlas-download-left")),fe("<p>").appendTo(fe("#bsbi-atlas-download-left")).html("\n    For batch downloads, first select a CSV file from your computer\n    that has two columns: <i>taxonId</i> which has the ddbid for each \n    taxon and <i>taxon</i> which specifies a taxon name. \n    The taxon name is only used to name the file and\n    doesn't have to be exactly the same as \n    the name used elsewhere on the site. The ddbid will also be used \n    in the filename in case of any ambiguity.\n  "),(t=fe("<input>").appendTo(fe("#bsbi-atlas-download-left"))).attr("type","file"),t.attr("accept",".csv"),t.attr("id","bsbi-atlas-batch-file"),t.css("margin-bottom","1em"),t.on("change",(function(){!function(e){var t=new FileReader;t.addEventListener("load",(function(e){ue=e.target.result})),t.readAsDataURL(e.target.files[0])}(event)})),function(){var e=fe("<button>").appendTo(fe("#bsbi-atlas-download-left"));e.addClass("btn btn-default"),e.text("Download batch"),e.on("click",(function(){Ie(),function(){we.apply(this,arguments)}()}))}(),function(){var e=fe("<button>").appendTo(fe("#bsbi-atlas-download-left"));e.addClass("btn btn-default"),e.css("margin-left","1em"),e.text("Cancel"),e.on("click",(function(){ge=!0}))}(),fe("<hr/>").appendTo(fe("#bsbi-atlas-download-left")),Ce("map","Map"),Ce("apparency","Apparency"),Ce("phenology","Phenology"),Ce("altlat","Alt/Lat"),function(){fe('<div id="bsbiMapDownloadDiv" style="max-width: 500px">').appendTo(fe("#bsbi-atlas-download-left")),ne("#bsbiMapDownloadDiv");var e=re(),t=P("backdrop")?P("backdrop"):"colour_elevation",a=ve.bsbi_atlas.dataRoot+"rasters/";"none"!==t&&e.basemapImage(t,!0,a+"".concat(t,".png"),a+"".concat(t,".pgw"));c.periodClasses="print"}(),fe("<div>").appendTo(fe("#bsbi-atlas-download-left")).attr("id","bsbi-apparency-chart").css("max-width","400px"),le=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd"}],width:400,height:250,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",showLegend:!1,interactivity:"none"}),fe("<div>").appendTo(fe("#bsbi-atlas-download-left")).attr("id","bsbi-phenology-chart").css("max-width","400px"),de=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none"}),function(){fe("<div>").appendTo(fe("#bsbi-atlas-download-left")).attr("id","bsbi-altlat-chart").css("max-width","600px");pe=brccharts.altlat({selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1-10%"},{min:10.00001,max:30,radius:14,legend:"11-30%"},{min:30.00001,max:40,radius:16,legend:"31-40%"},{min:40.00001,max:50,radius:18,legend:"41-50%"},{min:50.00001,max:100,radius:20,legend:"51-100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:45,right:10,top:20,bottom:35},showTaxonLabel:!1,showLegend:!0,axisLabelFontSize:12,legendFontSize:10,interactivity:"toggle"})}()}function xe(e,t){var a="".concat(e,"_").concat(t,"_");return a=(a=(a=(a=a.replace(/ /g,"_")).replace(/\s+/g,"")).replace(/\./g,"_")).replace(/_+/g,"_")}function we(){return(we=r(regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d3.csv(ue);case 2:t=e.sent,ge=!1,a=regeneratorRuntime.mark((function e(a){var n,o,i,s,r,l,d,p,u,b,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ge){e.next=2;break}return e.abrupt("return","break");case 2:return n=t[a],o=xe(n.taxon,n.taxonId),i=void 0,s=void 0,r=void 0,l=void 0,d=he.indexOf(n.taxonId)>-1,p=be.indexOf(n.taxonId)>-1,c.showStatus=!d&&!p,u=Te(n.taxonId,o).catch((function(e){return i=e})),b=ke(n.taxonId,o).catch((function(e){return s=e})),h=Ee(n.taxonId,o).catch((function(e){return r=e})),f=Le(n.taxonId,o).catch((function(e){return l=e})),e.next=14,Promise.all([u,b,h,f]).then((function(){if(i||s||r||l){var e="<b>Problems for ".concat(n.taxon," (").concat(n.taxonId,")</b>");e+="<ul>",i&&(e+="<li>Map failed</li>"),s&&(e+="<li>Apparency chart failed</li>"),r&&(e+="<li>Phenology chart failed</li>"),l&&(e+="<li>Altlat chart failed</li>"),fe("<div>").appendTo(fe("#bsbi-atlas-download-right")).html(e)}}));case 14:case"end":return e.stop()}}),e)})),n=0;case 6:if(!(n<t.length)){e.next=14;break}return e.delegateYield(a(n),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:n++,e.next=6;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e,t){fe('<input type="checkbox" id="download-'.concat(e,'" style="margin:0.5em" checked>')).appendTo(fe("#bsbi-atlas-download-left")),fe('<label for="download-'.concat(e,'">').concat(t,"</label>")).appendTo(fe("#bsbi-atlas-download-left"))}function Te(e,t){return _e.apply(this,arguments)}function _e(){return(_e=r(regeneratorRuntime.mark((function e(t,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=re(),!fe("#download-map").is(":checked")){e.next=9;break}return me.identifier=t,ae(me),e.next=6,oe(!0);case 6:if(!a){e.next=9;break}return e.next=9,n.saveMap(!0,null,"".concat(xe(a,t),"map"));case 9:return e.abrupt("return",Promise.resolve());case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t){return Se.apply(this,arguments)}function Se(){return(Se=r(regeneratorRuntime.mark((function e(t,a){var n,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fe("#download-apparency").is(":checked")){e.next=16;break}return n="".concat(ve.bsbi_atlas.dataRoot,"bsbi/apparency/"),o=n+"all/"+t.replace(/\./g,"_")+".csv",e.next=5,d3.csv(o+"?prevent-cache=".concat(w)).catch((function(){return null}));case 5:if(i=e.sent){e.next=11;break}return s=n+"all/dummy.csv",e.next=10,d3.csv(s+"?prevent-cache=");case 10:i=e.sent;case 11:return e.next=13,_(le,i);case 13:if(!a){e.next=16;break}return e.next=16,le.saveImage(!0,"".concat(xe(a,t),"apparency"));case 16:return e.abrupt("return",Promise.resolve());case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e,t){return Re.apply(this,arguments)}function Re(){return(Re=r(regeneratorRuntime.mark((function e(t,a){var n,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fe("#download-phenology").is(":checked")){e.next=16;break}return n=ve.bsbi_atlas.dataRoot+"bsbi/captions/",o="".concat(n).concat(me.identifier.replace(/\./g,"_"),".csv"),e.next=5,d3.csv(o+"?prevent-cache=".concat(w)).catch((function(){return null}));case 5:if(i=e.sent){e.next=11;break}return s=phenologyRoot+"dummy-phenology.csv",e.next=10,d3.csv(s+"?prevent-cache=".concat(w));case 10:i=e.sent;case 11:return e.next=13,k(de,i,null);case 13:if(!a){e.next=16;break}return e.next=16,de.saveImage(!0,"".concat(xe(a,t),"phenology"));case 16:return e.abrupt("return",Promise.resolve());case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,t){return Be.apply(this,arguments)}function Be(){return(Be=r(regeneratorRuntime.mark((function e(t,a){var n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fe("#download-altlat").is(":checked")){e.next=11;break}return n=ve.bsbi_atlas.dataRoot+"bsbi/20220606/altlat/",o="".concat(n).concat(t.replace(/\./g,"_"),".csv?prevent-cache=").concat(w),e.next=5,d3.csv(o);case 5:return i=e.sent,e.next=8,E(pe,i);case 8:if(!a){e.next=11;break}return e.next=11,pe.saveImage(!0,"".concat(xe(a,t),"altlat"));case 11:return e.abrupt("return",Promise.resolve());case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(){fe("#download-map").is(":checked")||re().clearMap();fe("#download-apparency").is(":checked")||le.setChartOpts({data:[]}),fe("#download-phenology").is(":checked")||de.setChartOpts({data:[]}),fe("#download-altlat").is(":checked")||pe.setChartOpts({data:[]})}var Oe=jQuery;var Pe=jQuery,Me=drupalSettings;console.log("Running ".concat(o," version ").concat(i)),function(){var t=[],a={identifier:null,name:null,shortName:null,tetrad:null,isHybrid:!1,hybridMapping:!1};function o(e){var t=Pe("#bsbi-atlas-section-"+e);Pe("<p>").appendTo(t).text("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."),Pe("<p>").appendTo(t).text("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")}function i(e){var t=Pe("#bsbi-atlas-section-"+e),a=Pe('<div class=".container-fluid">').appendTo(t),n=Pe('<div class="row">').appendTo(a),o=Pe('<div class="col-sm-8">').appendTo(n),i=Pe('<div class="col-sm-4">').appendTo(n);o.append('<div id="bsbiMapDiv" width="100%"></div>'),o.append('<div id="dotCaption" width="100%" style="margin-top:1em"></div>'),o.append("<h4>Status etc for devel</h4>"),o.append('<div id="statusDevel" width="100%"></div>'),Pe('<div class="bsbi-selected-taxon-name bsbi-section-summary"></div>').appendTo(i).css("font-size","1.3em"),i.append("<hr/>"),i.append('<div id="bsbi-caption"></div>'),ne("#bsbiMapDiv"),ie(".bsbi-atlas-map-controls"),te()}function s(e){Pe("#bsbi-atlas-section-"+e).append('<div id="bsbi-phenology"></div>'),T("#bsbi-phenology")}function l(e){var t=Pe("#bsbi-atlas-section-"+e);t.append('<div id="bsbi-gallery" class="inline-gallery-container"></div>'),Pe('<div id="bsbi-gallery-copyright"></div>').appendTo(t).text("TODO - Copyright text to acknowledge Rob Still and Chris Gibson"),Pe("#bsbi-gallery-copyright").hide()}function d(e){var t=e;return Me.bsbi_atlas.dataBsbidb,t=(t=t.replace(/object.php\?entityid=/g,"atlas/")).replace(/&amp;class=TaxonInstance/g,"")}function p(){!function(t,a){if(a){var o=t+"bsbi/apparency/",i=t+"bsbi/captions/",s=t+"bsbi/20220606/",r=o+"all/"+a.replace(/\./g,"_")+".csv";n.csv(r+"?prevent-cache=").then((function(e){_(v,e)})).catch((function(){console.warn("Apparency chart failed for ".concat(r,". Error message:"),e),v.setChartOpts({data:[]})}));var c=o+"byLat/"+a.replace(/\./g,"_")+".csv";n.csv(c+"?prevent-cache=").then((function(e){S(g,x=e)})).catch((function(){console.warn("Apparency by latitude chart failed for ".concat(c,". Error message:"),e),g.setChartOpts({data:[],metrics:[],spread:!1})}));var l="".concat(i).concat(a.replace(/\./g,"_"),".csv");n.csv(l+"?prevent-cache=".concat(w)).then((function(e){k(m,e,"bsbi-phenology-source")})).catch((function(){console.warn("Phenology chart failed for ".concat(l,". Error message:"),e),m.setChartOpts({data:[]})}));var d="".concat(s,"altlat/").concat(a.replace(/\./g,"_"),".csv");n.csv(d).then((function(e){return E(y,e)})).catch((function(e){console.warn("altlat chart failed for ".concat(d,". Error message:"),e),y.setChartOpts({data:[]})}))}}(Me.bsbi_atlas.dataRoot,a.identifier)}function u(e){alert("link to ecoflora for: "+e)}function b(e){alert("link to world flora online for: "+e)}ae(a),Pe(document).ready((function(){addEventListener("popstate",(function(e){e.state&&e.state.identifier&&Pe(".atlas-taxon-selector-sel").selectpicker("val",e.state.identifier)})),"/download"===location.pathname?ye():(f("title","BSBI Online Plant Atlas 2020"),f("authors","Stroh, P. A., Humphrey, T., Burkmar, R. J., Pescott, O. L., , Roy, D.B., and Walker, K. J."),f("author","Stroh, P. A."),f("author","Humphrey, T."),f("author","Burkmar, R. J."),f("author","Pescott, O. L."),f("author","Roy, D. B."),f("author","Walker, K. J."),f("year","2022"),f("url",location.origin+"/atlas"),function(){c.periodClasses="standard";var e=[{group:null,id:"summary",title:"Summary",fn:i},{group:null,id:"conservation",title:"Conservation status",fn:o},{group:null,id:"gallery",title:"Gallery",fn:l},{group:"CHARACTERISTICS",id:"ecology",title:"Ecology",fn:s},{group:"EXTERNAL LINKS",id:"ecoflora",title:"EcoFlora",fn:u,external:!0},{group:"EXTERNAL LINKS",id:"worldfloraonline",title:"World Flora Online",fn:b,external:!0}];!function(){var e=Pe("<div>").appendTo(Pe(".bsbi-atlas-taxon-selector"));e.addClass("atlas-taxon-selector-div");var o=Pe("<select>").appendTo(e);o.addClass("atlas-taxon-selector-sel");var i=Pe("<button>").appendTo(e);i.addClass("atlas-taxon-selector-link"),i.attr("title","Copy link for taxon into clipboard"),i.addClass("btn btn-default"),i.html("&#128279;"),i.css("padding","6px 6px"),i.on("click",(function(){a.identifier&&I(location.origin+"/atlas/"+a.identifier)})),n.csv("".concat(Me.bsbi_atlas.dataRoot,"bsbi/taxon_list.csv?prevent-cache=").concat(w)).then((function(e){(t=e).forEach((function(e){var t="";e.vernacular&&(t="<b>"+e.vernacular+"</b> "),t+=e.formattedName;var a=Pe("<option>");a.attr("data-content",t),a.attr("value",e.ddbid),a.attr("data-taxon-name",e.taxonName),a.attr("data-vernacular",e.vernacular),a.attr("data-is-hybrid",e.hybrid);var n=e.hybridParentIds.split(";"),i=2===e.hybridParents.split(";").length&&2===n.length;a.attr("data-hybrid-mapping",i),a.html(t).appendTo(o)})),o.attr("data-size","10"),o.attr("data-live-search","true"),o.attr("data-header","Start typing the name of a taxon"),o.attr("title","Select a taxon"),o.selectpicker(),o.on("changed.bs.select",(function(e,o,i,s){a.identifier!==Pe(this).val()&&(a.identifier=Pe(this).val(),a.name=Pe(this).find(":selected").attr("data-content"),a.shortName=Pe(this).find(":selected").attr("data-taxon-name"),a.isHybrid="t"===Pe(this).find(":selected").attr("data-is-hybrid"),a.hybridMapping="true"===Pe(this).find(":selected").attr("data-hybrid-mapping"),o&&window.history.pushState({identifier:a.identifier},"BSBI Atlas - ".concat(a.shortName),"/atlas/".concat(a.identifier)),ae(a),te(),oe(),function(){var e=Pe("#bsbi-caption");e.html("");var o=Me.bsbi_atlas.dataRoot+"bsbi/captions/",i="".concat(o).concat(a.identifier.replace(/\./g,"_"),".csv?prevent-cache=").concat(w);n.csv(i).then((function(n){var o,i,s=(o=n[0].vernacular,i=n[0].formattedName,"<b>".concat(o,"</b> ").concat(i));if(Pe(".bsbi-selected-taxon-name").html("".concat(s)),n[0].atlasSpeciesDescription&&(e.append("<h4>Description</h4>"),Pe("<p>").appendTo(e).append(d(n[0].atlasSpeciesDescription)),Pe("<p>").appendTo(e).append("TODO - overall status")),n[0].captionedChildTaxonIds){e.append('<h4>Taxa covered <span id="bsbi-taxa-covered-toggle">[show]</span></h4>');var c=Pe('<ul id="bsbi-taxa-covered-list">').appendTo(e);n[0].captionedChildTaxonIds.split(";").forEach((function(e){var a=Pe("<li>").appendTo(c),n=t.find((function(t){return t.ddbid===e}));if(console.log("taxon",n),n){var o=Pe("<i>").appendTo(a),i=Pe("<a>").appendTo(o);i.attr("href","/atlas/".concat(e)),i.attr("alt","Link to ".concat(n.taxonName)),i.text(n.taxonName)}}));var l=!1;Pe("#bsbi-taxa-covered-toggle").click((function(){(l=!l)&&(Pe("#bsbi-taxa-covered-list").show(),Pe("#bsbi-taxa-covered-toggle").html("[hide]")),l||(Pe("#bsbi-taxa-covered-list").hide(),Pe("#bsbi-taxa-covered-toggle").html("[show]"))}))}n[0].atlasSpeciesTrends&&(e.append("<h4>Trends</h4>"),function(e,t,a,n,o){var i=Oe("<div>"),s=Oe("<div>").appendTo(i);s.css("display","flex"),s.css("font-weight","bold"),s.css("max-width","160px"),d(.8,"--","Strong decline"),d(.5,"-","Moderate decline"),d(.4,"0","Stable"),d(.6,"+","Moderate decline"),d(.7,"++","Strong decline");var r=Oe("<div>").appendTo(i);r.css("display","flex"),r.css("font-size","0.8em"),r.css("margin-bottom","1em"),r.css("max-width","160px");var c=Oe("<div>").appendTo(r);c.css("flex","2"),c.css("text-align","center"),c.text("decrease <<"),Oe("<div>").appendTo(r).css("flex","1");var l=Oe("<div>").appendTo(r);return l.css("flex","2"),l.css("text-align","center"),l.text(" >> increase"),i;function d(e,t,a){var n=Oe("<div>").appendTo(s);n.css("flex","1"),n.css("height","30px"),n.css("text-align","center"),n.css("line-height","30px"),n.css("vertical-align","middle"),n.css("border-left","1px solid silver"),n.css("border-top","1px solid silver"),n.css("border-bottom","1px solid silver"),"++"===t&&n.css("border-right","1px solid silver"),n.text(t),n.prop("title",a)}}().appendTo(e),Pe("<p>").appendTo(e).append(d(n[0].atlasSpeciesTrends)));n[0].atlasSpeciesBiogeography&&(e.append("<h4>Biogeography</h4>"),Pe("<p>").appendTo(e).append(d(n[0].atlasSpeciesBiogeography))),Pe("#statusDevel").html("");var p=Pe("<ul>").appendTo(Pe("#statusDevel"));if(["statusGB","statusIE","statusCI","csRedListEngland","csRedListWales","csNationalStatus","csRedListIreland","csRedDataList2005","csRedDataList2021"].forEach((function(e){Pe("<li>").appendTo(p).html("".concat(e,": ").concat(n[0][e]))})),n[0].hybridParents){var u=function(){var e=r(regeneratorRuntime.mark((function e(t){var a,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Me.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(t.replace(/\./g,"_"),".csv?prevent-cache=").concat(w),e.next=4,fetch(n,{method:"HEAD"});case 4:return o=e.sent,e.abrupt("return",o.ok);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.append("<h4>Hybrid parents</h4>");var b=Pe("<ul>").appendTo(e),h=n[0].hybridParents.split(";"),v=n[0].hybridParentIds.split(";");h.forEach(function(){var e=r(regeneratorRuntime.mark((function e(t,a){var n,o,i,s,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v[a]?v[a]:"",e.next=3,u(n);case 3:o=e.sent,i=Pe("<li>").appendTo(b),s=Pe("<i>").appendTo(i),o?((r=Pe("<a>").appendTo(s)).attr("href","/atlas/".concat(n)),r.attr("alt","Link to ".concat(t)),r.text(t)):s.text(t);case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}if(n[0].captionAuthors){e.append("<h4>Authors</h4>");for(var m,g=Pe("<p>").appendTo(e),y=n[0].captionAuthors.split(";"),x=0;x<y.length;x++)m=0===x?y[x]:x===y.length-1?"".concat(m," and ").concat(y[x]):"".concat(m,", ").concat(y[x]);g.text(m)}e.append('<h4>References <span id="bsbi-reference-toggle">[show]</span></h4>');var C=Pe('<div id="bsbi-reference-div">').appendTo(e);Pe('<p id="bsbi-reference-text">').appendTo(C).text("TODO - references");var T=!1;Pe("#bsbi-reference-toggle").click((function(){(T=!T)&&(Pe("#bsbi-reference-div").show(),Pe("#bsbi-reference-toggle").html("[hide]")),T||(Pe("#bsbi-reference-div").hide(),Pe("#bsbi-reference-toggle").html("[show]"))})),e.append('<h4>Recommended citation <span id="bsbi-citation-toggle">[show]</span></h4>');var _=Pe('<div id="bsbi-citation-div">').appendTo(e);Pe('<p id="bsbi-citation-text">').appendTo(_).append(M(a)),Pe('<button id="bsbi-citation-copy-text">Copy as text</button>').appendTo(_).addClass("btn btn-default"),Pe('<button id="bsbi-citation-copy-html">Copy as HTML</button>').appendTo(_).addClass("btn btn-default");var k=!1;Pe("#bsbi-citation-toggle").click((function(){(k=!k)&&(Pe("#bsbi-citation-div").show(),Pe("#bsbi-citation-toggle").html("[hide]")),k||(Pe("#bsbi-citation-div").hide(),Pe("#bsbi-citation-toggle").html("[show]"))})),Pe("#bsbi-citation-copy-text").click((function(){I(Pe("#bsbi-citation-text").text())})),Pe("#bsbi-citation-copy-html").click((function(){I(Pe("#bsbi-citation-text").html())})),f("title",n[0].taxonName+" in BSBI Online Plant Atlas 2020",!0)}))}(),p(),B("bsbi-gallery",a.identifier))})),Me.bsbi_atlas.identifier&&(o.selectpicker("val",Me.bsbi_atlas.identifier),window.history.pushState({identifier:Me.bsbi_atlas.identifier},"BSBI Atlas - ".concat(Me.bsbi_atlas.identifier),"/atlas/".concat(a.identifier))),se("taxaHybridList",t.filter((function(e){return 2===e.hybridParentIds.split(";").length})).map((function(e){var t=e.hybridParentIds.split(";"),a=e.hybridParents.split(";");return{taxon:e.ddbid,parent1:t[0],parent2:t[1],taxonName:e.taxonName,parent1Name:a[0],parent2Name:a[1]}}))),n.csv("".concat(Me.bsbi_atlas.dataRoot,"bsbi/no_status.csv?prevent-cache=").concat(w)).then((function(e){se("taxaNoStatusList",e.map((function(e){return e["ddb id"]})))}))})).catch((function(){console.log("Error reading taxon CSV")}))}();Pe(".brc-atlas-map-opts").remove(),Pe("#bsbi-atlas-gui").html(null);var h=Pe('<ul class="nav nav-tabs"></ul>').appendTo(Pe("#bsbi-atlas-gui"));e.forEach((function(e){e.external||h.append(function(e,t,a){var n=Pe("<li>");a===e&&n.addClass("active");return Pe('<a data-toggle="tab" href="#bsbi-atlas-section-'+e+'">').appendTo(n).text(t),n}(e.id,e.title,"summary"))}));var v=Pe('<div class="tab-content"></div>').appendTo(Pe("#bsbi-atlas-gui"));e.forEach((function(e){e.external||v.append(function(e,t,a){var n=Pe("<div/>",{id:"bsbi-atlas-section-"+e});n.addClass("tab-pane"),n.addClass("fade"),a===e&&(n.addClass("in"),n.addClass("active"));var o=Pe('<p class="bsbi-selected-taxon-name"></p>');return o.css("font-size","1.3em"),o.css("margin-top","0.5em"),o.addClass("bsbi-atlas-section-header"),n.append(o),n}(e.id,e.title,"summary"))})),e.forEach((function(e){e.external||e.fn(e.id)})),Pe('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=Pe(e.target).attr("href");"#bsbi-atlas-section-summary"===t?(Pe(".bsbi-atlas-map-controls").show(),oe()):Pe(".bsbi-atlas-map-controls").hide(),"#bsbi-atlas-section-ecology"===t&&p(),"#bsbi-atlas-section-gallery"===t&&B("bsbi-gallery",a.identifier)}))}(),function(e,t){if(0!==ce(e).length){var a,n={"2000_19":"2000 - 2019","1987_99":"1987 - 1999","1970_86":"1970 - 1986","1930_69":"1930 - 1969",pre_1930:"to 1929"},o={x:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null},n:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null},a:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null}},i={x:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null},n:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null},a:{"2000_19":null,"1987_99":null,"1970_86":null,"1930_69":null,pre_1930:null}},s={"sequential single hue Greys":["#f7f7f7","#cccccc","#969696","#636363","#252525"],"sequential single hue Greens":["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],"sequential single hue Blues":["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],"sequential single hue Oranges":["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],"sequential single hue Purples":["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],"sequential single hue Reds":["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],"sequential multi-hue BuGn":["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],"sequential multi-hue BuPu":["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],"sequential multi-hue GnBu":["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],"sequential multi-hue OrRd":["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],"sequential multi-hue PuBu":["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],"sequential multi-hue PuBuGn":["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],"sequential multi-hue PuRd":["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],"sequential multi-hue RdPu":["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],"sequential multi-hue YlGn":["#ffffcc","#c2e699","#78c679","#31a354","#006837"],"sequential multi-hue YlGnBu":["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],"sequential multi-hue YlOrBr":["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],"sequential multi-hue YlOrRd":["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],"diverging BrBG":["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],"diverging PiYG":["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],"diverging PRGn":["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],"diverging PuOr":["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],"diverging RdBu":["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],"diverging RdGy":["#ca0020","#f4a582","#ffffff","#bababa","#404040"],"diverging RdYlBu":["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],"diverging RdYlGn":["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],"diverging Spectral":["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"]},r=ce('<div style="margin-top: 1em">').appendTo(ce(e)),l=ce('<div style="display: flex">').appendTo(r),d=ce('<div style="flex: 1">').appendTo(l),p=ce('<div style="flex: 1">').appendTo(l),u=ce('<div style="flex: 1">').appendTo(l);ce("<h4>").appendTo(d).text("Without status"),g("x","2000_19",d),g("x","1987_99",d),g("x","1970_86",d),g("x","1930_69",d),g("x","pre_1930",d),ce("<h4>").appendTo(p).text("Native status"),g("n","2000_19",p),g("n","1987_99",p),g("n","1970_86",p),g("n","1930_69",p),g("n","pre_1930",p),ce("<h4>").appendTo(u).text("Alien status"),g("a","2000_19",u),g("a","1987_99",u),g("a","1970_86",u),g("a","1930_69",u),g("a","pre_1930",u),ce("<h4>").appendTo(r).text("Borders"),function(e){var o=ce("<div>").appendTo(e);ce('<input type="text" style="width: 120px" id="colour_stroke">').appendTo(o),ce('<label for="colour_stroke" style="margin-left: 1em">Border colour</label>').appendTo(o),(a=new JSColor("#colour_stroke")).fromString("#000000");var s=["x","n","a"],r=["2000_19","1987_99","1970_86","1930_69","pre_1930"];a.option({onChange:function(){s.forEach((function(e){r.forEach((function(t){var o=i[e][n[t]];c.periodStroke[c.periodClasses][e][n[t]]=o.is(":checked")?a.toHEXString():null}))})),t()}})}(r),ce("<h4>").appendTo(r).text("Init colours from Colourbrewer");var b=ce("<select>").appendTo(r);Object.keys(s).forEach((function(e){ce("<option>").text(e).appendTo(b)}));var h=ce('<input type="checkbox" id="reverse-colours" style="margin:0.5em">').appendTo(r);ce('<label for="reverse-colours">reverse</label>').appendTo(r);var f=ce('<button style="margin-left: 0.5em">').text("Without status").appendTo(r),v=ce('<button style="margin-left: 0.5em">').text("Native").appendTo(r),m=ce('<button style="margin-left: 0.5em">').text("Alien").appendTo(r);f.click((function(){x("x",b.find(":selected").text(),h.is(":checked"))})),v.click((function(){x("n",b.find(":selected").text(),h.is(":checked"))})),m.click((function(){x("a",b.find(":selected").text(),h.is(":checked"))}))}function g(e,t,a){var s=ce("<div>").appendTo(a);ce('<input type="text" style="width: 120px" id="colour'.concat(t,"_").concat(e,'">')).appendTo(s);var r=ce('<input type="checkbox" id="stroke'.concat(t,"_").concat(e,'" style="margin-left: 1em">')).appendTo(s);ce('<label for="colour'.concat(t,"_").concat(e,'" style="margin-left: 1em">').concat(t.replace("_","-"),"</label>")).appendTo(s);var l=new JSColor("#colour".concat(t,"_").concat(e));l.option({onChange:function(){y(l,r,e,t)}}),r.change((function(){y(l,r,e,t)})),l.fromString(c.periodColours[c.periodClasses][e][n[t]]),r.prop("checked",""!==c.periodStroke[c.periodClasses][e][n[t]]),o[e][n[t]]=l,i[e][n[t]]=r}function y(e,o,i,s){c.periodColours[c.periodClasses][i][n[s]]=e.toHEXString(),c.periodStroke[c.periodClasses][i][n[s]]=o.is(":checked")?a.toHEXString():null,"1930_69"===s&&(c.periodColours[c.periodClasses][i]["prior 1970"]=e.toHEXString(),c.periodStroke[c.periodClasses][i]["prior 1970"]=o.is(":checked")?a.toHEXString():null),t()}function x(e,a,i){console.log("init",e,a);var r=s[a],l=["2000_19","1987_99","1970_86","1930_69","pre_1930"].reverse();i&&l.reverse(),l[c.periodClasses].forEach((function(t,a){c.periodColours[c.periodClasses][e][n[t]]=r[a],o[e][n[t]].fromString(r[a])})),t()}}("#bsbi-atlas-development",oe))}))}()}));
//# sourceMappingURL=bsbi-atlas-min.umd.js.map
