!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3)}(this,(function(t){"use strict";function a(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}})),e.default=t,Object.freeze(e)}var n=a(t),o="bsbi-atlas",i="0.2.0";function r(t,e,a,n,o,i,r){try{var s=t[i](r),c=s.value}catch(t){return void a(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var i=t.apply(e,a);function s(t){r(i,n,o,s,c,"next",t)}function c(t){r(i,n,o,s,c,"throw",t)}s(void 0)}))}}function c(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var d={bsbiDataRoot:"",periodClasses:"standard",showStatus:!0,resolution:"hectad",displayedMapType:"static",taxaHybridList:[],taxaNoStatusList:[],changeColours:["#FAD0C8","#DD5A2F","#525252"],symboltype:"circle",periodColours:{},dotCaption:""};d.periodColours.standard={x:{"to 1929":"#f7f7f7","1930 - 1969":"#c6c6c6","1970 - 1986":"#909090","1987 - 1999":"#4e4e4e","2000 - 2019":"#000000"},n:{"to 1929":"#eff3ff","1930 - 1969":"#bdd7e7","1970 - 1986":"#6baed6","1987 - 1999":"#2b71a5","2000 - 2019":"#004d99"},a:{"to 1929":"#FEE5D9","1930 - 1969":"#FCBCB4","1970 - 1986":"#FF8C86","1987 - 1999":"#FF0000","2000 - 2019":"#B30000"},bullseye:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"to 1929":"black","1930 - 1969":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},d.periodColours.print={x:{"pre-1970":"#f7f7f7","1970 - 1986":"#b9b9b9","1987 - 1999":"#6f6f6f","2000 - 2019":"#000000"},n:{"pre-1970":"#eff3ff","1970 - 1986":"#bdd7e7","1987 - 1999":"#368dcd","2000 - 2019":"#004d99"},a:{"pre-1970":"#fee5d9","1970 - 1986":"#fc9898","1987 - 1999":"#ff4646","2000 - 2019":"#b30000"},bullseye:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"},missing:{"pre-1970":"black","1970 - 1986":"black","1987 - 1999":"black","2000 - 2019":"black"}},d.periodStroke={},d.periodStroke.standard={x:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"to 1929":"#808080","1930 - 1969":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}},d.periodStroke.print={x:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},n:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},a:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},bullseye:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"},missing:{"pre-1970":"#808080","1970 - 1986":"#808080","1987 - 1999":"#808080","2000 - 2019":"#808080"}};var p={};function u(t,e){var a=e||"hectads";return"".concat(d.bsbiDataRoot).concat(a,"/").concat(t.replace(".","_"),".csv")}function h(t){return"to 1929"===t?"pre-1930":t.replace(" - ","–")}function b(t,e){return d.dotCaption="Hectad:<br/>Occurrence:",new Promise((function(a,o){n.csv(u(t),(function(t){if(t.hectad){var a=!1;p[d.periodClasses][e].csvperiods.forEach((function(e){"1"===t[e]&&(a=!0)}));var n=!1;if(p[d.periodClasses][e].prior.forEach((function(e){"1"===t[e]&&(n=!0)})),a||n)return{gr:t.hectad,shape:"circle",size:1,colour:a?"#000000":"#b0b0b0",opacity:1,stroke:"#808080",caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n            Occurrence: <b>").concat(a?"in":"prior to","</b> the period <b>").concat(h(e),"</b>"),noCaption:d.dotCaption}}})).then((function(t){var n={precision:1e4,size:1,lines:[{colour:"#636363",opacity:1,stroke:"black",text:h(e),shape:"circle"},{colour:"#bdbdbd",opacity:1,stroke:"black",text:"Earlier",shape:"circle"}]};"to 1929"==e&&n.lines.pop(),a({records:t,precision:1e4,opacity:1,size:1,legend:n})})).catch((function(t){o(t)}))}))}function f(t,e,a,o){d.dotCaption="Hectad:</br>Change:";var i=["square","triangle-up","triangle-down"],r=d.changeColours;return new Promise((function(s,c){n.csv(u(t),(function(t){var n,o,s=e.some((function(e){return"1"===t[e]})),c=a.some((function(e){return"1"===t[e]}));if(s&&c?(n=0,o="Present in both periods"):!s&&c?(n=1,o="Gain"):s&&!c?(n=2,o="Loss"):n=100,t.hectad&&n<100)return{gr:t.hectad,colour:r[n],shape:i[n],caption:"Hectad: <b>".concat(t.hectad,"</b></br>Change: <b>").concat(o,"</b>"),noCaption:d.dotCaption}})).then((function(t){s({records:t,size:1,precision:1e4,opacity:1,legend:{title:o,size:1,precision:1e4,opacity:1,lines:[{colour:r[1],text:"Gain",shape:"triangle-up"},{colour:r[0],text:"No change",shape:"square"},{colour:r[2],text:"Loss",shape:"triangle-down"}]}})})).catch((function(t){c(t)}))}))}p.print={"pre-1970":{prior:[],csvperiods:["to 1929","1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},p.standard={"to 1929":{prior:[],csvperiods:["to 1929"]},"1930 - 1969":{prior:["to 1929"],csvperiods:["1930 - 1969"]},"1970 - 1986":{prior:["to 1929","1930 - 1969"],csvperiods:["1970 - 1986"]},"1987 - 1999":{prior:["to 1929","1930 - 1969","1970 - 1986"],csvperiods:["1987 - 1999"]},"2000 - 2019":{prior:["to 1929","1930 - 1969","1970 - 1986","1987 - 1999"],csvperiods:["2000 - 2009","2010 - 2019"]}},d.distAllClasses=function(t){return"hectad"===d.resolution?function(t){var e={n:"Native",a:"Non-native (alien)",bullseye:"Introduced",missing:"missing"},a={"pre-1970":"pre-1970","to 1929":"pre-1930","1930 - 1969":"1930–69","1970 - 1986":"1970–86","1987 - 1999":"1987–99","2000 - 2019":"2000–19"},o={"pre-1970":1,"to 1929":1,"1930 - 1969":1,"1970 - 1986":1,"1987 - 1999":1,"2000 - 2019":1},i=Object.keys(p[d.periodClasses]).reverse();return new Promise((function(r,s){var c={};i.forEach((function(t){c[t]={ire:{n:0,a:0,bullseye:0,missing:0,total:0},gb:{n:0,a:0,bullseye:0,missing:0,total:0}}})),d.showStatus?d.dotCaption="Hectad:<br/>\n        Most recent dateclass:<br/>\n        Status:</b>":d.dotCaption="Hectad:<br/>\n        Most recent dateclass:",n.csv(u(t),(function(t){if(t.hectad){var n;n=3===t.hectad.length?"ire":"gb";var r=t.hectadstatus?t.hectadstatus:"missing";-1===["n","a","bullseye","missing"].indexOf(r)&&(r="missing");for(var s,l,u=!1,b=0;b<i.length;b++){s=i[b];for(var f=p[d.periodClasses][s].csvperiods,m=0;m<f.length;m++){if("1"===t[f[m]]){c[s][n][r]++,c[s][n].total++,u=!0,l=l||s;break}}}for(var v,g={},y=0;y<i.length;y++){s=i[y],g[s]=0;for(var x=p[d.periodClasses][s].csvperiods,w=0;w<x.length;w++){if("1"===t[x[w]]){g[s]=1;break}}}if(u)return v=d.showStatus?{gr:t.hectad,shape:"circle",colour:d.periodColours[d.periodClasses][r][l],stroke:d.periodStroke[d.periodClasses][r][l],size:"missing"===r?.5:1,opacity:o[l],caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(h(l),"</b><br/>\n                        Status: <b>").concat(e[r],"</b>"),noCaption:d.dotCaption}:{gr:t.hectad,shape:"circle",colour:d.periodColours[d.periodClasses].x[l],stroke:d.periodStroke[d.periodClasses].x[l],size:1,opacity:o[l],caption:"Hectad: <b>".concat(t.hectad,"</b><br/>\n                        Most recent dateclass: <b>").concat(h(l),"</b>"),noCaption:d.dotCaption},Object.keys(g).forEach((function(t){v[a[t]]=g[t]})),v}})).then((function(t){var e=i.reduce((function(t,e){return t+c[e].gb.a+c[e].ire.a}),0),n=i.reduce((function(t,e){return t+c[e].gb.n+c[e].ire.n}),0),s=[];d.showStatus?(n&&(s.push({text:["Native","","GB","IR"],underline:!0}),i.forEach((function(t){s.push({colour:d.periodColours[d.periodClasses].n[t],stroke:d.periodStroke[d.periodClasses].n[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.n,c[t].ire.n],shape:"circle"})}))),n&&e&&s.push({text:[]}),e&&(s.push({text:["Alien","","GB","IR"],underline:!0}),i.forEach((function(t){s.push({colour:d.periodColours[d.periodClasses].a[t],stroke:d.periodStroke[d.periodClasses].a[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.a,c[t].ire.a],shape:"circle"})})))):(s=[{text:["","","GB","IR"],underline:!0}],i.forEach((function(t){s.push({colour:d.periodColours[d.periodClasses].x[t],stroke:d.periodStroke[d.periodClasses].x[t],opacity:o[t],text:[a[t],"symbol",c[t].gb.total,c[t].ire.total],shape:"circle"})}))),r({records:t,precision:1e4,size:1,legend:{size:.8,raligned:[!1,!1,!0,!0],padding:5,lines:s}})})).catch((function(t){s(t)}))}))}(t):"tetrad"===d.resolution?function(t){return d.dotCaption="Tetrad:",new Promise((function(e,a){n.csv(u(t,"tetrads"),(function(t){if(t.tetrad)return{gr:t.tetrad,shape:"square",colour:"black",size:1,opacity:1,caption:"Tetrad: <b>".concat(t.tetrad,"</b>"),noCaption:d.dotCaption}})).then((function(t){e({records:t,precision:2e3,size:1,legend:{lines:[{colour:"black",opacity:1,text:"Present in tetrad",shape:"square"}]}})})).catch((function(t){a(t)}))}))}(t):function(t){return new Promise((function(e,a){n.csv(u(t,"monads"),(function(t){if(t.gr)return{gr:t.gr,shape:"square",colour:"black",size:1,opacity:1}})).then((function(t){e({records:t,precision:1e3,size:1,legend:{lines:[{colour:"black",opacity:1,text:"Present in monad",shape:"square"}]}})})).catch((function(t){a(t)}))}))}(t)},d.status_29=function(t){return b(t,"to 1929")},d.status_30_69=function(t){return b(t,"1930 - 1969")},d.status_70_86=function(t){return b(t,"1970 - 1986")},d.status_87_99=function(t){return b(t,"1987 - 1999")},d.status_00_19=function(t){return b(t,"2000 - 2019")},d.hybrid=function(t){var e=d.taxaHybridList.find((function(e){return e.taxon===t}));function a(t){return"<i>"+t.replace(/ x /g,"</i> x <i>")+"</i>"}var o=new Promise((function(e,a){n.csv(u(t)).then((function(t){e(t)})).catch((function(e){console.log("Hybrid map: can't retrieve map data for hybrid taxon ".concat(t)),a(e)}))})),i=new Promise((function(t,a){n.csv(u(e.parent1)).then((function(e){t(e)})).catch((function(t){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(e.parent1)),a(t)}))})),r=new Promise((function(t,a){n.csv(u(e.parent2)).then((function(e){t(e)})).catch((function(t){console.log("Hybrid map: can't retrieve map data for parent taxon ".concat(e.parent2)),a(t)}))}));return d.dotCaption="Hectad: <br/>\n    <i>".concat(e.parent1Name,"</i>: </br>\n    <i>").concat(e.parent2Name,"</i>: </br>\n    Hybrid:"),new Promise((function(t,n){Promise.all([o,i,r]).then((function(n){var o=[];n.forEach((function(t,e){t.forEach((function(t){var a=o.find((function(e){return t.hectad===e.gr}));if(a)a.presence[e]=!0;else{var n=[!1,!1,!1];n[e]=!0,o.push({gr:t.hectad,presence:n})}}))})),o.forEach((function(t){t.colour=t.presence[1]&&t.presence[2]?"#F7F619":t.presence[1]?"#E4C3AA":"#A8CBE2",t.caption="Hectad: <b>".concat(t.gr,"</b><br/>\n          <i>").concat(e.parent1Name,"</i>: <b>").concat(t.presence[1]?"present":"absent","</b></br>\n          <i>").concat(e.parent2Name,"</i>: <b>").concat(t.presence[2]?"present":"absent","</b></br>\n          Hybrid: <b>").concat(t.presence[0]?"present":"absent","</b>"),t.noCaption=d.dotCaption}));for(var i=o.length,r=0;r<i;r++)o[r].presence[0]&&o.push({gr:o[r].gr,shape:"square",size:.6,colour:"black",caption:o[r].caption,noCaption:o[r].noCaption});t({records:o,precision:1e4,shape:"circle",size:1,opacity:1,legend:{lines:[{colour:"black",text:"Hybrid recorded",shape:"square",size:.6},{colour:"#E4C3AA",text:a(e.parent1Name)},{colour:"#A8CBE2",text:a(e.parent2Name)},{colour:"#F7F619",text:"Both parents"}]}})})).catch((function(t){n(t)}))}))},d.change_1987_1999_vs_2000_2019=function(t){return f(t,["1987 - 1999"],["2000 - 2009","2010 - 2019"],"Change from 1987–1999 to 2000–2019")},d.change_1930_1969_vs_2000_2019=function(t){return f(t,["1930 - 1969"],["2000 - 2009","2010 - 2019"],"Change from 1930–1969 to 2000–2019")},d.bsbiHectadDateTetFreq=function(t){return d.dotCaption="Hectad: </br>Tetrads where present:",new Promise((function(e,a){n.csv(u(t),(function(t){var e=Number(t["distinct tetrads"]),a=5*Math.ceil(e/5);if(t.hectad&&e)return{gr:t.hectad,size:Math.sqrt(a)/5,caption:"Hectad: <b>".concat(t.hectad,"</b></br>Tetrads where present: <b>").concat(e,"</b>"),noCaption:d.dotCaption}})).then((function(t){e({records:t,colour:"black",shape:"circle",precision:1e4,opacity:1,legend:{title:"Tetrad frequency",size:1,shape:"circle",colour:"black",precision:1e4,opacity:1,lines:[{text:"1–5",size:Math.sqrt(5)/5*.5},{text:"6–10",size:Math.sqrt(10)/5*.5},{text:"11–15",size:Math.sqrt(15)/5*.5},{text:"16–20",size:Math.sqrt(20)/5*.5},{text:"21–25",size:Math.sqrt(25)/5*.5}]}})})).catch((function(t){a(t)}))}))};var m=jQuery;function v(t,e,a){var n=function(t,e,a){a?m('meta[name="'+t+'"').attr("content",e):m("head").append('<meta name="'+t+'" content="'+e+'" />')};switch(t){case"title":m("head title").html(e),n("citation_title",e,a),n("dc.title",e,a),n("dcterms.title",e,a),n("prism.alternateTitle",e,a),n("eprints.title",e,a),n("bepress_citation_title",e,a);break;case"author":n("citation_author",e),n("dc.creator",e),n("dcterms.creator",e),n("eprints.creators_name",e),n("bepress_citation_author",e);break;case"authors":n("author",e),n("citation_authors",e);break;case"year":n("citation_year",e),n("citation_date",e),n("citation_publication_date",e),n("dc.date",e),n("dcterms.date",e),n("dcterms.created",e),n("prism.copyrightYear",e),n("prism.coverDate",e),n("prism.publicationDate",e),n("eprints.datestamp",e),n("eprints.date",e),n("bepress_citation_date",e);break;case"url":n("citation_public_url",e),n("prism.url",e),n("eprints.official_url",e),n("bepress_citation_pdf_url",e)}}var g,y,x,w,k,T="20220712-1",C=jQuery;function _(t){var e,a,n;e=C(t),a=C("<div>").appendTo(e),(n=C("<select>").appendTo(a)).attr("id","atlas-lat-phen-data-type"),n.addClass("selectpicker"),n.attr("data-width","100%"),n.on("changed.bs.select",(function(){k.length&&L(x,k)})),[{caption:"Scale by relative abundance",val:"count"},{caption:"Scale across latitudes",val:"scaled"},{caption:"Scale within latitude",val:"density"}].forEach((function(t){var e=(t.selected,C("<option>"));e.attr("value",t.val),e.html(t.caption).appendTo(n)})),n.val("count"),n.selectpicker()}function S(t,e){var a=e.map((function(t){return{taxon:"taxon",week:Number(t.week),n:Number(t.n)}})).sort((function(t,e){return t.week>e.week}));return t.setChartOpts({data:a})}function E(t,e,a){var n=[1,32,60,91,121,152,182,213,244,274,305,335,365],o=e[0].phenFlowerStart,i=e[0].phenFlowerEnd,r=e[0].phenLeafStart,s=e[0].phenLeafEnd,c=n[Number(o)-1],l=n[Number(i)],d=n[Number(r)-1],p=n[Number(s)],u=[],h=[];c&&l&&(u=c>l?[[c,365],[1,l]]:[[c,l]]),d&&p&&(h=d>p?[[d,365],[1,p]]:[[d,p]]);if(a){var b,f=y(e[0].phenFlowerRef),m=y(e[0].phenLeafRef);u.length&&(b="Data for flower phenology from ".concat(f,".")),u.length&&h.length&&(b="".concat(b,"  ")),h.length&&(b="".concat(b,"Data for leafing phenology from ").concat(m,".")),C("#".concat(a)).html(b)}var v=[],g=0;return u.length&&v.push({prop:"flower",label:"Flowering",colour:"#fc8d62",svg:"M1048.256,633.499c212.849-356.854,285.555-335.845-191.845-590.438C384.889,283.217,484.493,353.496,664.566,633.499 c-310.065-285.921-239.639-396.021-620.823,0c64.157,504.336,28.591,448.084,502.257,364.911 c-416.078,181.718-421.368,113.233-191.845,590.438c503.843,103.322,428.181,97.12,502.257-364.911 c69.825,407.236,10.978,486.041,502.257,364.911c233.666-457.592,211.268-427.46-191.845-590.438 c452.881,101.063,461.097,199.985,502.257-364.911C1305.872,228.612,1381.606,318.787,1048.256,633.499z M856.411,1100.523 c-114.579,0-207.463-92.884-207.463-207.463s92.884-207.463,207.463-207.463c114.578,0,207.463,92.884,207.463,207.463 S970.989,1100.523,856.411,1100.523z",legendOrder:++g}),h.length&&v.push({prop:"leaf",label:"In leaf",colour:"#66c2a5",svg:"m12941 19084-175-112-108 54c-59 30-112 54-117 54s-97-112-203-250l-193-250h-150-151l-177-188c-97-104-186-197-197-207-19-17-23-16-139 49-66 36-124 66-128 65-6 0-219-276-359-464-10-14-30-7-149 53l-138 70-26-32c-15-17-103-124-195-238-92-115-171-208-175-208s-61 25-127 55l-119 55-90-92c-50-51-149-155-220-230l-130-138-112 100c-61 55-115 100-120 100-4 0-123-122-263-269-140-148-260-270-266-270-5-1-65 39-131 88l-122 90-233-207c-129-114-264-233-300-265l-66-58-138 80-139 80-139-147c-77-81-181-189-231-240l-91-94-161 80-160 81-169-201c-93-110-176-209-184-219-15-19-19-18-174 26-87 25-162 42-167 39s-79-90-164-194c-140-171-158-188-178-181-12 5-73 30-134 56-62 26-116 45-121 43-5-1-105-104-222-226-192-202-216-223-239-218-14 3-82 23-151 44l-126 38-249-262c-138-145-252-263-255-263s-45 55-95 124c-49 68-92 121-96 117s-98-138-209-299l-201-292-138 69-139 69-223-336c-123-184-227-339-230-344s-83-20-177-33c-95-12-174-25-176-27s-52-107-111-234c-59-126-111-233-114-237-4-4-62 8-130 27-69 19-125 34-127 32-1-1-57-139-125-307-67-168-124-307-125-309-2-2-69-14-150-27-80-12-147-24-149-26-3-2-30-125-60-273-31-149-58-272-60-274-3-2-68 2-146 8-77 7-144 10-147 6-3-3-16-132-28-286s-23-281-25-283-79-18-171-36l-168-34-2-380-3-381-193-79c-139-57-192-84-192-95 0-9 29-149 65-310s65-295 63-296c-2-2-86-43-188-91s-188-90-192-93 45-170 108-371l114-365-67-65c-38-36-110-104-162-152l-93-86 136-329c75-181 136-332 136-337 0-4-58-90-128-190-71-99-132-187-136-194-6-10 62-142 290-561 15-26 21-48 16-55-5-6-66-82-135-170-70-87-127-162-127-166 0-5 108-183 239-396l240-387-90-99c-49-54-89-102-89-107s111-164 246-353c136-188 253-353 261-365 13-20 10-32-43-149-55-124-56-128-38-143 11-9 182-159 381-334l361-317-5-43c-3-23-13-105-24-182-10-77-16-141-15-143 4-3 510-150 857-248 15-4 13-20-18-141-18-74-32-137-31-139 2-1 138-21 303-42 279-37 309-43 431-86 238-83 552-155 824-188 141-17 699-17 840 0 648 79 1266 287 1860 624 111 64 378 237 494 320 46 34 67 44 62 32-4-11-35-107-68-214-397-1294-750-2359-915-2764-72-178-107-247-165-332-72-104-110-172-148-269-56-142-97-325-73-325 29 0 420 94 429 104 6 6 46 128 89 271 42 143 142 478 222 745 79 267 202 679 273 915 71 237 185 621 255 855s151 506 181 604c30 99 54 185 54 193 0 27 18 12 35-30 31-80 204-397 305-558 282-454 581-807 1323-1564l245-250 114 113c62 61 116 112 120 112s118-122 253-270c136-149 250-270 254-270 3 0 40 68 81 151s78 152 82 155c3 2 122-66 263-152 180-110 259-153 264-145 5 7 18 57 30 112l22 99h515c283 0 514 1 514 3s-20 52-44 112l-44 110 479 3c310 1 479 6 479 12s-14 58-31 116-30 106-28 108c2 1 179 26 392 56 214 30 392 57 398 60 5 4-4 44-21 95-16 49-30 94-30 100 0 7 112 32 288 64 158 29 296 55 307 58 20 4 20 7 9 141-7 75-12 138-11 138 5 5 558 214 564 214 5 0 14 4 21 9 13 8 10 15-74 227-3 5 144 82 326 169 181 88 330 164 330 170s-30 84-66 174c-53 134-63 166-52 176 7 7 105 85 218 175s210 168 217 174c9 8-1 46-42 164-30 84-55 157-55 162s101 91 225 190 225 183 225 186-56 66-124 140l-125 135 194 217c107 119 195 219 194 222 0 3-45 41-100 85-54 44-111 90-125 101l-26 21 145 289c80 159 147 294 148 299 1 6-25 25-57 44-33 18-78 44-101 57l-41 24 124 226c69 124 124 229 122 234-2 4-42 42-90 84l-87 76 28 63c15 34 72 158 126 276l98 214-39 36c-21 20-68 61-103 93l-64 56 136 261c76 144 137 263 137 265 0 3-57 23-127 46-71 24-132 46-136 50-4 3 33 128 82 276s88 270 86 272-45-6-95-18c-51-11-95-19-98-16-5 6-4 13 77 405 28 135 49 246 47 248-1 2-36-11-76-27-39-17-74-30-76-27-2 2 1 111 6 243 5 131 10 284 10 339v100l-87-10c-49-6-89-8-90-5s29 140 66 305 67 301 66 303c-2 2-53-22-114-52-91-46-111-53-111-39 0 10 9 144 20 298s20 297 20 317v37l-72-20c-40-11-81-22-90-25-17-5-18 16-18 350 0 278-3 356-12 356-7 0-53-9-102-20s-91-19-92-17c-1 1-17 106-35 232-18 127-35 233-38 237-3 3-39-7-79-24s-74-29-76-27c-3 2-15 155-27 339s-23 336-25 338c-1 2-45-15-98-39-53-23-99-39-102-36s-17 167-30 364c-12 197-23 359-24 361 0 1-43-32-96-73s-99-75-103-75-26 141-50 313c-23 171-44 319-47 328-4 14-14 14-102-6-53-12-100-20-103-16-4 3-31 143-60 309-30 167-57 309-61 315-4 7-30 0-77-21-39-18-73-32-76-32s-5 149-5 330c0 182-3 330-6 330s-49-29-101-65c-53-36-97-64-98-63-2 2-8 154-15 338-6 184-13 337-15 338-2 2-40-24-85-57-44-34-84-61-89-61-4 0-7 10-5 23 2 12 11 139 19 282s18 291 21 329l6 69-126-5c-114-5-126-4-122 11 8 27 126 657 126 673 0 10-37 25-115 48-104 30-114 35-110 54 3 12 16 71 30 131 102 438 125 539 125 551 0 10-24 14-99 16l-98 3 112 248 113 248-27 10c-14 6-61 22-104 35l-77 25 52 97c28 53 75 142 105 196 29 55 52 100 51 101-2 1-42 17-90 35-49 18-88 38-88 45s11 86 25 175c14 90 24 166 23 170-2 4-81-43-177-106z",legendOrder:++g}),t.setChartOpts({data:[{taxon:"taxon",leaf:h.map((function(t){return{start:t[0],end:t[1]}})),flower:u.map((function(t){return{start:t[0],end:t[1]}}))}],metrics:v});function y(t){var e=C("<div>");e.html(t);var a=e.children("span").eq(0),n=e.children("span").eq(1);return a&&n&&"Poland, J."===a.text()&&"personal observation"===n.text()&&a.text("John Poland,"),e.html()}}function L(t,e){var a=C("#atlas-lat-phen-data-type").val(),n=e.filter((function(t){return t.type===a})).map((function(t){var e={taxon:"taxon"};return Object.keys(t).forEach((function(a){e[a]=Number(t[a])})),e})),o=["50","51","52","53","54","55","56","57","58","59","60"].map((function(t){return{prop:t,label:t,colour:"green",fill:"#ddffdd"}})),i=n.sort((function(t,e){return t.week>e.week}));return t.setChartOpts({data:i,metrics:o,spread:!0})}function R(t,e){var a=e.map((function(t){return{distance:Number(t.distance),altitude:Number(t.altitude),metric:Number(t.percent),taxon:"dummy"}}));return t.setChartOpts({data:a})}function I(t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);var e=document.createElement("textarea");return e.value=t,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select(),new Promise((function(t,a){document.execCommand("copy")?t():a(),e.remove()}))}function N(t,e,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}function A(t){for(var e=t+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var o=a[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function B(t,e){return e?"<i>".concat(t.shortName.replace(/\s/g,"</i> <i>"),"</i> in <i>BSBI</i> <i>Online</i> <i>Atlas</i> <i>2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(t.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]"):"<i>".concat(t.shortName,"</i> in <i>BSBI Online Plant Atlas 2020</i>, eds P.A. Stroh, T. A. Humphrey, R.J. Burkmar, O.L. Pescott, D.B. Roy, & K.J. Walker. ").concat(location.origin,"/atlas/").concat(t.identifier," [Accessed ").concat((new Date).toLocaleDateString("en-GB"),"]")}var M,P,O,D,z,F,H,q,G,W=jQuery,j=drupalSettings,J=A("trend-region")?A("trend-region"):"Britain",U=A("trend-term")?A("trend-term"):"long",V=A("trend-scale")?A("trend-scale"):"within",K=A("trend-scale-density")?A("trend-scale-density"):"max";function Q(t){var e,a,o,i,r,s,l;(t&&(G=t),G.identifier)&&(e=j.bsbi_atlas.dataRoot+"bsbi/trends/",a=n.csv("".concat(e).concat(U,"/trends-gam/").concat(J,"/").concat(G.identifier.replace(/\./g,"_"),".csv?").concat(T),(function(t){return{year:Number(t.year),value:Number(t.x50),upper:Number(t.x95),lower:Number(t.x5)}})),o=n.csv("".concat(e).concat(U,"/trends-linmod/").concat(J,"/").concat(G.identifier.replace(/\./g,"_"),".csv?").concat(T),(function(t){return{gradient:Number(t.gradient),intercept:Number(t.intercept)}})),i=n.csv("".concat(e).concat(U,"/trends-lt-mean-sd/").concat(J,"/").concat(G.identifier.replace(/\./g,"_"),".csv?").concat(T),(function(t){return{year:Number(t.year),mean:Number(t.mean),sd:Number(t.std)}})),r=n.csv("".concat(e).concat(U,"/trends-summaries/").concat(J,"/").concat(G.identifier.replace(/\./g,"_"),".csv?").concat(T),(function(t){return[{value:Number(t.declineStrong),label:"Strong decline",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.declineMod),label:"Moderate decline",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.stable),label:"Stable",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.increaseMod),label:"Moderate increase",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"},{value:Number(t.increaseStrong),label:"Strong increase",stroke:"grey",strokeWidth:1,fill:"rgb(230,230,230)"}]})),s=n.csv("".concat(e).concat(U,"/trends-linmod/").concat(J,"/mean-gradients.csv?").concat(T),(function(t){return{slope:Number(t.gradient)}})),l=n.csv("".concat(e).concat(U,"/trends-linmod/centiles.csv?").concat(T),(function(t){return{region:t.region,c5:Number(t.c5),c95:Number(t.c95)}})),Promise.allSettled([a,o,i,r,s,l])).then((function(t){var e,a,n,o;if("fulfilled"===t[0].status)if(z.hide(),"short"===U){e=[];for(var i=0;i<44;i++)e.push(t[0].value[0]);e=[].concat(c(e),c(t[0].value))}else e=t[0].value;else e=[],z.show();"fulfilled"===t[1].status?(o=[(a=t[1].value).map((function(t){return{slope:Number(t.gradient)}}))],F.hide(),q.hide()):(a=[],o=[],F.show(),q.show());var r="fulfilled"===t[4].status?t[4].value:[];o.length&&o.push(r);var s,l,d="fulfilled"===t[5].status?t[5].value:[],p="fulfilled"===t[2].status?t[2].value:[];p.reverse(),"fulfilled"===t[3].status?(n=t[3].value[0],H.hide()):(n=[],H.show()),"across"===V&&(s=-.2,l=1),M.updateChart(e,p,"long"===U?1947:1990,2022,s,l,!0,[{y:0,stroke:"rgb(210,210,210)",strokeWidth:1}]),P.updateChart(a,p,"long"===U?1947:1990,2022,s,l,!0,[{y:0,stroke:"rgb(210,210,210)",strokeWidth:1}]),O.updateChart(n);var u=d.find((function(t){return t.region===J}));o.length?D.updateChart(o,u.c5,u.c95,[{x:-.004,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:-.001,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:0,stroke:"silver",strokeWidth:1},{x:.001,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"},{x:.004,stroke:"silver",strokeWidth:1,strokeDasharray:"3 3"}],null,"max"===K):D.updateChart([])}))}function Z(t){var e,a;e=X(t),(a=W("<select>").appendTo(e)).addClass("selectpicker"),a.addClass("atlas-trends-regions-control"),a.attr("data-width","100%"),a.on("changed.bs.select",(function(){N("trend-region",J=W(this).val(),30),Q()})),[{caption:"Britain",val:"Britain"},{caption:"Ireland",val:"Ireland"},{caption:"England",val:"England"},{caption:"Scotland",val:"Scotland"},{caption:"Wales",val:"Wales"},{caption:"Northern Ireland",val:"Northern"},{caption:"Republic of Ireland",val:"Republic"}].forEach((function(t){var e=(t.selected,W("<option>"));e.attr("value",t.val),e.html(t.caption).appendTo(a)})),a.val(J),a.selectpicker(),function(t){var e=W("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-term-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){N("trend-term",U=W(this).val(),30),Q()})),[{caption:"Long-term trend (post-1930)",val:"long"},{caption:"Short-term trend (post-1987)",val:"short"}].forEach((function(t){var a=(t.selected,W("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(U),e.selectpicker()}(X(t)),function(t){var e=W("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-scale-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){N("trend-scale",V=W(this).val(),30),Q()})),[{caption:"Scale trends to species",val:"within"},{caption:"Scale trends across species",val:"across"}].forEach((function(t){var a=(t.selected,W("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(V),e.selectpicker()}(X(t)),function(t){var e=W("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-trends-density-scale-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){N("trend-scale-density",K=W(this).val(),30),Q()})),[{caption:"Scale density plot to max",val:"max"},{caption:"Scale density plot to area",val:"area"}].forEach((function(t){var a=(t.selected,W("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(K),e.selectpicker()}(X(t))}function X(t,e){var a=W("<div>").appendTo(W(t));return a.addClass("atlas-trend-control-row"),e&&a.addClass(e),a}var Y=jQuery,$=drupalSettings;function tt(t,e){if(document.getElementById(t).innerHTML="",e){var a=$.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(T);d3.csv(n).then((function(e){var a=e[0].images.split(";").filter((function(t){return t})).map((function(t){return{src:t.replace("{PIXELSIZE}","1920"),thumb:t.replace("{PIXELSIZE}","192"),subHtml:'\n              <div class="lightGallery-captions">\n                <div style="background-color: black; opacity: 0.7">\n                <p style="margin: 0.3em">Copyright Rob Still/Chris Gibson</p>\n                <div>\n              </div>'}})),n=document.getElementById(t);if(a.length){var o=lightGallery(n,{container:n,dynamic:!0,hash:!1,closable:!1,download:!1,showMaximizeIcon:!0,appendSubHtmlTo:".lg-item",slideDelay:400,plugins:[lgZoom,lgThumbnail],dynamicEl:a,thumbWidth:90,thumbHeight:"60px",thumbMargin:4});setTimeout((function(){o.openGallery(),Y("#bsbi-gallery-copyright").show()}),200)}else n.innerHTML="<i>No images are available for this taxon.</i>",Y("#bsbi-gallery-copyright").hide()}))}}var et,at,nt,ot=jQuery,it=drupalSettings,rt=A("gridstyle")?A("gridstyle"):"solid",st=A("backdrop")?A("backdrop"):"colour_elevation",ct="allclass",lt=A("inset")?A("inset"):"BI4",dt=A("boundaries")?A("boundaries"):"none",pt=!1,ut="static",ht="hectad",bt=5,ft=2,mt={display:!0,scale:.8,x:10,y:0,data:null},vt={display:!0,scale:1,x:10,y:5,data:null},gt=[{min:"",max:1929,access:"status_29",caption:"1929 and before"},{min:1930,max:1969,access:"status_30_69",caption:"1930–1969"},{min:1970,max:1986,access:"status_70_86",caption:"1970–1986"},{min:1987,max:1999,access:"status_87_99",caption:"1987–1999"},{min:2e3,max:2019,access:"status_00_19",caption:"2000–2019"}],yt=[{lower:"1930–69",upper:"2000–19",access:"change_1930_1969_vs_2000_2019",caption:"1930–69 vs 2000–19"},{lower:"1987–99",upper:"2000–19",access:"change_1987_1999_vs_2000_2019",caption:"1987–99 vs 2000–19"}];function xt(t,e){var a=ot("<div>").appendTo(ot(t));return a.addClass("atlas-map-control-row"),e&&a.addClass(e),a}function wt(){"static"===ut?(ot("#slippyAtlasMain").hide(),ot("#staticAtlasMain").show()):(ot("#staticAtlasMain").hide(),ot("#slippyAtlasMain").show()),"static"===ut?ot(".atlas-save-map-image").show():ot(".atlas-save-map-image").hide(),ot(".atlas-download-map-data").show(),"allclass"===ct&&"hectad"===ht?ot(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!1):ot(".atlas-download-map-data input, .atlas-download-map-data button").attr("disabled",!0),"static"===ut?ot(".atlas-backdrop-selector").show():ot(".atlas-backdrop-selector").hide(),"static"===ut?ot(".atlas-inset-control").show():ot(".atlas-inset-control").hide(),"static"===ut?ot(".atlas-grid-type-control").show():ot(".atlas-grid-type-control").hide(),"status"===ct?ot(".atlas-period-slider-control").show():ot(".atlas-period-slider-control").hide(),"trends"===ct?ot(".atlas-trend-slider-control").show():ot(".atlas-trend-slider-control").hide(),"allclass"===ct||"slippy"===ct?ot(".atlas-status-checkbox-control").show():ot(".atlas-status-checkbox-control").hide(),"slippy"===ut?ot(".atlas-opacity-slider-control").show():ot(".atlas-opacity-slider-control").hide();var t=d.taxaNoStatusList.indexOf(et.identifier)>-1||et.isHybrid,e=et.hybridMapping;t||e?(pt=!1,d.showStatus=!1,ot(".atlas-status-checkbox-control span").text("No status info for this taxon"),ot(".atlas-status-checkbox-control span").css("color","silver")):(ot(".atlas-status-checkbox-control span").text("Show status"),ot(".atlas-status-checkbox-control span").css("color","black")),t||e||"slippy"===ut&&"allclass"===ct&&"hectad"!==ht?(ot(".atlas-status-checkbox").prop("checked",!1),ot(".atlas-status-checkbox").attr("disabled",!0)):(ot(".atlas-status-checkbox").attr("disabled",!1),ot(".atlas-status-checkbox").prop("checked",pt)),"slippy"===ut&&"allclass"===ct?ot(".atlas-resolution-control").show():ot(".atlas-resolution-control").hide(),"slippy"===ut&&"allclass"===ct?(d.resolution=ht,ot(".bsbi-resolution-"+ht).prop("checked",!0)):d.resolution="hectad";var a=ot('.atlas-map-type-selector option[value="hybrid"]');e?a.show():(a.hide(),"hybrid"===ct&&(a.prop("selected",!1),ot('.atlas-map-type-selector option[value="allclass"]').prop("selected",!0),ct="allclass")),ot(".atlas-map-type-selector").selectpicker("refresh")}function kt(t){et=t}function Tt(t){var e=JSON.parse(JSON.stringify(brcatlas.namedTransOpts));delete e.BI3,e.BI4.bounds.xmin=-24e4,e.BI1.bounds.xmin=-23e4,e.BI2.bounds.xmin=-23e4,d.bsbiDataRoot=it.bsbi_atlas.dataRoot+"bsbi/maps/",d.showStatus=!1;var a={status_29:d.status_29,status_30_69:d.status_30_69,status_70_86:d.status_70_86,status_87_99:d.status_87_99,status_00_19:d.status_00_19,"Tetrad frequency":d.bsbiHectadDateTetFreq,change_1987_1999_vs_2000_2019:d.change_1987_1999_vs_2000_2019,change_1930_1969_vs_2000_2019:d.change_1930_1969_vs_2000_2019,distAllClasses:d.distAllClasses,hybrid:d.hybrid};nt=brcatlas.svgMap({selector:t,mapid:"staticAtlasMain",captionId:"dotCaption",height:650,expand:!0,legendOpts:vt,transOptsKey:A("inset")?A("inset"):lt,transOptsSel:e,mapTypesKey:"status_10_19",mapTypesSel:a,mapTypesControl:!1,transOptsControl:!1,seaFill:"white",gridLineColour:"#7C7CD3",gridLineStyle:rt,boundaryColour:"#7C7CD3",vcColour:"#7C7CD3",vcLineStyle:"vc"===dt?"":"none",countryColour:"#7C7CD3",countryLineStyle:"country"===dt?"":"none"}),it.bsbi_atlas.dataRoot,at=brcatlas.leafletMap({selector:t,mapid:"slippyAtlasMain",height:650,width:nt.getMapWidth(),captionId:"dotCaption",mapTypesKey:"status_10_19",mapTypesSel:a,legendOpts:mt,basemapConfigs:[{name:"Open Street Map",type:"tileLayer",selected:!0,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",opts:{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},{name:"Stamen Black & White",type:"tileLayer",selected:!1,url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}",opts:{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}},{name:"Open Topo Map",type:"tileLayer",selected:!1,url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",opts:{maxZoom:17,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},{name:"GEBCO 2020 Elevation",type:"wms",selected:!1,url:"https://www.gebco.net/data_and_products/gebco_web_services/2020/mapserv?",opts:{layers:"GEBCO_2020_Grid_2",maxZoom:17,attribution:"Imagery reproduced from the GEBCO_2020 Grid, GEBCO Compilation Group (2020) GEBCO 2020 Grid (doi:10.5285/a29c5465-b138-234d-e053-6c86abc040b9)"}},{name:"Copernicus elevation aspect",type:"wms",selected:!1,url:"https://copernicus.discomap.eea.europa.eu/arcgis/services/Elevation/Aspect/MapServer/WMSServer?",opts:{layers:"image",maxZoom:17,attribution:"&copy; European Commission"}}],callbacks:[function(){document.getElementById("atlas-loader").style.display="inline-block"},function(){document.getElementById("atlas-loader").style.display="none"},function(){document.getElementById("atlas-loader").style.display="inline-block"},function(){document.getElementById("atlas-loader").style.display="none"}],showVcs:"vc"===dt,showCountries:"country"===dt}),ot("#slippyAtlasMain").hide()}function Ct(t){var e;if(e="static"===ut?nt:at,"status"===ct){var a=gt[bt-1].access;e.setMapType(a)}else if("allclass"===ct)e.setMapType("distAllClasses");else if("trends"===ct){var n=yt[ft-1].access;e.setMapType(n)}else"tetrad"===ct?e.setMapType("Tetrad frequency"):"hybrid"===ct&&e.setMapType("hybrid");if(vt.scale=.9,"BI1"==lt&&(vt.scale=.77*vt.scale),"BI2"==lt&&(vt.scale=.85*vt.scale),nt.setLegendOpts(vt),et.identifier){if(e.setIdentfier(et.identifier),t)return e.redrawMap();e.redrawMap().catch((function(t){console.warn("Unable to generate map for ".concat(et.shortName," (").concat(et.identifier,"). Error message:"),t),e.clearMap()}))}ot("#dotCaption").html(d.dotCaption)}function _t(t){var e,a;!function(t){var e=ot('<div style="display: flex">').appendTo(t),a=ot('<div class="btn-group" data-toggle="buttons">').appendTo(e),n=ot('<label class="btn btn-primary active">').appendTo(a);ot('<input type="radio" name="mapType" value="static" checked>').appendTo(n),n.append("Overview");var o=ot('<label class="btn btn-primary">').appendTo(a);ot('<input type="radio" name="mapType" value="slippy">').appendTo(o),o.append("Zoomable");var i=ot('<div id="atlas-loader" style="display: none">').appendTo(e);ot('<div class="atlas-loader">').appendTo(i),ot('input[type=radio][name="mapType"]').change((function(){if(ut=ot(this).val(),d.displayedMapType=ut,"slippy"===ut){var t=ot("#staticAtlasMain svg"),e=t.width(),a=t.height();at.setSize(e,a)}wt(),Ct(),"slippy"===ut&&at.invalidateSize()}))}(xt(t)),e=xt(t),(a=ot("<select>").appendTo(e)).addClass("selectpicker"),a.addClass("atlas-map-type-selector"),a.attr("data-width","100%"),a.on("changed.bs.select",(function(){ct=ot(this).val(),wt(),Ct()})),[{caption:"Distribution overview",val:"allclass"},{caption:"Distribution by year range",val:"status"},{caption:"Change maps",val:"trends"},{caption:"Tetrad frequency",val:"tetrad"},{caption:"Map hybrid with parents",val:"hybrid"}].forEach((function(t){var e=ot("<option>");e.attr("value",t.val),e.html(t.caption).appendTo(a)})),a.selectpicker(),function(t){var e=ot("<div>").appendTo(t);e.addClass("atlas-period-slider-control"),e.hide();var a=ot("<div>").appendTo(e);a.addClass("slidecontainer");var n=ot("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",gt.length).attr("id","atlas-range-select"),n.change((function(){bt=ot(this).val(),Ct()}));var o=ot("<div>").appendTo(a);o.addClass("atlas-range-tick-container"),o.css("margin-bottom","4.3em"),gt.forEach((function(t,e){var a=ot("<span>").appendTo(o);a.addClass("atlas-range-tick");var n=e/(gt.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var i=ot("<span>").appendTo(a);i.addClass("atlas-range-tick-text"),i.html((t.min?t.min:"pre")+"<br>"+(1929===t.max?1930:t.max))}))}(xt(t)),function(t){var e=ot("<div>").appendTo(t);e.addClass("atlas-status-checkbox-control");var a=ot('<div class="checkbox">').appendTo(e);ot('<label><input type="checkbox" class="atlas-status-checkbox"/><span>Show status</span></label>').appendTo(a),ot(".atlas-status-checkbox").change((function(){pt=ot(this).is(":checked"),d.showStatus=pt,Ct()}))}(xt(t)),function(t){var e=ot("<div>").appendTo(t);e.addClass("atlas-trend-slider-control"),e.hide();var a=ot("<div>").appendTo(e);a.addClass("slidecontainer"),a.addClass("atlas-trend-select-container");var n=ot("<input>").appendTo(a);n.addClass("slider"),n.attr("type","range").attr("min","1").attr("max",yt.length).addClass("atlas-trend-select"),n.change((function(){ft=ot(this).val(),Ct()}));var o=ot("<div>").appendTo(a);o.addClass("atlas-trend-tick-container"),yt.forEach((function(t,e){var a=ot("<span>").appendTo(o);a.addClass("atlas-trend-tick");var n=e/(yt.length-1)*100;a.css("left",n.toString()+"%"),a.text("|"),a.append("<br>");var i=ot("<span>").appendTo(a);i.addClass("atlas-trend-tick-text"),i.addClass("atlas-trend-tick-text-"+e),i.html(t.lower+"<br>v.<br>"+t.upper)})),e.css("margin-bottom","5.3em")}(xt(t)),function(t){var e=it.bsbi_atlas.dataRoot+"rasters/",a=[{caption:"No backdrop",val:"none"},{caption:"Colour elevation",val:"colour_elevation"},{caption:"Grey elevation",val:"grey_elevation_300"}],n=ot("<select>").appendTo(t);n.addClass("selectpicker"),n.attr("data-width","100%"),n.on("changed.bs.select",(function(){a.forEach((function(t){"none"!==t.val&&nt.basemapImage(t.val,!1,e+t.val+".png",e+t.val+".pgw")})),N("backdrop",st=ot(this).val(),30),"none"!==st&&nt.basemapImage(st,!0,e+st+".png",e+st+".pgw")})),a.forEach((function(t){var e=ot("<option>");e.attr("value",t.val),e.html(t.caption).appendTo(n)})),n.val(st),"none"!==st&&nt.basemapImage(st,!0,e+"".concat(st,".png"),e+"".concat(st,".pgw")),n.selectpicker()}(xt(t,"atlas-backdrop-selector")),function(t){var e=ot("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-inset-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){lt=ot(this).val(),nt.setTransform(lt),N("inset",lt,30),Ct()})),[{caption:"No insets",val:"BI1"},{caption:"Channel Isles inset",val:"BI2"},{caption:"Northern and Channel Isles inset",val:"BI4"}].forEach((function(t){var a=(t.selected,ot("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(lt),e.selectpicker()}(xt(t)),function(t){var e=ot("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-grid-type-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){N("gridstyle",rt=ot(this).val(),30),nt.setGridLineStyle(rt)})),[{caption:"Solid grid lines",val:"solid"},{caption:"Dashed grid lines",val:"dashed"},{caption:"No grid lines",val:"none"}].forEach((function(t){var a=(t.selected,ot("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(rt),e.selectpicker()}(xt(t)),function(t){var e=ot("<select>").appendTo(t);e.addClass("selectpicker"),e.addClass("atlas-boundaries-control"),e.attr("data-width","100%"),e.on("changed.bs.select",(function(){N("boundaries",dt=ot(this).val(),30),"none"===dt?(nt.setVcLineStyle("none"),nt.setCountryLineStyle("none"),nt.setBoundaryColour("#7C7CD3"),at.setShowVcs(!1),at.setShowCountries(!1)):"vc"===dt?(nt.setVcLineStyle(""),nt.setCountryLineStyle("none"),nt.setBoundaryColour("white"),at.setShowVcs(!0),at.setShowCountries(!1)):"country"===dt&&(nt.setVcLineStyle("none"),nt.setCountryLineStyle(""),nt.setBoundaryColour("white"),at.setShowVcs(!1),at.setShowCountries(!0))})),[{caption:"Country boundaries",val:"country"},{caption:"Vice-county boundaries",val:"vc"},{caption:"No boundaries",val:"none"}].forEach((function(t){var a=(t.selected,ot("<option>"));a.attr("value",t.val),a.html(t.caption).appendTo(e)})),e.val(dt),e.selectpicker()}(xt(t)),function(t){ot("#atlas-leaflet-svg").css("opacity",.7);var e=ot("<div>").appendTo(t);e.addClass("atlas-opacity-slider-control"),e.hide();var a=ot("<div>").appendTo(e);a.addClass("atlas-opacity-slider-label"),a.text("Opacity:");var n=ot("<div>").appendTo(e);n.addClass("slidecontainer"),n.addClass("atlas-opacity-slider-slider");var o=ot("<input>").appendTo(n);o.addClass("slider"),o.attr("type","range").attr("min","1").attr("max","100").attr("value",70).attr("id","atlas-opacity-slider"),o.change((function(){ot("#atlas-leaflet-svg").css("opacity",ot(this).val()/100)}))}(xt(t)),ot(t).each((function(t){var e="bsbi-atlas-map-controls-"+t;ot("<div>").appendTo(ot(this)).addClass(e),function(t,e){var a=ot("<div>").appendTo(t);function n(t,n,o){var i=ot("<div>").appendTo(a);i.attr("class","radio");var r=ot("<label>").appendTo(i);r.css("padding-left","0");var s=ot("<input>").appendTo(r),c=ot("<span>").appendTo(r);c.text(t),c.css("padding-left","20px"),s.attr("type","radio"),s.attr("name","bsbi-resolution-"+e),s.attr("class","bsbi-resolution-"+n),s.attr("value",n),s.css("margin-left",0),o&&s.prop("checked",!0),s.change((function(){ht=ot(this).val(),ot(".bsbi-resolution-"+ht).prop("checked",!0),wt(),Ct()}))}n("Hectads","hectad",!0),n("Tetrads","tetrad",!1)}(xt(e="."+e,"atlas-resolution-control"),t),function(t,e){var a="png",n=ot("<div>").appendTo(t);n.addClass("atlas-save-map-image"),n.hide();var o=ot("<svg>").appendTo(n),i=ot("<text>").appendTo(o);i.attr("x","10"),i.attr("y","20"),ot("<br>").appendTo(n);var r=ot("<button>").appendTo(n);function s(t,o,i){var r=ot("<div>").appendTo(n);r.css("display","inline-block"),r.css("margin-left","0.5em"),r.attr("class","radio");var s=ot("<label>").appendTo(r);s.css("padding-left","0");var c=ot("<input>").appendTo(s),l=ot("<span>").appendTo(s);l.text(t),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","img-download-type-"+e),c.attr("class","img-download-type-"+o),c.attr("value",o),c.css("margin-left",0),i&&c.prop("checked",!0),c.change((function(){ot(".img-download-type-"+o).prop("checked",!0),a=o}))}r.addClass("btn btn-default"),r.text("Download image"),r.on("click",(function(){var t={text:B(et,!0),margin:10,fontSize:10};nt.saveMap("svg"===a,t,"atlas-image")})),s("PNG","png",!0),s("SVG","svg",!1)}(xt(e,"atlas-image-button"),t),function(t,e){var a="csv",n=ot("<div>").appendTo(t);n.addClass("atlas-download-map-data"),n.hide();var o=ot("<button>").appendTo(n);function i(t,o,i){var r=ot("<div>").appendTo(n);r.css("display","inline-block"),r.css("margin-left","0.5em"),r.attr("class","radio");var s=ot("<label>").appendTo(r);s.css("padding-left","0");var c=ot("<input>").appendTo(s),l=ot("<span>").appendTo(s);l.text(t),l.css("padding-left","20px"),c.attr("type","radio"),c.attr("name","download-type-"+e),c.attr("class","download-type-"+o),c.attr("value",o),c.css("margin-left",0),i&&c.prop("checked",!0),c.change((function(){ot(".download-type-"+o).prop("checked",!0),a=o}))}o.addClass("btn btn-default"),o.text("Download data"),o.on("click",(function(){("static"===ut?nt:at).downloadData("geojson"===a)})),i("CSV","csv",!0),i("GJson","geojson",!1)}(xt(e,"atlas-download-button"),t)}))}function St(t,e){d[t]=e}function Et(){return nt}function Lt(t,e){function a(t,e){d3.select("#".concat(t)).attr("fill","rgb(".concat(255-255*Number(e)/100,",255,255)"));var a=220-Math.floor(e/100*220);d3.select("#".concat(t,"-path")).attr("fill","rgb(".concat(a,",").concat(a,",").concat(a,")"));var n=d3.select("#".concat(t)).select("title").attr("data-title");d3.select("#".concat(t)).select("title").text("".concat(n,": ").concat(e,"%")),d3.select("#".concat(t,"-path")).select("title").text("".concat(n,": ").concat(e,"%"))}a("".concat(t,"_decline_strong"),e.declineStrong),a("".concat(t,"_decline_mod"),e.declineMod),a("".concat(t,"_stable"),e.stable),a("".concat(t,"_increase_mod"),e.increaseMod),a("".concat(t,"_increase_strong"),e.increaseStrong)}function Rt(t,e){var a="M 2250 7256 l 0 -2813 l -61 -7 c -34 -3 -526 -6 -1093 -6 l -1031 -1 l 66 -62 c 36 -34 756 -714 1600 -1512 c 844 -797 1820 -1719 2169 -2049 c 349 -329 667 -630 705 -668 l 70 -68 l 230 217 c 1454 1373 3719 3512 4012 3790 l 373 353 l -1090 0 l -1090 0 l 0 2820 l 0 2820 l -2430 0 l -2430 0 l 0 -2814 z",n=[{svg:a,scale:.6,rot:180,text:"Strong decline",id:"".concat(t,"_decline_strong"),da:[100]},{svg:a,scale:.4,rot:180,text:"Moderate decline",id:"".concat(t,"_decline_mod"),da:[75,25]},{svg:"M 5 3968 c -3 -7 -4 -897 -3 -1978 l 3 -1965 l 2080 0 l 2080 0 l 0 1975 l 0 1975 l -2078 3 c -1657 2 -2079 0 -2082 -10 z",scale:.2,rot:45,text:"Stable",id:"".concat(t,"_stable"),da:[75,25]},{svg:a,scale:.4,rot:0,text:"Moderate increase",id:"".concat(t,"_increase_mod"),da:[75,25]},{svg:a,scale:.6,rot:0,text:"Strong increase",id:"".concat(t,"_increase_strong"),da:[75,25]}],o=d3.select("#".concat(t)).append("svg").attr("width",125).attr("height",25).style("overflow","visible").style("vertical-align","bottom");e||o.append("rect").attr("width",125).attr("height",25).attr("stroke","grey").attr("fill","none").style("vertical-align","bottom"),n.forEach((function(t,a){if((e?o.append("circle").attr("id",t.id).attr("r",11).attr("cx",25*a+12.5).attr("cy",12.5).attr("stroke","grey").attr("fill","white").attr("clip-path","circle()"):o.append("rect").attr("id",t.id).attr("width",25).attr("height",25).attr("x",25*a).attr("fill","white")).append("title").attr("data-title",t.text).text(t.text),t.svg){var n=o.append("path").attr("d",t.svg).style("visibility","hidden"),i=n.node().getBBox();n.remove();var r=25/i.width*t.scale,s=25*a+(25-i.width*r)/2,c=(25-i.height*r)/2,l=12.5+25*a;o.append("path").attr("id","".concat(t.id,"-path")).attr("d",t.svg).attr("transform","\n          rotate(".concat(t.rot,", ").concat(l,", ").concat(12.5,")\n          translate(").concat(s," ").concat(c,") \n          scale(").concat(r,")\n        ")).append("title").text(t.text)}}))}function It(t,e){return Nt.apply(this,arguments)}function Nt(){return(Nt=s(regeneratorRuntime.mark((function t(e,a){var n,o,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(t,e){var a=document.createElement("a");a.href=t,a.download=e,document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(a)},i=function(t){var e="http://www.w3.org/2000/xmlns/",a=t.node().cloneNode(!0);d3.select(a).selectAll("text").style("font-family","Arial, Helvetica, sans-serif"),a.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),a.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");var n=(new window.XMLSerializer).serializeToString(a);return new Blob([n],{type:"image/svg+xml"})},o=function(t,e){var a=URL.createObjectURL(t),n="".concat(e,".svg");r(a,n)},n=d3.select("#".concat(e," svg")),t.abrupt("return",new Promise((function(t){var e=i(n);a&&o(e,a),t(e)})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}jQuery;var At,Bt,Mt,Pt,Ot,Dt,zt=jQuery,Ft=drupalSettings,Ht={identifier:"",name:null,shortName:null,tetrad:null},qt=!1;function Gt(){var t,e;zt("#bsbi-atlas-download").css("display","flex"),zt("<div>").appendTo(zt("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-left").css("flex",1),zt("<div>").appendTo(zt("#bsbi-atlas-download")).attr("id","bsbi-atlas-download-right").css("flex",1).css("margin-left","1em"),function(){var t=zt("<div>").appendTo(zt(".bsbi-atlas-taxon-selector"));t.addClass("atlas-taxon-selector-div");var e=zt("<select>").appendTo(t);e.addClass("atlas-taxon-selector-sel"),d3.csv(Ft.bsbi_atlas.dataRoot+"bsbi/taxon_list.csv?prevent-cache=".concat(T)).then((function(t){t.forEach((function(t){var a="";t.vernacular&&(a="<b>"+t.vernacular+"</b> "),a+=t.formattedName;var n=zt("<option>");n.attr("data-content",a),n.attr("value",t.ddbid),n.attr("data-taxon-name",t.taxonName),n.attr("data-is-hybrid",t.hybrid),n.html(a).appendTo(e)})),e.attr("data-size","10"),e.attr("data-live-search","true"),e.attr("data-header","Start typing the name of a taxon"),e.attr("title","Select a taxon"),e.selectpicker(),e.on("changed.bs.select",(function(){console.log("Identifier:",zt(this).val()),ae(),Ht.identifier=zt(this).val(),Ht.name=zt(this).find(":selected").attr("data-content"),Ht.shortName=zt(this).find(":selected").attr("data-taxon-name"),Ht.isHybrid="t"===zt(this).find(":selected").attr("data-is-hybrid");var t="t"===zt(this).find(":selected").attr("data-is-hybrid"),e=Ot.indexOf(zt(this).val())>-1;d.showStatus=!t&&!e,Ut(Ht.identifier),Kt(Ht.identifier),Zt(Ht.identifier),Yt(Ht.identifier),te(Ht.identifier)})),Dt=t.map((function(t){return"t"===t.hybrid}))})).catch((function(){console.log("Error reading taxon CSV")})),d3.csv("".concat(Ft.bsbi_atlas.dataRoot,"bsbi/no_status.csv?prevent-cache=").concat(T)).then((function(t){Ot=t.map((function(t){return t["ddb id"]}))}))}(),(t=zt("<button>").appendTo(zt("#bsbi-atlas-download-left"))).addClass("btn btn-default"),t.text("Download selected"),t.on("click",(function(){ae();var t=Wt(Ht.shortName,Ht.identifier),e=Et();zt("#download-map").is(":checked")&&e.saveMap(!0,null,"".concat(t,"map")),zt("#download-apparency").is(":checked")&&At.saveImage(!0,"".concat(t,"apparency")),zt("#download-phenology").is(":checked")&&Bt.saveImage(!0,"".concat(t,"phenology")),zt("#download-altlat").is(":checked")&&Mt.saveImage(!0,"".concat(t,"altlat")),zt("#download-trend").is(":checked")?(console.log("checked"),It("bsbi-trend-summary-gb","".concat(t,"altlat-gb")),It("bsbi-trend-summary-ir","".concat(t,"altlat-ir"))):console.log("not checked")})),zt("<hr/>").appendTo(zt("#bsbi-atlas-download-left")),zt("<p>").appendTo(zt("#bsbi-atlas-download-left")).html("\n    For batch downloads, first select a CSV file from your computer\n    that has two columns: <i>taxonId</i> which has the ddbid for each \n    taxon and <i>taxon</i> which specifies a taxon name. \n    The taxon name is only used to name the file and\n    doesn't have to be exactly the same as \n    the name used elsewhere on the site. The ddbid will also be used \n    in the filename in case of any ambiguity.\n  "),(e=zt("<input>").appendTo(zt("#bsbi-atlas-download-left"))).attr("type","file"),e.attr("accept",".csv"),e.attr("id","bsbi-atlas-batch-file"),e.css("margin-bottom","1em"),e.on("change",(function(){!function(t){var e=new FileReader;e.addEventListener("load",(function(t){Pt=t.target.result})),e.readAsDataURL(t.target.files[0])}(event)})),function(){var t=zt("<button>").appendTo(zt("#bsbi-atlas-download-left"));t.addClass("btn btn-default"),t.text("Download batch"),t.on("click",(function(){ae(),function(){jt.apply(this,arguments)}()}))}(),function(){var t=zt("<button>").appendTo(zt("#bsbi-atlas-download-left"));t.addClass("btn btn-default"),t.css("margin-left","1em"),t.text("Cancel"),t.on("click",(function(){qt=!0}))}(),zt("<hr/>").appendTo(zt("#bsbi-atlas-download-left")),Jt("map","Map"),Jt("apparency","Apparency"),Jt("phenology","Phenology"),Jt("altlat","Alt/Lat"),Jt("trend","Trends"),function(){zt('<div id="bsbiMapDownloadDiv" style="max-width: 500px">').appendTo(zt("#bsbi-atlas-download-left")),Tt("#bsbiMapDownloadDiv");var t=Et(),e=A("backdrop")?A("backdrop"):"colour_elevation",a=Ft.bsbi_atlas.dataRoot+"rasters/";"none"!==e&&t.basemapImage(e,!0,a+"".concat(e,".png"),a+"".concat(e,".pgw"));d.periodClasses="print"}(),zt("<div>").appendTo(zt("#bsbi-atlas-download-left")).attr("id","bsbi-apparency-chart").css("max-width","400px"),At=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd"}],width:400,height:250,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",showLegend:!1,interactivity:"none"}),zt("<div>").appendTo(zt("#bsbi-atlas-download-left")).attr("id","bsbi-phenology-chart").css("max-width","400px"),Bt=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,split:!0,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none"}),function(){zt("<div>").appendTo(zt("#bsbi-atlas-download-left")).attr("id","bsbi-altlat-chart").css("max-width","600px");Mt=brccharts.altlat({selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1-10%"},{min:10.00001,max:30,radius:14,legend:"11-30%"},{min:30.00001,max:40,radius:16,legend:"31-40%"},{min:40.00001,max:50,radius:18,legend:"41-50%"},{min:50.00001,max:100,radius:20,legend:"51-100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:45,right:10,top:20,bottom:35},showTaxonLabel:!1,showLegend:!0,axisLabelFontSize:12,legendFontSize:10,interactivity:"toggle"})}(),zt("<div>").appendTo(zt("#bsbi-atlas-download-left")).attr("id","bsbi-trend-summary-gb").css("max-width","600px"),zt("<div>").appendTo(zt("#bsbi-atlas-download-left")).attr("id","bsbi-trend-summary-ir").css("max-width","600px")}function Wt(t,e){var a="".concat(t,"_").concat(e,"_");return a=(a=(a=(a=a.replace(/ /g,"_")).replace(/\s+/g,"")).replace(/\./g,"_")).replace(/_+/g,"_")}function jt(){return(jt=s(regeneratorRuntime.mark((function t(){var e,a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d3.csv(Pt);case 2:e=t.sent,qt=!1,a=regeneratorRuntime.mark((function t(a){var n,o,i,r,s,c,l,p,u,h,b,f,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!qt){t.next=2;break}return t.abrupt("return","break");case 2:return n=e[a],o=Wt(n.taxon,n.taxonId),i=void 0,r=void 0,s=void 0,c=void 0,l=Dt.indexOf(n.taxonId)>-1,p=Ot.indexOf(n.taxonId)>-1,d.showStatus=!l&&!p,u=Ut(n.taxonId,o).catch((function(t){return i=t})),h=Kt(n.taxonId,o).catch((function(t){return r=t})),b=Zt(n.taxonId,o).catch((function(t){return s=t})),f=Yt(n.taxonId,o).catch((function(t){return c=t})),m=te(n.taxonId,o).catch((function(t){return t})),t.next=15,Promise.all([u,h,b,f,m]).then((function(){if(i||r||s||c){var t="<b>Problems for ".concat(n.taxon," (").concat(n.taxonId,")</b>");t+="<ul>",i&&(t+="<li>Map failed</li>"),r&&(t+="<li>Apparency chart failed</li>"),s&&(t+="<li>Phenology chart failed</li>"),c&&(t+="<li>Altlat chart failed</li>"),zt("<div>").appendTo(zt("#bsbi-atlas-download-right")).html(t)}}));case 15:case"end":return t.stop()}}),t)})),n=0;case 6:if(!(n<e.length)){t.next=14;break}return t.delegateYield(a(n),"t0",8);case 8:if("break"!==t.t0){t.next=11;break}return t.abrupt("break",14);case 11:n++,t.next=6;break;case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Jt(t,e){zt('<input type="checkbox" id="download-'.concat(t,'" style="margin:0.5em" checked>')).appendTo(zt("#bsbi-atlas-download-left")),zt('<label for="download-'.concat(t,'">').concat(e,"</label>")).appendTo(zt("#bsbi-atlas-download-left"))}function Ut(t,e){return Vt.apply(this,arguments)}function Vt(){return(Vt=s(regeneratorRuntime.mark((function t(e,a){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Et(),!zt("#download-map").is(":checked")){t.next=9;break}return Ht.identifier=e,kt(Ht),t.next=6,Ct(!0);case 6:if(!a){t.next=9;break}return t.next=9,n.saveMap(!0,null,"".concat(Wt(a,e),"map"));case 9:return t.abrupt("return",Promise.resolve());case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kt(t,e){return Qt.apply(this,arguments)}function Qt(){return(Qt=s(regeneratorRuntime.mark((function t(e,a){var n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!zt("#download-apparency").is(":checked")){t.next=11;break}return n="".concat(Ft.bsbi_atlas.dataRoot,"bsbi/apparency/"),o=n+"all/"+e.replace(/\./g,"_")+".csv",t.next=5,d3.csv(o+"?prevent-cache=".concat(T));case 5:return i=t.sent,t.next=8,S(At,i);case 8:if(!a){t.next=11;break}return t.next=11,At.saveImage(!0,"".concat(Wt(a,e),"apparency"));case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Zt(t,e){return Xt.apply(this,arguments)}function Xt(){return(Xt=s(regeneratorRuntime.mark((function t(e,a){var n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!zt("#download-phenology").is(":checked")){t.next=11;break}return n=Ft.bsbi_atlas.dataRoot+"bsbi/captions/",o="".concat(n).concat(e.replace(/\./g,"_"),".csv"),t.next=5,d3.csv(o+"?prevent-cache=".concat(T));case 5:return i=t.sent,t.next=8,E(Bt,i,null);case 8:if(!a){t.next=11;break}return t.next=11,Bt.saveImage(!0,"".concat(Wt(a,e),"phenology"));case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yt(t,e){return $t.apply(this,arguments)}function $t(){return($t=s(regeneratorRuntime.mark((function t(e,a){var n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!zt("#download-altlat").is(":checked")){t.next=11;break}return n=Ft.bsbi_atlas.dataRoot+"bsbi/maps/altlat/",o="".concat(n).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),t.next=5,d3.csv(o);case 5:return i=t.sent,t.next=8,R(Mt,i);case 8:if(!a){t.next=11;break}return t.next=11,Mt.saveImage(!0,"".concat(Wt(a,e),"altlat"));case 11:return t.abrupt("return",Promise.resolve());case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function te(t,e){return ee.apply(this,arguments)}function ee(){return(ee=s(regeneratorRuntime.mark((function t(e,a){var n,o,i,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(zt("#bsbi-trend-summary-gb").html(""),zt("#bsbi-trend-summary-ir").html(""),n=Ft.bsbi_atlas.dataRoot+"bsbi/trends/long/trends-summaries",o="".concat(n,"/Britain/").concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),i="".concat(n,"/Ireland/").concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),r=new Promise((function(t){d3.csv(o).then((function(t){Rt("bsbi-trend-summary-gb"),Lt("bsbi-trend-summary-gb",t[0])})).catch((function(){})).finally((function(){t("")}))})),s=new Promise((function(t){d3.csv(i).then((function(t){Rt("bsbi-trend-summary-ir"),Lt("bsbi-trend-summary-ir",t[0])})).catch((function(){})).finally((function(){t("")}))})),!a){t.next=14;break}return t.next=10,Promise.all([r,s]);case 10:return t.next=12,It("bsbi-trend-summary-gb","".concat(Wt(a,e),"altlat-gb"));case 12:return t.next=14,It("bsbi-trend-summary-ir","".concat(Wt(a,e),"altlat-gb"));case 14:return t.abrupt("return",Promise.all([r,s]));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ae(){zt("#download-map").is(":checked")||Et().clearMap();zt("#download-apparency").is(":checked")||At.setChartOpts({data:[]}),zt("#download-phenology").is(":checked")||Bt.setChartOpts({data:[]}),zt("#download-altlat").is(":checked")||Mt.setChartOpts({data:[]}),zt("#download-trend").is(":checked")||(zt("#bsbi-trend-summary-gb").html(""),zt("#bsbi-trend-summary-ir").html(""))}var ne=jQuery,oe=drupalSettings;console.log("Running ".concat(o," version ").concat(i)),function(){var t=[],a={identifier:null,name:null,shortName:null,tetrad:null,isHybrid:!1,hybridMapping:!1};function o(t){var e=ne("#bsbi-atlas-section-"+t);ne("<p>").appendTo(e).text("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."),ne("<p>").appendTo(e).text("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")}function i(t){var e=ne("#bsbi-atlas-section-"+t),a=ne('<div class=".container-fluid">').appendTo(e),n=ne('<div class="row">').appendTo(a),o=ne('<div class="col-sm-8">').appendTo(n),i=ne('<div class="col-sm-4">').appendTo(n);o.append('<div id="bsbiMapDiv" width="100%"></div>'),o.append('<div id="dotCaption" width="100%" style="margin-top:1em"></div>'),o.append("<h4>Status etc for devel</h4>"),o.append('<div id="statusDevel" width="100%"></div>'),ne('<div class="bsbi-selected-taxon-name bsbi-section-summary"></div>').appendTo(i).css("font-size","1.3em"),i.append("<hr/>"),i.append('<div id="bsbi-caption"></div>'),Tt("#bsbiMapDiv"),_t(".bsbi-atlas-map-controls"),wt()}function r(t){ne("#bsbi-atlas-section-"+t).append('<div id="bsbi-trends"></div>'),function(t){W("<h4>").appendTo(W(t)).text("Effort-adjusted 10 km distribution trends");var e=W("<div>").appendTo(W(t));e.attr("class","phenRow");var a=W("<div>").appendTo(W(t));a.attr("class","phenRow"),W("<p>").appendTo(W(t)).html("\n  The trends above rely on the frequency scaling using local occupancy (“Frescalo”) approach of Hill (2012). \n  The method was designed to adjust for locally variable recording effort across time periods, \n  and has been used on many distribution datasets (Pescott et al., 2019). Here, we apply \n  Frescalo to vascular plant data gridded at the 10 km scale within the following time \n  periods: 1930–69; 1987–99; 2000–09; 2010–19. These are a subset of the “date-classes” used \n  by the BSBI to organise their data, and roughly designate multi-year periods within which \n  specific national recording projects occurred (Preston et al., 2002).\n  "),W("<p>").appendTo(W(t)).html("\n  Outputs from the Frescalo model include per taxon/time period estimates of mean relative occupancy and \n  their standard deviations. Below, we plot these estimates (filled white circles with black lines) \n  in Figures 1 and 2, along with a GAM smoother (Fig. 1) and a Monte Carlo-based 100-member set of \n  linear regressions compatible with these (Fig. 2). The trend magnitude frequency chart in Figure \n  3 is based on discretising the compatible linear trend set displayed in Figure 2, in order to \n  more clearly display the model-based uncertainty associated with the Frescalo outputs. \n  Pescott et al. (2022) describe the rationale for this in more detail. Finally, Figure 4 … [TO BE COMPLETED].\n  "),W("<p>").appendTo(W(t)).html("\n  [NEW PARAGRAPH: OTHER TEXT ABOUT DECISIONS WITH REGARDS TO INCLUDING AND EXCLUDING SPECIES IN MODELLING AND/OR DISPLAY]\n  "),W("<h4>").appendTo(W(t)).text("References"),W("<p>").appendTo(W(t)).html("\n  Hill, M.O. 2012. Local frequency as a key to interpreting species occurrence data when recording effort is not known. \n  <i>Methods in Ecology and Evolution</i> 3, 195–205.\n  "),W("<p>").appendTo(W(t)).html('\n  Pescott, O.L., Humphrey, T.A., Stroh, P.A., Walker, K.J. 2019. Temporal changes in distributions and the species \n  atlas: How can British and Irish plant data shoulder the inferential burden? <i>British & Irish Botany</i> 1, 250–282. \n  <a href="https://doi.org/10.33928/bib.2019.01.250" target="_blank">https://doi.org/10.33928/bib.2019.01.250</a>\n  '),W("<p>").appendTo(W(t)).html('\n  Pescott, O.L., Stroh, P.A., Humphrey, T.A. and Walker, K.J. 2022. Simple methods for improving the communication \n  of uncertainty in species’ temporal trends. <i>Ecological Indicators</i>, 141, 109117. \n  <a href="https://doi.org/10.1016/j.ecolind.2022.109117" target="_blank">https://doi.org/10.1016/j.ecolind.2022.109117</a>\n  '),W("<p>").appendTo(W(t)).html("\n  Preston, C.D., Pearman, D.A., Dines, T.D. (Eds.) 2002. <i>New Atlas of the British and Irish Flora</i>. Oxford University \n  Press, Oxford, England.\n  ");var n=W("<div>").appendTo(e);n.attr("id","bsbi-gam-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 1"),M=brccharts.trend2({selector:"#bsbi-gam-chart",data:[],means:[],width:350,height:250,margin:{left:50,right:10,top:10,bottom:55},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Relative index",axisLabelFontSize:12,style:{vStroke:"blue",vStrokeWidth:2,cStroke:"grey",cStrokeWidth:.5,cFill:"rgb(230,230,230)",mRad:3,mFill:"white",mStroke:"black",sdStroke:"black"}}),(z=W("<div>").appendTo(n)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var o=W("<div>").appendTo(e);o.attr("id","bsbi-linmod-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 2"),P=brccharts.trend3({selector:"#bsbi-linmod-chart",data:[],means:[],width:350,height:250,margin:{left:50,right:10,top:10,bottom:55},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Relative index",axisLabelFontSize:12,style:{vStroke:"blue",vStrokeWidth:2,vOpacity:.05,mRad:3,mFill:"white",mStroke:"black",sdStroke:"black"}}),(F=W("<div>").appendTo(o)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var i=W("<div>").appendTo(a);i.attr("id","bsbi-density-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 3"),D=brccharts.density({selector:"#bsbi-density-chart",data:[],ylines:[],xlines:[],width:350,height:250,padding:.1,margin:{left:50,right:10,top:10,bottom:45},expand:!0,axisLeft:"on",axisBottom:"tick",axisRight:"on",axisTop:"on",axisLeftLabel:"Density",axisBottomLabel:"Slope",axisLabelFontSize:12,styles:[{stroke:"blue",strokeWidth:1},{stroke:"grey",strokeWidth:1}]}),(q=W("<div>").appendTo(i)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none");var r=W("<div>").appendTo(a);r.attr("id","bsbi-bar-chart").attr("class","phenColumn").css("max-width","400px").css("position","relative").text("Figure 4"),O=brccharts.bar({selector:"#bsbi-bar-chart",data:[],width:350,height:250,padding:.1,margin:{left:50,right:10,top:10,bottom:85},expand:!0,axisLeft:"tick",axisBottom:"tick",axisRight:"none",axisTop:"none",axisLeftLabel:"Frequency",axisLabelFontSize:12,labelPosition:{"text-anchor":"end",dx:"-1em",dy:"0.2em",transform:"rotate(-55)"}}),(H=W("<div>").appendTo(r)).text("No trend available for this combination").css("position","absolute").css("margin","3em").css("top","0px").css("left","50px").css("display","none")}("#bsbi-trends"),Z(".bsbi-atlas-trend-controls")}function c(t){ne("#bsbi-atlas-section-"+t).append('<div id="bsbi-phenology"></div>'),function(t){var e=C("<div>").appendTo(C(t)),a=C("<div>").appendTo(C(t));a.attr("id","bsbi-phenology-source"),a.css("font-size","0.8em"),a.css("margin-bottom","0.8em"),C("<p>").appendTo(C(t)).text("Explanation of apparency and phenology charts. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a."),e.attr("class","phenRow");var n=C("<div>").appendTo(e);n.attr("class","phenColumn");var o=C("<div>").appendTo(e);o.attr("class","phenColumn"),C("<div>").appendTo(n).attr("id","bsbi-apparency-chart").css("max-width","400px"),g=brccharts.phen1({selector:"#bsbi-apparency-chart",data:[],taxa:["taxon"],metrics:[{prop:"n",label:"Apparency",colour:"green",fill:"#ddffdd"}],width:400,height:303,headPad:35,perRow:1,expand:!0,showTaxonLabel:!1,axisLeft:"off",showLegend:!1,interactivity:"none"}),C("<div>").appendTo(n).attr("id","bsbi-phenology-chart").css("max-width","400px"),y=brccharts.phen2({selector:"#bsbi-phenology-chart",data:[],taxa:["taxon"],metrics:[],width:400,height:25,split:!0,headPad:35,chartPad:35,perRow:1,expand:!0,showTaxonLabel:!1,interactivity:"none"}),C("<div>").appendTo(o).attr("id","bsbi-apparency-by-lat-chart").css("max-width","400px"),x=brccharts.phen1({selector:"#bsbi-apparency-by-lat-chart",data:[],taxa:["taxon"],metrics:[],lines:["white","white","#dddddd","white","white","#dddddd","white","white","#dddddd","white","white","#dddddd"],width:400,height:410,spread:!0,perRow:1,expand:!0,showTaxonLabel:!1,showLegend:!1,interactivity:"mousemove",margin:{left:40,right:0,top:20,bottom:5},axisLeftLabel:"Latitudinal band",axisLabelFontSize:12}),C(".brc-chart-phen1").css("overflow","visible"),C("#bsbi-apparency-by-lat-chart .phen-path").css("stroke-width",1)}("#bsbi-phenology"),_(".bsbi-atlas-phenology-controls")}function l(t){var e,a;ne("#bsbi-atlas-section-"+t).append('<div id="bsbi-altitude"></div>'),e="#bsbi-altitude",a=C("<div>").appendTo(C(e)),C("<p>").appendTo(C(e)).text("Explanation of latitude/altitude chart. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque blandit dui vel mauris maximus interdum. Aliquam orci eros, venenatis vel purus nec, venenatis congue leo. Pellentesque rhoncus metus eros, tincidunt congue massa volutpat facilisis. Curabitur pellentesque turpis velit, quis ornare mauris ullamcorper a."),a.attr("id","bsbi-altlat-chart"),a.css("max-width","600px"),w=brccharts.altlat({selector:"#bsbi-altlat-chart",data:[],ranges:[{min:0,max:.99999,radius:8,legend:"<1%"},{min:1,max:10,radius:11,legend:"1–10%"},{min:10.00001,max:30,radius:14,legend:"11–30%"},{min:30.00001,max:40,radius:16,legend:"31–40%"},{min:40.00001,max:50,radius:18,legend:"41–50%"},{min:50.00001,max:100,radius:20,legend:"51–100%"}],taxa:["dummy"],width:600,height:300,perRow:1,expand:!0,margin:{left:45,right:10,top:20,bottom:35},showTaxonLabel:!1,showLegend:!0,axisLabelFontSize:12,legendFontSize:10,interactivity:"toggle"})}function p(t){var e=ne("#bsbi-atlas-section-"+t);e.append('<div id="bsbi-gallery" class="inline-gallery-container"></div>'),ne('<div id="bsbi-gallery-copyright"></div>').appendTo(e).text("Copyright Rob Still/Chris Gibson"),ne("#bsbi-gallery-copyright").hide()}function u(t){var e=t;return oe.bsbi_atlas.dataBsbidb,e=(e=e.replace(/object.php\?entityid=/g,"atlas/")).replace(/&amp;class=TaxonInstance/g,"")}function h(){!function(t,a){if(a){var o=t+"bsbi/apparency/",i=t+"bsbi/captions/",r=o+"all/"+a.replace(/\./g,"_")+".csv";n.csv(r+"?prevent-cache=").then((function(t){S(g,t)})).catch((function(){console.warn("Apparency chart failed for ".concat(r,". Error message:"),e),g.setChartOpts({data:[]})}));var s=o+"byLat/"+a.replace(/\./g,"_")+".csv";n.csv(s+"?prevent-cache=").then((function(t){L(x,k=t)})).catch((function(){console.warn("Apparency by latitude chart failed for ".concat(s,". Error message:"),e),x.setChartOpts({data:[],metrics:[],spread:!1})}));var c="".concat(i).concat(a.replace(/\./g,"_"),".csv");n.csv(c+"?prevent-cache=".concat(T)).then((function(t){E(y,t,"bsbi-phenology-source")}))}}(oe.bsbi_atlas.dataRoot,a.identifier)}function b(){!function(t,e){if(e){var a="".concat(t+"bsbi/maps/","altlat/").concat(e.replace(/\./g,"_"),".csv");n.csv(a).then((function(t){return R(w,t)})).catch((function(t){console.warn("altlat chart failed for ".concat(a,". Error message:"),t),w.setChartOpts({data:[]})}))}}(oe.bsbi_atlas.dataRoot,a.identifier)}function f(){Q(a)}function m(){if(a.identifier){var t=oe.bsbi_atlas.dataRoot+"bsbi/trends/long/trends-summaries",e="".concat(t,"/Britain/").concat(a.identifier.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),o="".concat(t,"/Ireland/").concat(a.identifier.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),i=ne("#trend-summaries");i.html(""),i.css("margin-bottom","0.5em"),ne("<div>").text("Post-1930 effort-adjusted 10 km trends").appendTo(i).css("margin-bottom","0.2em");var r=ne("<table>").appendTo(i),s=ne("<tr>").appendTo(r),c=ne("<tr>").appendTo(r),l=n.csv(e).then((function(t){ne("<td>").appendTo(s).text("Britain:"),ne("<td>").attr("id","trend-sum-gb2").css("padding","0.3em 0 0.3em 0.3em").appendTo(s),Rt("trend-sum-gb2"),Lt("trend-sum-gb2",t[0]),ne("#trend-sum-gb2").show()})),d=n.csv(o).then((function(t){ne("<td>").appendTo(c).text("Ireland:"),ne("<td>").attr("id","trend-sum-ir2").css("padding","0.3em 0 0.3em 0.3em").appendTo(c),Rt("trend-sum-ir2"),Lt("trend-sum-ir2",t[0]),ne("#trend-sum-ir2").show()}));Promise.allSettled([l,d]).then((function(t){t[0].status,t[1].status,"rejected"===t[0].status&&"rejected"===t[1].status?i.hide():i.show()}))}}function N(t){alert("link to ecoflora for: "+t)}function A(t){alert("link to world flora online for: "+t)}kt(a),ne(document).ready((function(){addEventListener("popstate",(function(t){t.state&&t.state.identifier&&ne(".atlas-taxon-selector-sel").selectpicker("val",t.state.identifier)})),"/download"===location.pathname?Gt():(v("title","BSBI Online Plant Atlas 2020"),v("authors","Stroh, P. A., Humphrey, T., Burkmar, R. J., Pescott, O. L., , Roy, D.B., and Walker, K. J."),v("author","Stroh, P. A."),v("author","Humphrey, T."),v("author","Burkmar, R. J."),v("author","Pescott, O. L."),v("author","Roy, D. B."),v("author","Walker, K. J."),v("year","2022"),v("url",location.origin+"/atlas"),function(){d.periodClasses="standard";var e=[{group:null,id:"summary",title:"Summary",fn:i},{group:null,id:"conservation",title:"Conservation",fn:o},{group:null,id:"gallery",title:"Gallery",fn:p},{group:null,id:"trends",title:"Trends",fn:r},{group:"CHARACTERISTICS",id:"phenology",title:"Phenology",fn:c},{group:"CHARACTERISTICS",id:"ecology",title:"Altitude",fn:l},{group:"EXTERNAL LINKS",id:"ecoflora",title:"EcoFlora",fn:N,external:!0},{group:"EXTERNAL LINKS",id:"worldfloraonline",title:"World Flora Online",fn:A,external:!0}];!function(){var e=ne("<div>").appendTo(ne(".bsbi-atlas-taxon-selector"));e.addClass("atlas-taxon-selector-div");var o=ne("<select>").appendTo(e);o.addClass("atlas-taxon-selector-sel");var i=ne("<button>").appendTo(e);i.addClass("atlas-taxon-selector-link"),i.attr("title","Copy link for taxon into clipboard"),i.addClass("btn btn-default"),i.html("&#128279;"),i.css("padding","6px 6px"),i.on("click",(function(){a.identifier&&I(location.origin+"/atlas/"+a.identifier)})),n.csv("".concat(oe.bsbi_atlas.dataRoot,"bsbi/taxon_list.csv?prevent-cache=").concat(T)).then((function(e){(t=e).forEach((function(t){var e="";t.vernacular&&(e="<b>"+t.vernacular+"</b> "),e+=t.formattedName;var a=ne("<option>");a.attr("data-content",e),a.attr("value",t.ddbid),a.attr("data-taxon-name",t.taxonName),a.attr("data-vernacular",t.vernacular),a.attr("data-is-hybrid",t.hybrid);var n=t.hybridParentIds.split(";"),i=2===t.hybridParents.split(";").length&&2===n.length;a.attr("data-hybrid-mapping",i),a.html(e).appendTo(o)})),o.attr("data-size","10"),o.attr("data-live-search","true"),o.attr("data-header","Start typing the name of a taxon"),o.attr("title","Select a taxon"),o.selectpicker(),o.on("changed.bs.select",(function(e,o,i,r){a.identifier!==ne(this).val()&&(a.identifier=ne(this).val(),a.name=ne(this).find(":selected").attr("data-content"),a.shortName=ne(this).find(":selected").attr("data-taxon-name"),a.isHybrid="t"===ne(this).find(":selected").attr("data-is-hybrid"),a.hybridMapping="true"===ne(this).find(":selected").attr("data-hybrid-mapping"),o&&window.history.pushState({identifier:a.identifier},"BSBI Atlas - ".concat(a.shortName),"/atlas/".concat(a.identifier)),kt(a),wt(),Ct(),function(){var e,o=ne("#bsbi-caption");o.html("");var i=oe.bsbi_atlas.dataRoot+"bsbi/captions/",r="".concat(i).concat(a.identifier.replace(/\./g,"_"),".csv?prevent-cache=").concat(T);n.csv(r).then((function(n){var i,r,c=(i=n[0].vernacular,r=n[0].formattedName,"<b>".concat(i,"</b> ").concat(r));if(ne(".bsbi-selected-taxon-name").html("".concat(c)),n[0].atlasSpeciesDescription){(e=ne("<p>").appendTo(o)).append(u(n[0].atlasSpeciesDescription)),e=ne("<p>").appendTo(o);var l=n[0].overallStatus;e.append("".concat(l.charAt(0).toUpperCase()).concat(l.slice(1),"."))}if(n[0].captionedChildTaxonIds){o.append('<h4>Taxa covered <span id="bsbi-taxa-covered-toggle">[show]</span></h4>');var d=ne('<ul id="bsbi-taxa-covered-list">').appendTo(o);n[0].captionedChildTaxonIds.split(";").forEach((function(e){var a=ne("<li>").appendTo(d),n=t.find((function(t){return t.ddbid===e}));if(n){var o=ne("<i>").appendTo(a),i=ne("<a>").appendTo(o);i.attr("href","/atlas/".concat(e)),i.attr("alt","Link to ".concat(n.taxonName)),i.text(n.taxonName)}}));var p=!1;ne("#bsbi-taxa-covered-toggle").click((function(){(p=!p)&&(ne("#bsbi-taxa-covered-list").show(),ne("#bsbi-taxa-covered-toggle").html("[hide]")),p||(ne("#bsbi-taxa-covered-list").hide(),ne("#bsbi-taxa-covered-toggle").html("[show]"))}))}n[0].atlasSpeciesTrends&&(o.append("<h4>Trends</h4>"),ne("<div>").attr("id","trend-summaries").appendTo(o),m(),(e=ne("<p>").appendTo(o)).append(u(n[0].atlasSpeciesTrends))),n[0].atlasSpeciesBiogeography&&(o.append("<h4>Biogeography</h4>"),(e=ne("<p>").appendTo(o)).append(u(n[0].atlasSpeciesBiogeography))),ne("#statusDevel").html("");var h=ne("<ul>").appendTo(ne("#statusDevel"));if(["statusGB","statusIE","statusCI","csRedListEngland","csRedListWales","csNationalStatus","csRedListIreland","csRedDataList2005","csRedDataList2021"].forEach((function(t){ne("<li>").appendTo(h).html("".concat(t,": ").concat(n[0][t]))})),n[0].hybridParents){var b=function(){var t=s(regeneratorRuntime.mark((function t(e){var a,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=oe.bsbi_atlas.dataRoot+"bsbi/captions/",n="".concat(a).concat(e.replace(/\./g,"_"),".csv?prevent-cache=").concat(T),t.next=4,fetch(n,{method:"HEAD"});case 4:return o=t.sent,t.abrupt("return",o.ok);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();o.append("<h4>Hybrid parents</h4>");var f=ne("<ul>").appendTo(o),g=n[0].hybridParents.split(";"),y=n[0].hybridParentIds.split(";");g.forEach(function(){var t=s(regeneratorRuntime.mark((function t(e,a){var n,o,i,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=y[a]?y[a]:"",t.next=3,b(n);case 3:o=t.sent,i=ne("<li>").appendTo(f),r=ne("<i>").appendTo(i),o?((s=ne("<a>").appendTo(r)).attr("href","/atlas/".concat(n)),s.attr("alt","Link to ".concat(e)),s.text(e)):r.text(e);case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())}if(n[0].captionAuthors){o.append("<h4>Authors</h4>");for(var x,w=ne("<p>").appendTo(o),k=n[0].captionAuthors.split(";"),C=0;C<k.length;C++)x=0===C?k[C]:C===k.length-1?"".concat(x," and ").concat(k[C]):"".concat(x,", ").concat(k[C]);w.text(x)}o.append('<h4>References <span id="bsbi-reference-toggle">[show]</span></h4>');var _=ne('<div id="bsbi-reference-div">').appendTo(o);(e=ne('<p id="bsbi-reference-text">').appendTo(_)).text("TODO - references");var S=!1;ne("#bsbi-reference-toggle").click((function(){(S=!S)&&(ne("#bsbi-reference-div").show(),ne("#bsbi-reference-toggle").html("[hide]")),S||(ne("#bsbi-reference-div").hide(),ne("#bsbi-reference-toggle").html("[show]"))})),o.append('<h4>Recommended citation <span id="bsbi-citation-toggle">[show]</span></h4>');var E=ne('<div id="bsbi-citation-div">').appendTo(o);(e=ne('<p id="bsbi-citation-text">').appendTo(E)).append(B(a)),ne('<button id="bsbi-citation-copy-text">Copy as text</button>').appendTo(E).addClass("btn btn-default"),ne('<button id="bsbi-citation-copy-html">Copy as HTML</button>').appendTo(E).addClass("btn btn-default");var L=!1;ne("#bsbi-citation-toggle").click((function(){(L=!L)&&(ne("#bsbi-citation-div").show(),ne("#bsbi-citation-toggle").html("[hide]")),L||(ne("#bsbi-citation-div").hide(),ne("#bsbi-citation-toggle").html("[show]"))})),ne("#bsbi-citation-copy-text").click((function(){I(ne("#bsbi-citation-text").text())})),ne("#bsbi-citation-copy-html").click((function(){I(ne("#bsbi-citation-text").html())})),v("title",n[0].taxonName+" in BSBI Online Plant Atlas 2020",!0)}))}(),h(),b(),f(),tt("bsbi-gallery",a.identifier))})),oe.bsbi_atlas.identifier&&(o.selectpicker("val",oe.bsbi_atlas.identifier),window.history.pushState({identifier:oe.bsbi_atlas.identifier},"BSBI Atlas - ".concat(oe.bsbi_atlas.identifier),"/atlas/".concat(a.identifier))),St("taxaHybridList",t.filter((function(t){return 2===t.hybridParentIds.split(";").length})).map((function(t){var e=t.hybridParentIds.split(";"),a=t.hybridParents.split(";");return{taxon:t.ddbid,parent1:e[0],parent2:e[1],taxonName:t.taxonName,parent1Name:a[0],parent2Name:a[1]}}))),n.csv("".concat(oe.bsbi_atlas.dataRoot,"bsbi/no_status.csv?prevent-cache=").concat(T)).then((function(t){St("taxaNoStatusList",t.map((function(t){return t["ddb id"]})))}))})).catch((function(){console.log("Error reading taxon CSV")}))}();ne(".brc-atlas-map-opts").remove(),ne("#bsbi-atlas-gui").html(null),ne(".bsbi-atlas-trend-controls").hide(),ne(".bsbi-atlas-phenology-controls").hide();var g=ne('<ul class="nav nav-tabs"></ul>').appendTo(ne("#bsbi-atlas-gui"));e.forEach((function(t){t.external||g.append(function(t,e,a){var n=ne("<li>");a===t&&n.addClass("active");return ne('<a data-toggle="tab" href="#bsbi-atlas-section-'+t+'">').appendTo(n).text(e),n}(t.id,t.title,"summary"))}));var y=ne('<div class="tab-content"></div>').appendTo(ne("#bsbi-atlas-gui"));e.forEach((function(t){t.external||y.append(function(t,e,a){var n=ne("<div/>",{id:"bsbi-atlas-section-"+t});n.addClass("tab-pane"),n.addClass("fade"),a===t&&(n.addClass("in"),n.addClass("active"));var o=ne('<p class="bsbi-selected-taxon-name"></p>');return o.css("font-size","1.3em"),o.css("margin-top","0.5em"),o.addClass("bsbi-atlas-section-header"),n.append(o),n}(t.id,t.title,"summary"))})),e.forEach((function(t){t.external||t.fn(t.id)})),ne('a[data-toggle="tab"]').on("shown.bs.tab",(function(t){var e=ne(t.target).attr("href");"#bsbi-atlas-section-summary"===e?(ne(".bsbi-atlas-map-controls").show(),Ct(),m()):ne(".bsbi-atlas-map-controls").hide(),"#bsbi-atlas-section-phenology"===e?(ne(".bsbi-atlas-phenology-controls").show(),h()):ne(".bsbi-atlas-phenology-controls").hide(),"#bsbi-atlas-section-ecology"===e&&b(),"#bsbi-atlas-section-trends"===e?(ne(".bsbi-atlas-trend-controls").show(),f()):ne(".bsbi-atlas-trend-controls").hide(),"#bsbi-atlas-section-gallery"===e&&tt("bsbi-gallery",a.identifier)}))}())}))}()}));
//# sourceMappingURL=bsbi-atlas-min.umd.js.map
